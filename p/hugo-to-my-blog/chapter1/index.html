<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="ğŸ“¦ ä»é›¶å¼€å§‹æ­å»ºå…¨æ ˆåšå®¢ç³»ç»Ÿçš„åŸºç¡€æ¶æ„"><title>Chapter1: é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„æ­å»º</title>
<link rel=canonical href=https://blog.cycbloom.com/p/hugo-to-my-blog/chapter1/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Chapter1: é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„æ­å»º"><meta property='og:description' content="ğŸ“¦ ä»é›¶å¼€å§‹æ­å»ºå…¨æ ˆåšå®¢ç³»ç»Ÿçš„åŸºç¡€æ¶æ„"><meta property='og:url' content='https://blog.cycbloom.com/p/hugo-to-my-blog/chapter1/'><meta property='og:site_name' content='éé‡‘é˜'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-04-11T22:00:00+08:00'><meta property='article:modified_time' content='2025-04-11T22:00:00+08:00'><meta name=twitter:title content="Chapter1: é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„æ­å»º"><meta name=twitter:description content="ğŸ“¦ ä»é›¶å¼€å§‹æ­å»ºå…¨æ ˆåšå®¢ç³»ç»Ÿçš„åŸºç¡€æ¶æ„"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_84d7cd848dfd0892.png width=300 height=299 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>éé‡‘é˜</a></h1><h2 class=site-description>ğŸ”¥ç‚¹ç‡ƒçµæ„Ÿï¼Œå…±äº«æ€ç»´çš„ç¯ç«</h2></div></header><ol class=menu-social><li><a href=https://github.com/Cycbloom target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#-åˆå§‹åŒ–>ğŸ¬ åˆå§‹åŒ–</a><ol><li><a href=#-åˆå§‹åŒ–è¿‡ç¨‹è¯¦è§£>ğŸ”§ åˆå§‹åŒ–è¿‡ç¨‹è¯¦è§£</a></li><li><a href=#-é¡¹ç›®ç»“æ„è§„èŒƒ>ğŸ“‚ é¡¹ç›®ç»“æ„è§„èŒƒ</a></li></ol></li><li><a href=#-åç«¯-mvp>ğŸš€ åç«¯ MVP</a><ol><li><a href=#-æ ¸å¿ƒé…ç½®>âš™ï¸ æ ¸å¿ƒé…ç½®</a></li><li><a href=#-å®ç°æ ¸å¿ƒæ¨¡å—>ğŸ§© å®ç°æ ¸å¿ƒæ¨¡å—</a></li><li><a href=#-å¥åº·æ£€æŸ¥ç«¯ç‚¹-srchealthhealthcontrollerts>ğŸ©º å¥åº·æ£€æŸ¥ç«¯ç‚¹ (src/health/health.controller.ts)</a></li><li><a href=#-è°ƒæ•´å…¥å£æ–‡ä»¶-srcmaints>ğŸ”§ è°ƒæ•´å…¥å£æ–‡ä»¶ (src/main.ts)</a></li><li><a href=#-éªŒè¯æ­¥éª¤>âœ… éªŒè¯æ­¥éª¤</a></li><li><a href=#-æ¨èå·¥å…·é“¾>ğŸ› ï¸ æ¨èå·¥å…·é“¾</a></li></ol></li><li><a href=#-å®¹å™¨åŒ–éƒ¨ç½²>ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²</a><ol><li><a href=#-æ–‡ä»¶ç»“æ„é¢„è§ˆ>ğŸ“ æ–‡ä»¶ç»“æ„é¢„è§ˆ</a></li><li><a href=#-å‰ç«¯é•œåƒé…ç½®-frontenddockerfileprod>ğŸ–¥ï¸ å‰ç«¯é•œåƒé…ç½® (frontend/Dockerfile.prod)</a></li><li><a href=#-åç«¯é•œåƒé…ç½®-backenddockerfileprod>ğŸ—„ï¸ åç«¯é•œåƒé…ç½® (backend/Dockerfile.prod)</a></li><li><a href=#-æ•°æ®åº“åˆå§‹åŒ–-infradockermongoinit-mongojs>ğŸ§© æ•°æ®åº“åˆå§‹åŒ– (infra/docker/mongo/init-mongo.js)</a></li><li><a href=#-nginx-é…ç½®-infradockernginxtacticoreconf>ğŸŒ Nginx é…ç½® (infra/docker/nginx/tacticore.conf)</a></li><li><a href=#-docker-compose-ç¼–æ’>ğŸ› docker-compose ç¼–æ’</a></li><li><a href=#-å¯åŠ¨å‘½ä»¤>ğŸš€ å¯åŠ¨å‘½ä»¤</a></li></ol></li><li><a href=#-docker-çƒ­æ›´æ–°>âš¡ Docker çƒ­æ›´æ–°</a><ol><li><a href=#-å‰ç«¯çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ>ğŸ–¥ï¸ å‰ç«¯çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ</a><ol><li><a href=#è°ƒæ•´å‰ç«¯-dockerfile>è°ƒæ•´å‰ç«¯ Dockerfile</a></li><li><a href=#æ·»åŠ -docker-composedevyml>æ·»åŠ  docker-compose.dev.yml</a></li><li><a href=#é…ç½®-vite-å¼€å‘æœåŠ¡å™¨>é…ç½® Vite å¼€å‘æœåŠ¡å™¨</a></li></ol></li><li><a href=#-å‰ç«¯çƒ­æ›´æ–°å·¥ä½œåŸç†>ğŸ”„ å‰ç«¯çƒ­æ›´æ–°å·¥ä½œåŸç†</a></li><li><a href=#-å‰ç«¯çƒ­æ›´æ–°éªŒè¯>âœ… å‰ç«¯çƒ­æ›´æ–°éªŒè¯</a></li><li><a href=#-åç«¯çƒ­é‡è½½å®Œæ•´è§£å†³æ–¹æ¡ˆ>ğŸ—„ï¸ åç«¯çƒ­é‡è½½å®Œæ•´è§£å†³æ–¹æ¡ˆ</a><ol><li><a href=#æ‹†åˆ†åç«¯-dockerfile>æ‹†åˆ†åç«¯ Dockerfile</a></li><li><a href=#è°ƒæ•´-docker-compose-é…ç½®>è°ƒæ•´ docker-compose é…ç½®</a></li><li><a href=#nodemon-é…ç½®>nodemon é…ç½®</a></li></ol></li><li><a href=#-åç«¯çƒ­é‡è½½éªŒè¯>âœ… åç«¯çƒ­é‡è½½éªŒè¯</a></li><li><a href=#-ä¸€é”®å¯åŠ¨æ–¹æ¡ˆ>ğŸš€ ä¸€é”®å¯åŠ¨æ–¹æ¡ˆ</a><ol><li><a href=#ç”Ÿäº§ç¯å¢ƒ>ç”Ÿäº§ç¯å¢ƒ</a></li><li><a href=#å¼€å‘ç¯å¢ƒå®Œæ•´çƒ­æ›´æ–°>å¼€å‘ç¯å¢ƒï¼ˆå®Œæ•´çƒ­æ›´æ–°ï¼‰</a></li></ol></li></ol></li><li><a href=#-é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ>ğŸš¨ é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</a><ol><li><a href=#-ç”¨æˆ·å’Œå¯†ç ç®¡ç†é—®é¢˜>ğŸ” ç”¨æˆ·å’Œå¯†ç ç®¡ç†é—®é¢˜</a><ol><li><a href=#ç”¨æˆ·å’Œå¯†ç å®šä¹‰å…³ç³»>ç”¨æˆ·å’Œå¯†ç å®šä¹‰å…³ç³»</a></li><li><a href=#ä¿®æ”¹ç”¨æˆ·å¯†ç >ä¿®æ”¹ç”¨æˆ·å¯†ç </a></li><li><a href=#å®‰å…¨å»ºè®®>å®‰å…¨å»ºè®®</a></li></ol></li><li><a href=#-docker-æ„å»ºå‰ç«¯é•œåƒæ—¶æ‰¾ä¸åˆ°-nginx-é…ç½®æ–‡ä»¶é—®é¢˜>ğŸ“‚ Docker æ„å»ºå‰ç«¯é•œåƒæ—¶æ‰¾ä¸åˆ° Nginx é…ç½®æ–‡ä»¶é—®é¢˜</a><ol><li><a href=#é”™è¯¯åŸå› >é”™è¯¯åŸå› </a></li><li><a href=#è§£å†³æ–¹æ¡ˆ>è§£å†³æ–¹æ¡ˆ</a></li></ol></li><li><a href=#-ç¯å¢ƒå˜é‡åŠ è½½é—®é¢˜>ğŸ“Œ ç¯å¢ƒå˜é‡åŠ è½½é—®é¢˜</a><ol><li><a href=#docker-compose-çš„ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§é—®é¢˜>Docker Compose çš„ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§é—®é¢˜</a></li><li><a href=#è§£å†³æ–¹æ¡ˆ-1>è§£å†³æ–¹æ¡ˆ</a></li></ol></li></ol></li><li><a href=#-é€šç”¨é…ç½®>âš™ï¸ é€šç”¨é…ç½®</a><ol><li><a href=#-ç»Ÿä¸€ç¼–è¾‘å™¨è§„èŒƒeditorconfig>ğŸ› ï¸ ç»Ÿä¸€ç¼–è¾‘å™¨è§„èŒƒï¼ˆ.editorconfigï¼‰</a></li><li><a href=#-git-æäº¤æ¨¡æ¿gitmessage>ğŸ“ Git æäº¤æ¨¡æ¿ï¼ˆ.gitmessageï¼‰</a></li><li><a href=#-git-å±æ€§é…ç½®gitattributes>ğŸ” Git å±æ€§é…ç½®ï¼ˆ.gitattributesï¼‰</a></li><li><a href=#-åŸºç¡€-eslint-é…ç½®eslintconfigmjs>ğŸš¨ åŸºç¡€ ESLint é…ç½®ï¼ˆeslint.config.mjsï¼‰</a></li><li><a href=#-prettier-æ ¼å¼åŒ–é…ç½®prettierrc>ğŸ¨ Prettier æ ¼å¼åŒ–é…ç½®ï¼ˆ.prettierrcï¼‰</a></li><li><a href=#-husky-æäº¤è§„èŒƒhusky>ğŸ¶ Husky æäº¤è§„èŒƒï¼ˆ.husky/ï¼‰</a><ol><li><a href=#å®‰è£…ä¾èµ–><strong>å®‰è£…ä¾èµ–</strong></a></li><li><a href=#ä¿®æ”¹><strong>ä¿®æ”¹<code>package.json</code></strong></a></li><li><a href=#ä¿®æ”¹-1><strong>ä¿®æ”¹<code>.husky/pre-commit</code></strong></a></li></ol></li><li><a href=#-åŸºç¡€ç¯å¢ƒæ¨¡æ¿envexample>ğŸŒ± åŸºç¡€ç¯å¢ƒæ¨¡æ¿ï¼ˆ.env.exampleï¼‰</a></li><li><a href=#ä»£ç åˆ«åè®¾ç½®>ä»£ç åˆ«åè®¾ç½®</a><ol><li><a href=#vite-é…ç½®><strong>Vite é…ç½®</strong></a></li><li><a href=#typescript-é…ç½®åœ¨æ‰€æœ‰-tsconfigjson-ç›¸å…³æ–‡ä»¶ä¸­><strong>TypeScript é…ç½®ï¼ˆåœ¨æ‰€æœ‰ tsconfig.json ç›¸å…³æ–‡ä»¶ä¸­ï¼‰</strong></a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/hugo-to-my-blog/chapter1/>Chapter1: é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„æ­å»º</a></h2><h3 class=article-subtitle>ğŸ“¦ ä»é›¶å¼€å§‹æ­å»ºå…¨æ ˆåšå®¢ç³»ç»Ÿçš„åŸºç¡€æ¶æ„</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 11, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 17 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=-åˆå§‹åŒ–>ğŸ¬ åˆå§‹åŒ–</h2><h3 id=-åˆå§‹åŒ–è¿‡ç¨‹è¯¦è§£>ğŸ”§ åˆå§‹åŒ–è¿‡ç¨‹è¯¦è§£</h3><p>1ï¸âƒ£ <strong>ç‰ˆæœ¬æ§åˆ¶åˆå§‹åŒ–</strong><br>ğŸ“¦ ä½¿ç”¨ <code>git init</code> åˆå§‹åŒ– Git ä»“åº“<br>ğŸš« åˆ›å»º <code>.gitignore</code> æ–‡ä»¶æ’é™¤ä»¥ä¸‹å†…å®¹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>node_modules/  <span class=c1># ç¬¬ä¸‰æ–¹ä¾èµ–</span>
</span></span><span class=line><span class=cl>.env           <span class=c1># æ•æ„Ÿé…ç½®</span>
</span></span><span class=line><span class=cl>.DS_Store      <span class=c1># Macç³»ç»Ÿæ–‡ä»¶</span>
</span></span><span class=line><span class=cl>*.log          <span class=c1># æ—¥å¿—æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>dist/          <span class=c1># æ„å»ºäº§ç‰©</span>
</span></span><span class=line><span class=cl>coverage/      <span class=c1># æµ‹è¯•æŠ¥å‘Š</span>
</span></span></code></pre></td></tr></table></div></div><p>2ï¸âƒ£ <strong>å‰ç«¯è„šæ‰‹æ¶æ­å»º</strong><br>âš¡ é€šè¿‡ Vite å¿«é€Ÿç”Ÿæˆé¡¹ç›®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm create vite@latest
</span></span></code></pre></td></tr></table></div></div><p>â–¸ é¡¹ç›®åç§°ï¼š<code>frontend</code><br>â–¸ æ¡†æ¶é€‰æ‹©ï¼š<code>React</code> + <code>TypeScript</code><br>ğŸ’¡ ä¼˜åŠ¿ï¼šç»„ä»¶åŒ–å¼€å‘ + ç±»å‹å®‰å…¨</p><p>3ï¸âƒ£ <strong>æ ¸å¿ƒä¾èµ–å®‰è£…</strong><br>ğŸ”Œ è¿›å…¥é¡¹ç›®ç›®å½•æ‰§è¡Œå®‰è£…ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> frontend <span class=o>&amp;&amp;</span> npm install
</span></span></code></pre></td></tr></table></div></div><p>ğŸ“š å…³é”®ä¾èµ–è¯´æ˜ï¼š</p><div class=table-wrapper><table><thead><tr><th>ä¾èµ–åŒ…</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>@mui/material</code></td><td>Material Design ç»„ä»¶åº“</td></tr><tr><td><code>react-router-dom</code></td><td>SPA è·¯ç”±ç®¡ç†</td></tr><tr><td><code>@reduxjs/toolkit</code></td><td>çŠ¶æ€ç®¡ç†å·¥å…·</td></tr><tr><td><code>axios</code></td><td>HTTP å®¢æˆ·ç«¯</td></tr></tbody></table></div><p>4ï¸âƒ£ <strong>åç«¯æœåŠ¡åˆå§‹åŒ–</strong><br>ğŸ› ï¸ åˆ›å»º NestJS é¡¹ç›®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir backend <span class=o>&amp;&amp;</span> <span class=nb>cd</span> backend
</span></span><span class=line><span class=cl>npm install -g @nestjs/cli
</span></span><span class=line><span class=cl>nest new . --package-manager npm
</span></span></code></pre></td></tr></table></div></div><h3 id=-é¡¹ç›®ç»“æ„è§„èŒƒ>ğŸ“‚ é¡¹ç›®ç»“æ„è§„èŒƒ</h3><p>é¡¹ç›®ç»“æ„çš„åˆç†è§„åˆ’å¯¹äºé¡¹ç›®çš„é•¿æœŸç»´æŠ¤å’Œæ‰©å±•ååˆ†å…³é”®ã€‚æˆ‘ä»¬çš„å…¨æ ˆåšå®¢ç³»ç»Ÿé‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>TactiCore/
</span></span><span class=line><span class=cl>â”œâ”€â”€ .github/                   # GitHub é…ç½®
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ workflows/             # CI/CD æµæ°´çº¿
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ ISSUE_TEMPLATE/        # Issue æ¨¡æ¿
</span></span><span class=line><span class=cl>â”œâ”€â”€ frontend/                  # å‰ç«¯ (Vite + React)
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ public/
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ favicons/          # å¤šå°ºå¯¸ç½‘ç«™å›¾æ ‡
</span></span><span class=line><span class=cl>â”‚   â”‚   â””â”€â”€ robots.txt
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ src/
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ api/               # API è¯·æ±‚å°è£…
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ assets/            # é™æ€èµ„æº
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ fonts/
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ images/
</span></span><span class=line><span class=cl>â”‚       â”‚   â””â”€â”€ styles/        # å…¨å±€æ ·å¼
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ components/        # ç»„ä»¶åº“
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ ui/            # åŸå­ç»„ä»¶
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ shared/        # ä¸šåŠ¡ç»„ä»¶
</span></span><span class=line><span class=cl>â”‚       â”‚   â””â”€â”€ providers/     # Context æä¾›è€…
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ features/          # Redux Toolkit æ¨¡å—
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ layouts/           # é¡µé¢å¸ƒå±€
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ locales/           # å›½é™…åŒ–
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ en/
</span></span><span class=line><span class=cl>â”‚       â”‚   â””â”€â”€ zh/
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ pages/             # è·¯ç”±é¡µé¢
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ stores/            # çŠ¶æ€ç®¡ç†
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ test/              # æµ‹è¯•å¥—ä»¶
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ e2e/           # ç«¯åˆ°ç«¯æµ‹è¯•
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ integration/
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ unit/
</span></span><span class=line><span class=cl>â”‚       â”‚   â””â”€â”€ mocks/         # Mock æ•°æ®
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ theme/             # ä¸»é¢˜ç³»ç»Ÿ
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ dark/
</span></span><span class=line><span class=cl>â”‚       â”‚   â””â”€â”€ light/
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ types/             # TS ç±»å‹å®šä¹‰
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ helpers/
</span></span><span class=line><span class=cl>â”‚       â”‚   â”œâ”€â”€ validation/
</span></span><span class=line><span class=cl>â”‚       â”‚   â””â”€â”€ performance/   # æ€§èƒ½ç›‘æ§
</span></span><span class=line><span class=cl>â”‚       â””â”€â”€ main.tsx
</span></span><span class=line><span class=cl>â”œâ”€â”€ backend/                   # åç«¯ (NestJS + MongoDB)
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ src/
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ app.module.ts      # æ ¹æ¨¡å—
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ main.ts            # å…¥å£æ–‡ä»¶
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒæ¨¡å—
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ config/        # ç¯å¢ƒé…ç½®
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.module.ts
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/    # å…¨å±€å¼‚å¸¸å¤„ç†
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â””â”€â”€ decorators/    # è‡ªå®šä¹‰è£…é¥°å™¨
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ database/          # æ•°æ®åº“æ¨¡å—
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ database.module.ts
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â””â”€â”€ schemas/       # MongoDB Schema
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ users/             # ç”¨æˆ·æ¨¡å—ç¤ºä¾‹
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ dto/           # æ•°æ®ä¼ è¾“å¯¹è±¡
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ entities/      # æ•°æ®åº“å®ä½“
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ users.module.ts
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ users.service.ts
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â””â”€â”€ users.controller.ts
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ common/            # é€šç”¨å·¥å…·
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ filters/       # å¼‚å¸¸è¿‡æ»¤å™¨
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ interceptors/  # æ‹¦æˆªå™¨
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â””â”€â”€ pipes/         # æ•°æ®ç®¡é“
</span></span><span class=line><span class=cl>â”‚   â”‚   â””â”€â”€ health/            # å¥åº·æ£€æŸ¥æ¨¡å—
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ test/                  # æµ‹è¯•å¥—ä»¶
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ e2e/              # ç«¯åˆ°ç«¯æµ‹è¯•
</span></span><span class=line><span class=cl>â”‚   â”‚   â””â”€â”€ unit/             # å•å…ƒæµ‹è¯•
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ docker/               # Docker é…ç½®
</span></span><span class=line><span class=cl>â”‚   â”‚   â””â”€â”€ entrypoint.sh     # å®¹å™¨å¯åŠ¨è„šæœ¬
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ nest-cli.json         # Nest CLI é…ç½®
</span></span><span class=line><span class=cl>â”œâ”€â”€ docs/                     # æ–‡æ¡£ä¸­å¿ƒ
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ api.md               # API æ–‡æ¡£
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ architecture.md      # æ¶æ„è®¾è®¡
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ setup.md             # ç¯å¢ƒé…ç½®
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ CHANGELOG.md         # æ›´æ–°æ—¥å¿—
</span></span><span class=line><span class=cl>â”œâ”€â”€ infra/                   # åŸºç¡€è®¾æ–½
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ docker/              # Docker é…ç½®
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ nginx/
</span></span><span class=line><span class=cl>â”‚   â”‚   â””â”€â”€ mongo/
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ k8s/                 # Kubernetes é…ç½®
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ monitoring/          # ç›‘æ§é…ç½®
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ prometheus/
</span></span><span class=line><span class=cl>â”‚       â””â”€â”€ grafana/
</span></span><span class=line><span class=cl>â”œâ”€â”€ scripts/                 # è‡ªåŠ¨åŒ–è„šæœ¬
</span></span><span class=line><span class=cl>â”œâ”€â”€ .vscode/                 # IDE é…ç½®
</span></span><span class=line><span class=cl>â”œâ”€â”€ .husky/                  # Git hooks
</span></span><span class=line><span class=cl>â”œâ”€â”€ .editorconfig            # ç¼–è¾‘å™¨è§„èŒƒ
</span></span><span class=line><span class=cl>â”œâ”€â”€ .eslintrc                # ä»£ç æ£€æŸ¥
</span></span><span class=line><span class=cl>â”œâ”€â”€ .prettierrc              # ä»£ç æ ¼å¼åŒ–
</span></span><span class=line><span class=cl>â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡æ¨¡æ¿
</span></span><span class=line><span class=cl>â”œâ”€â”€ .gitattributes           # Git é…ç½®
</span></span><span class=line><span class=cl>â”œâ”€â”€ .gitmessage              # æäº¤ä¿¡æ¯æ¨¡æ¿
</span></span><span class=line><span class=cl>â”œâ”€â”€ docker-compose.yml       # å®¹å™¨ç¼–æ’
</span></span><span class=line><span class=cl>â”œâ”€â”€ package.json             # å…¨å±€è„šæœ¬
</span></span><span class=line><span class=cl>â”œâ”€â”€ CONTRIBUTING.md          # è´¡çŒ®æŒ‡å—
</span></span><span class=line><span class=cl>â””â”€â”€ README.md                # é¡¹ç›®æ€»è§ˆ
</span></span></code></pre></td></tr></table></div></div><p>é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¨¡å¼ï¼Œå‰ç«¯åŸºäº React+vite ç”Ÿæ€ï¼Œåç«¯ä½¿ç”¨ NestJS æ¡†æ¶ã€‚å‰ç«¯çš„<code>src</code>ç›®å½•ä¸­æ¶µç›–äº†ä»åŸºç¡€çš„ API å°è£…ã€é™æ€èµ„æºç®¡ç†ï¼Œåˆ°å¤æ‚çš„ç»„ä»¶åº“æ„å»ºã€çŠ¶æ€ç®¡ç†ä»¥åŠå›½é™…åŒ–ç­‰åŠŸèƒ½æ¨¡å—ã€‚åç«¯çš„<code>src</code>ç›®å½•åˆ™åŒ…å«äº†æ ¹æ¨¡å—ã€æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚ç¯å¢ƒé…ç½®ã€å¼‚å¸¸å¤„ç†ï¼‰ã€æ•°æ®åº“æ¨¡å—ã€ç”¨æˆ·æ¨¡å—ç¤ºä¾‹ä»¥åŠé€šç”¨å·¥å…·ç­‰ã€‚åˆç†çš„é¡¹ç›®ç»“æ„è®¾è®¡ä¸ºåç»­çš„å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ä»¥åŠç³»ç»Ÿæ‰©å±•éƒ½æä¾›äº†åšå®çš„åŸºç¡€ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ä¸ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p><h2 id=-åç«¯-mvp>ğŸš€ åç«¯ MVP</h2><p>åœ¨å®Œæˆç¬¬ä¸€éƒ¨åˆ†çš„é¡¹ç›®åˆå§‹åŒ–åï¼Œæˆ‘ä»¬ä¸ºå…¨æ ˆåšå®¢ç³»ç»Ÿæ­å»ºèµ·äº†åˆæ­¥æ¡†æ¶ï¼Œæ¥ä¸‹æ¥ä¾¿è¦è¿›å…¥åç«¯çš„ MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰å®ç°é˜¶æ®µï¼Œç€æ‰‹æ­å»ºåç«¯åŸºç¡€é¡¹ç›®ç»“æ„ï¼Œè¿™æ˜¯ä½¿åç«¯æœåŠ¡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œå¹¶æä¾›åŸºç¡€åŠŸèƒ½çš„å…³é”®ä¸€æ­¥ã€‚</p><h3 id=-æ ¸å¿ƒé…ç½®>âš™ï¸ æ ¸å¿ƒé…ç½®</h3><p>1ï¸âƒ£ <strong>å®‰è£…å¿…è¦ä¾èµ–</strong>ï¼šä¸ºäº†æ„å»ºåŠŸèƒ½å®Œå¤‡çš„åç«¯æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ç³»åˆ—å¿…è¦çš„ä¾èµ–åŒ…ã€‚</p><ul><li><code>@nestjs/mongoose</code>å’Œ<code>mongoose</code>ç”¨äºè¿æ¥å’Œæ“ä½œ MongoDB æ•°æ®åº“ï¼Œè¿™å¯¹äºå­˜å‚¨åšå®¢æ•°æ®è‡³å…³é‡è¦ã€‚</li><li><code>dotenv</code>èƒ½å¸®åŠ©æˆ‘ä»¬åŠ è½½ç¯å¢ƒå˜é‡ï¼Œä¾¿äºç®¡ç†ä¸åŒç¯å¢ƒä¸‹çš„é…ç½®ä¿¡æ¯ã€‚</li><li><code>class-validator</code>å’Œ<code>class-transformer</code>ç”¨äºæ•°æ®éªŒè¯å’Œè½¬æ¢ï¼Œä¿éšœæ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</li><li><code>@nestjs/config</code>ç”¨äºç®¡ç†åº”ç”¨çš„é…ç½®ï¼Œ<code>@nestjs/swagger</code>ç”¨äºç”Ÿæˆç¾è§‚ä¸”å®ç”¨çš„ API æ–‡æ¡£ï¼Œ<code>@nestjs/passport</code>å’Œ<code>passport-jwt</code>åˆ™ç”¨äºå®ç°åŸºäº JWT çš„èº«ä»½éªŒè¯åŠŸèƒ½ã€‚</li><li>å¼€å‘ç¯å¢ƒä¸‹ï¼Œå®‰è£…<code>@types/passport-jwt</code>ä»¥è·å–ç±»å‹å®šä¹‰ï¼Œæ–¹ä¾¿ TypeScript é¡¹ç›®å¼€å‘ã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install @nestjs/mongoose mongoose dotenv class-validator class-transformer
</span></span><span class=line><span class=cl>npm install @nestjs/config @nestjs/swagger @nestjs/passport passport-jwt
</span></span><span class=line><span class=cl>npm install --save-dev @types/passport-jwt
</span></span></code></pre></td></tr></table></div></div><p>2ï¸âƒ£ <strong>ç¯å¢ƒå˜é‡é…ç½® (.env)</strong>ï¼šåˆç†é…ç½®ç¯å¢ƒå˜é‡èƒ½ä½¿æˆ‘ä»¬çš„åç«¯æœåŠ¡é€‚åº”ä¸åŒçš„è¿è¡Œç¯å¢ƒã€‚åœ¨<code>.env</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†æœåŠ¡è¿è¡Œçš„ç«¯å£<code>PORT</code>ï¼Œè¿™é‡Œé»˜è®¤è®¾ä¸º<code>3000</code>ã€‚<code>MONGO_URI</code>ç”¨äºæŒ‡å®š MongoDB æ•°æ®åº“çš„è¿æ¥åœ°å€ï¼Œéœ€å¡«å…¥æ­£ç¡®çš„æ•°æ®åº“åœ°å€åŠç›¸å…³è®¤è¯ä¿¡æ¯ã€‚<code>JWT_SECRET</code>åˆ™æ˜¯ç”¨äº JWT èº«ä»½éªŒè¯çš„å¯†é’¥ï¼ŒåŠ¡å¿…å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>MONGO_URI</span><span class=o>=</span>mongodb://tacticore:pwd_tacticore@mongo:27017/tacticore?authSource<span class=o>=</span>admin
</span></span><span class=line><span class=cl><span class=nv>JWT_SECRET</span><span class=o>=</span>your_jwt_secret_here
</span></span></code></pre></td></tr></table></div></div><h3 id=-å®ç°æ ¸å¿ƒæ¨¡å—>ğŸ§© å®ç°æ ¸å¿ƒæ¨¡å—</h3><ol><li><p><strong>åˆ›å»ºåŸºç¡€æ¨¡å—ç»“æ„</strong>ï¼šåˆ©ç”¨ Nest CLI å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåˆ›å»ºåŸºç¡€æ¨¡å—ç»“æ„ã€‚<code>nest generate module core/config</code>ç”¨äºåˆ›å»ºé…ç½®æ¨¡å—ï¼Œç®¡ç†åº”ç”¨çš„å„ç§é…ç½®ä¿¡æ¯ï¼›<code>nest generate module database</code>åˆ›å»ºæ•°æ®åº“æ¨¡å—ï¼Œè´Ÿè´£ä¸æ•°æ®åº“çš„è¿æ¥å’Œäº¤äº’ï¼›<code>nest generate controller health</code>åˆ™åˆ›å»ºäº†å¥åº·æ£€æŸ¥æ§åˆ¶å™¨ï¼Œç”¨äºç›‘æ§åç«¯æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nest generate module core/config
</span></span><span class=line><span class=cl>nest generate module database
</span></span><span class=line><span class=cl>nest generate controller health
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>é…ç½®æ¨¡å— (src/core/config/config.module.ts)</strong>ï¼šåœ¨é…ç½®æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†<code>@nestjs/config</code>æ¨¡å—ï¼Œå¹¶ä½¿ç”¨<code>Joi</code>åº“å¯¹ç¯å¢ƒå˜é‡è¿›è¡ŒéªŒè¯ã€‚<code>Joi</code>æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript æ•°æ®éªŒè¯åº“ï¼Œåœ¨ NestJS ä¸­å¸¸ä¸<code>@nestjs/config</code>ç»“åˆä½¿ç”¨ã€‚é¦–å…ˆéœ€è¦å®‰è£…<code>joi</code>åŠå…¶ç±»å‹å®šä¹‰ï¼ˆTypeScript é¡¹ç›®éœ€è¦ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install joi @types/joi
</span></span></code></pre></td></tr></table></div></div><p>å®‰è£…å®Œæˆåï¼Œåœ¨é…ç½®æ¨¡å—ä¸­å¼•å…¥å¹¶å®šä¹‰éªŒè¯è§„åˆ™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// src/config/config.module.ts
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>Module</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/common&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ConfigModule</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/config&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=kr>as</span> <span class=nx>Joi</span> <span class=kr>from</span> <span class=s2>&#34;joi&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Module</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>ConfigModule</span><span class=p>.</span><span class=nx>forRoot</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>isGlobal</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>envFilePath</span><span class=o>:</span> <span class=s2>&#34;.env&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>validationSchema</span>: <span class=kt>Joi.object</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>PORT</span>: <span class=kt>Joi.number</span><span class=p>().</span><span class=k>default</span><span class=p>(</span><span class=mi>3000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>MONGO_URI</span>: <span class=kt>Joi.string</span><span class=p>().</span><span class=nx>required</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>JWT_SECRET</span>: <span class=kt>Joi.string</span><span class=p>().</span><span class=nx>min</span><span class=p>(</span><span class=mi>16</span><span class=p>).</span><span class=nx>required</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>NODE_ENV</span>: <span class=kt>Joi.string</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>valid</span><span class=p>(</span><span class=s2>&#34;development&#34;</span><span class=p>,</span> <span class=s2>&#34;production&#34;</span><span class=p>,</span> <span class=s2>&#34;test&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=k>default</span><span class=p>(</span><span class=s2>&#34;development&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=p>}),</span>
</span></span><span class=line><span class=cl>      <span class=nx>validationOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>allowUnknown</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>abortEarly</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>exports</span><span class=o>:</span> <span class=p>[</span><span class=nx>ConfigModule</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ConfigurationModule</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œçš„éªŒè¯è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><code>Joi.number().default(3000)</code>ï¼šè¡¨ç¤º<code>PORT</code>å¿…é¡»æ˜¯æ•°å­—ï¼Œé»˜è®¤å€¼ä¸º<code>3000</code>ã€‚</li><li><code>Joi.string().required()</code>ï¼šè¯´æ˜<code>MONGO_URI</code>æ˜¯å¿…å¡«çš„å­—ç¬¦ä¸²ã€‚</li><li><code>Joi.string().min(16)</code>ï¼šè¦æ±‚<code>JWT_SECRET</code>æ˜¯æœ€å°é•¿åº¦ä¸º<code>16</code>çš„å­—ç¬¦ä¸²ã€‚</li><li><code>Joi.string().valid(...)</code>ï¼šé™å®š<code>NODE_ENV</code>åªèƒ½æ˜¯<code>development</code>ã€<code>production</code>ã€<code>test</code>ä¸­çš„ä¸€ä¸ªï¼Œé»˜è®¤å€¼ä¸º<code>development</code>ã€‚
å¦‚æœ<code>.env</code>æ–‡ä»¶ç¼ºå°‘<code>MONGO_URI</code>æˆ–<code>JWT_SECRET</code>ç­‰å¿…å¡«é¡¹ï¼Œå¯åŠ¨æ—¶å°±ä¼šæŠ¥é”™ï¼Œä¾‹å¦‚ï¼š</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Error: Config validation error: &#34;MONGO_URI&#34; is required
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>æ•°æ®åº“æ¨¡å— (src/database/database.module.ts)</strong>ï¼šæ•°æ®åº“æ¨¡å—è´Ÿè´£è¿æ¥åˆ° MongoDB æ•°æ®åº“ã€‚é€šè¿‡<code>MongooseModule.forRootAsync</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè¿™é‡Œä»ç¯å¢ƒå˜é‡<code>process.env.MONGO_URI</code>ä¸­è·å–è¿æ¥åœ°å€ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Module</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/common&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>MongooseModule</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/mongoose&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Module</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>MongooseModule</span><span class=p>.</span><span class=nx>forRootAsync</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>useFactory</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>uri</span>: <span class=kt>process.env.MONGO_URI</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>DatabaseModule</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=-å¥åº·æ£€æŸ¥ç«¯ç‚¹-srchealthhealthcontrollerts>ğŸ©º å¥åº·æ£€æŸ¥ç«¯ç‚¹ (src/health/health.controller.ts)</h3><ol><li><p><strong>å¥åº·æ£€æŸ¥ç«¯ç‚¹</strong>ï¼šå¥åº·æ£€æŸ¥ç«¯ç‚¹ç”¨äºæ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚é€šè¿‡<code>@Controller('health')</code>è£…é¥°å™¨å®šä¹‰äº†æ§åˆ¶å™¨çš„è·¯ç”±å‰ç¼€ä¸º<code>health</code>ã€‚<code>@Get()</code>è£…é¥°å™¨è¡¨ç¤ºè¯¥æ–¹æ³•å¤„ç† HTTP GET è¯·æ±‚ï¼Œ<code>@ApiOperation</code>å’Œ<code>@ApiResponse</code>è£…é¥°å™¨ç”¨äºåœ¨ Swagger æ–‡æ¡£ä¸­æè¿°è¯¥æ¥å£çš„åŠŸèƒ½å’Œå“åº”ä¿¡æ¯ã€‚å½“è®¿é—®<code>/health</code>ç«¯ç‚¹æ—¶ï¼Œä¼šè¿”å›æœåŠ¡çš„çŠ¶æ€å’Œå½“å‰æ—¶é—´æˆ³ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Controller</span><span class=p>,</span> <span class=nx>Get</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/common&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ApiOperation</span><span class=p>,</span> <span class=nx>ApiResponse</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/swagger&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Controller</span><span class=p>(</span><span class=s2>&#34;health&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>HealthController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ApiOperation</span><span class=p>({</span> <span class=nx>summary</span><span class=o>:</span> <span class=s2>&#34;æœåŠ¡å¥åº·æ£€æŸ¥&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ApiResponse</span><span class=p>({</span> <span class=nx>status</span>: <span class=kt>200</span><span class=p>,</span> <span class=nx>description</span><span class=o>:</span> <span class=s2>&#34;æœåŠ¡è¿è¡Œæ­£å¸¸&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>checkHealth() {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s2>&#34;UP&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>timestamp</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=-è°ƒæ•´å…¥å£æ–‡ä»¶-srcmaints>ğŸ”§ è°ƒæ•´å…¥å£æ–‡ä»¶ (src/main.ts)</h3><p>åœ¨å…¥å£æ–‡ä»¶<code>src/main.ts</code>ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† Nest åº”ç”¨å®ä¾‹ï¼Œå¹¶ä½¿ç”¨<code>app.useGlobalPipes</code>æ–¹æ³•å¯ç”¨äº†å…¨å±€éªŒè¯ç®¡é“ã€‚è¯¥ç®¡é“é…ç½®äº†<code>whitelist: true</code>ï¼Œè¡¨ç¤ºåªæ¥å—éªŒè¯é€šè¿‡çš„å±æ€§ï¼Œ<code>forbidNonWhitelisted: true</code>åˆ™ç¦æ­¢æ¥å—æœªé€šè¿‡éªŒè¯çš„å±æ€§ï¼Œä»è€Œç¡®ä¿è¾“å…¥æ•°æ®çš„åˆæ³•æ€§ã€‚æœ€åï¼Œåº”ç”¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œå¹¶åœ¨æ§åˆ¶å°è¾“å‡ºåº”ç”¨è¿è¡Œçš„åœ°å€ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>NestFactory</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/core&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>AppModule</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;./app.module&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ValidationPipe</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@nestjs/common&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>bootstrap() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>NestFactory</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>AppModule</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// å…¨å±€éªŒè¯ç®¡é“
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>app</span><span class=p>.</span><span class=nx>useGlobalPipes</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>ValidationPipe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>whitelist</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>forbidNonWhitelisted</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Application running on: </span><span class=si>${</span><span class=k>await</span> <span class=nx>app</span><span class=p>.</span><span class=nx>getUrl</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>bootstrap</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-éªŒè¯æ­¥éª¤>âœ… éªŒè¯æ­¥éª¤</h3><p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p><ol><li><strong>è¿è¡Œæµ‹è¯•</strong>ï¼šæ‰§è¡Œ<code>npm run test</code>å‘½ä»¤ï¼Œè¿è¡Œé¡¹ç›®ä¸­çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿å„ä¸ªæ¨¡å—çš„åŠŸèƒ½ç¬¦åˆé¢„æœŸã€‚</li><li><strong>å¯åŠ¨å¼€å‘æ¨¡å¼</strong>ï¼šä½¿ç”¨<code>npm run start:dev</code>å‘½ä»¤ï¼Œä»¥å¼€å‘æ¨¡å¼å¯åŠ¨åç«¯æœåŠ¡ï¼Œä¾¿äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­å®æ—¶æŸ¥çœ‹ä»£ç å˜æ›´å¸¦æ¥çš„æ•ˆæœã€‚</li><li><strong>éªŒè¯ç«¯ç‚¹</strong>ï¼šé€šè¿‡<code>curl http://localhost:3000/health</code>å‘½ä»¤ï¼Œå‘å¥åº·æ£€æŸ¥ç«¯ç‚¹å‘é€è¯·æ±‚ï¼ŒéªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚å¦‚æœæœåŠ¡æ­£å¸¸ï¼Œå°†è¿”å›ç±»ä¼¼å¦‚ä¸‹çš„ç»“æœï¼š</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;UP&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-04-11T12:00:00.000Z&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-æ¨èå·¥å…·é“¾>ğŸ› ï¸ æ¨èå·¥å…·é“¾</h3><p>ä¸ºäº†è¿›ä¸€æ­¥æå‡åç«¯å¼€å‘æ•ˆç‡å’ŒæœåŠ¡è´¨é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€äº›å·¥å…·ï¼š</p><div class=table-wrapper><table><thead><tr><th>å·¥å…·</th><th>ç”¨é€”</th><th>å®‰è£…å‘½ä»¤</th></tr></thead><tbody><tr><td>NestJS Swagger</td><td>API æ–‡æ¡£ç”Ÿæˆ</td><td><code>npm install @nestjs/swagger</code></td></tr><tr><td>NestJS CQRS</td><td>å¤æ‚ä¸šåŠ¡é€»è¾‘ç®¡ç†</td><td><code>npm install @nestjs/cqrs</code></td></tr><tr><td>NestJS Cache</td><td>ç¼“å­˜ç®¡ç†</td><td><code>npm install @nestjs/cache-manager</code></td></tr><tr><td>Jest</td><td>å•å…ƒæµ‹è¯•</td><td>å†…ç½®</td></tr><tr><td>Compodoc</td><td>é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ</td><td><code>npm install @compodoc/compodoc</code></td></tr></tbody></table></div><p>NestJS Swagger å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„ API æ–‡æ¡£ï¼Œæ–¹ä¾¿å›¢é˜Ÿåä½œå’Œæ¥å£è°ƒè¯•ï¼›NestJS CQRS æœ‰åŠ©äºç®¡ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼›NestJS Cache ç”¨äºç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼›Jest ä½œä¸ºå†…ç½®çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œèƒ½å¤Ÿä¿è¯ä»£ç è´¨é‡ï¼›Compodoc åˆ™å¯ä»¥ç”Ÿæˆå…¨é¢çš„é¡¹ç›®æ–‡æ¡£ï¼Œæ–¹ä¾¿å›¢é˜Ÿæˆå‘˜äº†è§£é¡¹ç›®ç»“æ„å’ŒåŠŸèƒ½ã€‚</p><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬åˆæ­¥å®Œæˆäº†åç«¯çš„ MVP å®ç°ï¼Œæ­å»ºèµ·äº†åŸºç¡€é¡¹ç›®ç»“æ„ï¼Œä¸ºåç»­æ·»åŠ æ›´å¤šä¸šåŠ¡åŠŸèƒ½å¥ å®šäº†åšå®åŸºç¡€ã€‚</p><h2 id=-å®¹å™¨åŒ–éƒ¨ç½²>ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²</h2><p>åœ¨å®Œæˆç¬¬äºŒéƒ¨åˆ†åç«¯åŸºç¡€é¡¹ç›®ç»“æ„æ­å»ºåï¼Œä¸ºäº†å®ç°é¡¹ç›®çš„å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºåœ¨ä¸åŒç¯å¢ƒä¸­å¿«é€Ÿã€ç¨³å®šåœ°è¿è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Docker é…ç½®ç›¸å…³å†…å®¹ã€‚Docker èƒ½å¤Ÿå°†åº”ç”¨åŠå…¶ä¾èµ–æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„é•œåƒï¼Œç¡®ä¿åœ¨ä»»ä½•ç¯å¢ƒä¸­éƒ½èƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Œå¤§å¤§æå‡äº†é¡¹ç›®éƒ¨ç½²çš„æ•ˆç‡å’Œä¸€è‡´æ€§ã€‚</p><h3 id=-æ–‡ä»¶ç»“æ„é¢„è§ˆ>ğŸ“ æ–‡ä»¶ç»“æ„é¢„è§ˆ</h3><p>æ ¹æ®é¡¹ç›®ç»“æ„è§„åˆ’ï¼ŒDocker ç›¸å…³é…ç½®ä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹ä½ç½®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>TactiCore/
</span></span><span class=line><span class=cl>â”œâ”€â”€ infra/
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ docker/
</span></span><span class=line><span class=cl>â”‚   â”‚   â”œâ”€â”€ nginx/
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â”œâ”€â”€ nginx.conf          # Nginx ä¸»é…ç½®
</span></span><span class=line><span class=cl>â”‚   â”‚   â”‚   â””â”€â”€ tacticore.conf      # é¡¹ç›®ä¸“ç”¨é…ç½®
</span></span><span class=line><span class=cl>â”‚   â”‚   â””â”€â”€ mongo/
</span></span><span class=line><span class=cl>â”‚   â”‚       â””â”€â”€ init-mongo.js       # MongoDB åˆå§‹åŒ–è„šæœ¬
</span></span><span class=line><span class=cl>â”œâ”€â”€ docker-compose.yml               # ä¸»ç¼–æ’æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ frontend/
</span></span><span class=line><span class=cl>|       â”œâ”€â”€ Dockerfile.prod                # å‰ç«¯é•œåƒé…ç½®
</span></span><span class=line><span class=cl>|       â””â”€â”€ Dockerfile.dev
</span></span><span class=line><span class=cl>â””â”€â”€ backend/
</span></span><span class=line><span class=cl>        â”œâ”€â”€ Dockerfile.prod                # åç«¯é•œåƒé…ç½®
</span></span><span class=line><span class=cl>        â””â”€â”€Dockerfile.dev
</span></span></code></pre></td></tr></table></div></div><p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»å…·ä½“çš„é…ç½®æ­¥éª¤ï¼š</p><h3 id=-å‰ç«¯é•œåƒé…ç½®-frontenddockerfileprod>ğŸ–¥ï¸ å‰ç«¯é•œåƒé…ç½® (frontend/Dockerfile.prod)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># frontend/Dockerfile.prod</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ================= æ„å»ºé˜¶æ®µ =================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> frontend/package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> frontend/ .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ================= ç”Ÿäº§é˜¶æ®µ =================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> nginx:alpine AS prod</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/dist /usr/share/nginx/html<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> infra/docker/nginx/tacticore.conf /etc/nginx/conf.d/default.conf<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 80</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;nginx&#34;</span><span class=p>,</span> <span class=s2>&#34;-g&#34;</span><span class=p>,</span> <span class=s2>&#34;daemon off;&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><strong>æ„å»ºé˜¶æ®µ</strong>ï¼šåŸºäº<code>node:22-alpine</code>é•œåƒåˆ›å»ºä¸€ä¸ªåä¸º<code>builder</code>çš„æ„å»ºé˜¶æ®µã€‚è®¾ç½®å·¥ä½œç›®å½•ä¸º<code>/app</code>ï¼Œå°†å‰ç«¯é¡¹ç›®çš„<code>package*.json</code>æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œæ‰§è¡Œ<code>npm ci</code>å®‰è£…ä¾èµ–ã€‚è¿™é‡Œä½¿ç”¨<code>npm ci</code>è€Œé<code>npm install</code>ï¼Œ<code>npm ci</code>æ˜¯ä¸“é—¨ä¸ºè‡ªåŠ¨åŒ–ç¯å¢ƒè®¾è®¡çš„ä¾èµ–å®‰è£…å‘½ä»¤ï¼Œå®ƒä¸¥æ ¼æŒ‰ç…§<code>package-lock.json</code>çš„ç‰ˆæœ¬å®‰è£…ä¾èµ–ï¼Œä¸ä¿®æ”¹ä»»ä½•æ–‡ä»¶ï¼Œèƒ½ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒçš„ä¾èµ–å®Œå…¨ä¸€è‡´ï¼Œé¿å…â€œåœ¨æˆ‘æœºå™¨ä¸Šæ˜¯å¥½çš„â€é—®é¢˜ï¼ŒåŒæ—¶æ˜¾è‘—åŠ å¿« Docker é•œåƒæ„å»ºé€Ÿåº¦ã€‚æ¥ç€å°†æ•´ä¸ªå‰ç«¯é¡¹ç›®å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¹¶æ‰§è¡Œ<code>npm run build</code>è¿›è¡Œé¡¹ç›®æ„å»ºã€‚</li><li><strong>ç”Ÿäº§é˜¶æ®µ</strong>ï¼šåŸºäº<code>nginx:alpine</code>é•œåƒåˆ›å»ºç”Ÿäº§é˜¶æ®µã€‚ä»<code>builder</code>é˜¶æ®µå¤åˆ¶ç¼–è¯‘å¥½çš„å‰ç«¯æ–‡ä»¶åˆ°<code>/usr/share/nginx/html</code>ç›®å½•ï¼Œè¿™æ˜¯ Nginx é»˜è®¤çš„é™æ€èµ„æºç›®å½•ã€‚åŒæ—¶ï¼Œå°†é¡¹ç›®è‡ªå®šä¹‰çš„ Nginx é…ç½®æ–‡ä»¶<code>infra/docker/nginx/tacticore.conf</code>å¤åˆ¶åˆ°<code>/etc/nginx/conf.d/default.conf</code>ï¼Œè¦†ç›–é»˜è®¤çš„ Nginx é…ç½®ã€‚é€šè¿‡<code>EXPOSE 80</code>å£°æ˜å®¹å™¨ç›‘å¬ç«¯å£ä¸º 80ï¼Œæœ€åä½¿ç”¨<code>CMD ["nginx", "-g", "daemon off;"]</code>ä»¥å‰å°æ¨¡å¼å¯åŠ¨ Nginx æœåŠ¡ï¼Œç¡®ä¿ Docker å®¹å™¨è¿è¡Œæ—¶ Nginx æœåŠ¡å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</li></ol><h3 id=-åç«¯é•œåƒé…ç½®-backenddockerfileprod>ğŸ—„ï¸ åç«¯é•œåƒé…ç½® (backend/Dockerfile.prod)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># å¼€å‘é˜¶æ®µ</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine AS development</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ç”Ÿäº§é˜¶æ®µ</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine AS production</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>development /app/dist ./dist<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>development /app/package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci --production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;node&#34;</span><span class=p>,</span> <span class=s2>&#34;dist/main.js&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><strong>å¼€å‘é˜¶æ®µ</strong>ï¼šåŸºäº<code>node:22-alpine</code>é•œåƒåˆ›å»ºåä¸º<code>development</code>çš„å¼€å‘é˜¶æ®µã€‚è®¾ç½®å·¥ä½œç›®å½•ä¸º<code>/app</code>ï¼Œå¤åˆ¶åç«¯é¡¹ç›®çš„<code>package*.json</code>æ–‡ä»¶ï¼Œæ‰§è¡Œ<code>npm ci</code>å®‰è£…ä¾èµ–ï¼Œå†å°†æ•´ä¸ªåç«¯é¡¹ç›®å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¹¶æ‰§è¡Œ<code>npm run build</code>è¿›è¡Œé¡¹ç›®æ„å»ºã€‚</li><li><strong>ç”Ÿäº§é˜¶æ®µ</strong>ï¼šåŒæ ·åŸºäº<code>node:22-alpine</code>é•œåƒåˆ›å»º<code>production</code>é˜¶æ®µã€‚ä»<code>development</code>é˜¶æ®µå¤åˆ¶ç¼–è¯‘åçš„æ–‡ä»¶åˆ°<code>/app/dist</code>ç›®å½•ï¼ŒåŒæ—¶å¤åˆ¶<code>package*.json</code>æ–‡ä»¶ã€‚æ‰§è¡Œ<code>npm ci --production</code>å®‰è£…ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„ä¾èµ–ï¼Œè¿™é‡Œ<code>--production</code>å‚æ•°ä¼šè·³è¿‡å®‰è£…<code>devDependencies</code>ã€‚æœ€åé€šè¿‡<code>CMD ["node", "dist/main.js"]</code>å¯åŠ¨åç«¯æœåŠ¡ã€‚</li></ol><h3 id=-æ•°æ®åº“åˆå§‹åŒ–-infradockermongoinit-mongojs>ğŸ§© æ•°æ®åº“åˆå§‹åŒ– (infra/docker/mongo/init-mongo.js)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// ==================== å®‰å…¨å¢å¼º ====================
</span></span></span><span class=line><span class=cl><span class=c1>// 1. åˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“ï¼ˆæ˜¾å¼åˆ›å»ºæ•°æ®åº“ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>getSiblingDB</span><span class=p>(</span><span class=s2>&#34;tacticore&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 2. åˆ›å»ºä¸“ç”¨ç”¨æˆ·
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>createUser</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>user</span><span class=o>:</span> <span class=s2>&#34;tacticore&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>pwd</span><span class=o>:</span> <span class=s2>&#34;pwd-tacticore&#34;</span><span class=p>,</span> <span class=c1>// ç”Ÿäº§ç¯å¢ƒåº”ä»ç¯å¢ƒå˜é‡è·å–
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>roles</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>role</span><span class=o>:</span> <span class=s2>&#34;readWrite&#34;</span><span class=p>,</span> <span class=nx>db</span><span class=o>:</span> <span class=s2>&#34;tacticore&#34;</span> <span class=p>},</span> <span class=c1>// åº”ç”¨æ•°æ®åº“æƒé™
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span> <span class=nx>role</span><span class=o>:</span> <span class=s2>&#34;clusterMonitor&#34;</span><span class=p>,</span> <span class=nx>db</span><span class=o>:</span> <span class=s2>&#34;admin&#34;</span> <span class=p>},</span> <span class=c1>// ç›‘æ§æƒé™ï¼ˆå¯é€‰ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 3. åˆ›å»ºåˆå§‹é›†åˆï¼ˆå¯é€‰ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s2>&#34;users&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>validator</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>$jsonSchema</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>bsonType</span><span class=o>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>required</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;username&#34;</span><span class=p>,</span> <span class=s2>&#34;email&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>properties</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>username</span><span class=o>:</span> <span class=p>{</span> <span class=nx>bsonType</span><span class=o>:</span> <span class=s2>&#34;string&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=o>:</span> <span class=p>{</span> <span class=nx>bsonType</span><span class=o>:</span> <span class=s2>&#34;string&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 4. åˆ›å»ºç´¢å¼•ï¼ˆå¯é€‰ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>createIndex</span><span class=p>({</span> <span class=nx>email</span><span class=o>:</span> <span class=mi>1</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 5. æ’å…¥åˆå§‹æ•°æ®ï¼ˆå¯é€‰ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>insertOne</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>username</span><span class=o>:</span> <span class=s2>&#34;admin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>email</span><span class=o>:</span> <span class=s2>&#34;admin@tacticore.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>createdAt</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 6. éªŒè¯ç»“æœï¼ˆè°ƒè¯•ç”¨ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>print</span><span class=p>(</span><span class=s2>&#34;========== åˆå§‹åŒ–å®Œæˆ ==========&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>printjson</span><span class=p>(</span><span class=nx>db</span><span class=p>.</span><span class=nx>getUsers</span><span class=p>());</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨è¿™ä¸ªè„šæœ¬ä¸­ï¼Œé¦–å…ˆåˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“<code>tacticore</code>ï¼Œè‹¥æ•°æ®åº“ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ç„¶ååˆ›å»ºä¸€ä¸ªä¸“ç”¨ç”¨æˆ·<code>tacticore</code>ï¼Œå¹¶èµ‹äºˆå…¶åœ¨<code>tacticore</code>æ•°æ®åº“çš„è¯»å†™æƒé™ä»¥åŠåœ¨<code>admin</code>æ•°æ®åº“çš„ç›‘æ§æƒé™ï¼ˆå¯é€‰ï¼‰ã€‚æ¥ç€å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚åˆ›å»ºåˆå§‹é›†åˆ<code>users</code>ï¼Œå¹¶å®šä¹‰é›†åˆçš„æ•°æ®æ ¡éªŒè§„åˆ™ï¼Œè¦æ±‚<code>username</code>å’Œ<code>email</code>å­—æ®µä¸ºå¿…å¡«ï¼Œä¸”ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚ä¸º<code>email</code>å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œç¡®ä¿<code>email</code>çš„å”¯ä¸€æ€§ã€‚è¿˜å¯ä»¥æ’å…¥ä¸€æ¡åˆå§‹æ•°æ®ç”¨äºæµ‹è¯•ã€‚æœ€åè¾“å‡ºåˆå§‹åŒ–å®Œæˆçš„ä¿¡æ¯ï¼Œå¹¶æ‰“å°å½“å‰ç”¨æˆ·åˆ—è¡¨ç”¨äºè°ƒè¯•ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯†ç åº”ä»ç¯å¢ƒå˜é‡è·å–ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚</p><h3 id=-nginx-é…ç½®-infradockernginxtacticoreconf>ğŸŒ Nginx é…ç½® (infra/docker/nginx/tacticore.conf)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>localhost</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å‰ç«¯è·¯ç”±å¤„ç†
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>root</span> <span class=s>/usr/share/nginx/html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>try_files</span> <span class=nv>$uri</span> <span class=nv>$uri/</span> <span class=s>/index.html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åç«¯ä»£ç†
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>location</span> <span class=s>/api/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://backend:3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Nginx åœ¨é¡¹ç›®ä¸­æ‰¿æ‹…ç€é‡è¦è§’è‰²ã€‚é€šè¿‡è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼ŒNginx ç›‘å¬ç«¯å£ 80ã€‚åœ¨å‰ç«¯è·¯ç”±å¤„ç†æ–¹é¢ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„æ—¶ï¼ŒNginx ä¼šä»<code>/usr/share/nginx/html</code>ç›®å½•æŸ¥æ‰¾å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè‹¥æœªæ‰¾åˆ°åˆ™è¿”å›<code>index.html</code>ï¼Œè¿™å¯¹äºå•é¡µåº”ç”¨ï¼ˆSPAï¼‰çš„è·¯ç”±å¤„ç†éå¸¸å…³é”®ã€‚åœ¨åç«¯ä»£ç†æ–¹é¢ï¼Œå½“æ¥æ”¶åˆ°ä»¥<code>/api/</code>å¼€å¤´çš„è¯·æ±‚æ—¶ï¼ŒNginx ä¼šå°†è¯·æ±‚è½¬å‘åˆ°<code>http://backend:3000</code>ï¼ŒåŒæ—¶è®¾ç½®<code>Host</code>å’Œ<code>X-Real-IP</code>å¤´éƒ¨ä¿¡æ¯ï¼Œéšè—åç«¯çœŸå®ç«¯å£å’Œç»†èŠ‚ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚</p><h3 id=-docker-compose-ç¼–æ’>ğŸ› docker-compose ç¼–æ’</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>frontend/Dockerfile.prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>prod</span><span class=w> </span><span class=c># é»˜è®¤ç”Ÿäº§ç¯å¢ƒ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8080:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile.prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./backend/.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NODE_ENV=production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./backend/.env:/app/.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mongo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mongo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mongo:6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mongo_data:/data/db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./infra/docker/mongo/init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>MONGO_INITDB_ROOT_USERNAME=root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>MONGO_INITDB_ROOT_PASSWORD=rootpassword123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;27017:27017&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mongo_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>docker-compose.yml</code>ç”¨äºç¼–æ’å¤šä¸ª Docker å®¹å™¨æœåŠ¡ã€‚è¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªæœåŠ¡ï¼š</p><ol><li><strong>frontend</strong>ï¼šåŸºäºå‰ç«¯é¡¹ç›®æ ¹ç›®å½•æ„å»ºé•œåƒï¼Œä½¿ç”¨<code>frontend/Dockerfile.prod</code>ï¼Œç›®æ ‡ä¸ºç”Ÿäº§ç¯å¢ƒã€‚å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£ï¼Œå¹¶ä¸”ä¾èµ–<code>backend</code>æœåŠ¡ï¼Œç¡®ä¿<code>backend</code>æœåŠ¡å…ˆå¯åŠ¨ã€‚</li><li><strong>backend</strong>ï¼šåŸºäºåç«¯é¡¹ç›®ç›®å½•æ„å»ºé•œåƒï¼Œä½¿ç”¨<code>backend/Dockerfile.prod</code>ã€‚é€šè¿‡<code>env_file</code>åŠ è½½<code>./backend/.env</code>æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œè®¾ç½®<code>NODE_ENV</code>ä¸º<code>production</code>ã€‚å°†ä¸»æœºçš„<code>./backend/.env</code>æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…çš„<code>/app/.env</code>ï¼Œå®ç°ç¯å¢ƒå˜é‡çš„åŒæ­¥ã€‚ä¾èµ–<code>mongo</code>æœåŠ¡ï¼Œç¡®ä¿<code>mongo</code>æœåŠ¡å…ˆå¯åŠ¨ã€‚å°†å®¹å™¨çš„ 3000 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 3000 ç«¯å£ã€‚</li><li><strong>mongo</strong>ï¼šä½¿ç”¨<code>mongo:6</code>å®˜æ–¹é•œåƒã€‚å°†<code>mongo_data</code>å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„<code>/data/db</code>ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨ MongoDB æ•°æ®ã€‚å°†<code>./infra/docker/mongo/init-mongo.js</code>æ–‡ä»¶åªè¯»æŒ‚è½½åˆ°<code>/docker-entrypoint-initdb.d/init-mongo.js</code>ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬è¿›è¡Œ MongoDB çš„åˆå§‹åŒ–ã€‚è®¾ç½®<code>MONGO_INITDB_ROOT_USERNAME</code>å’Œ<code>MONGO_INITDB_ROOT_PASSWORD</code>ç¯å¢ƒå˜é‡ï¼Œç”¨äºåˆå§‹åŒ– MongoDB çš„ root ç”¨æˆ·ã€‚å°†å®¹å™¨çš„ 27017 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 27017 ç«¯å£ã€‚</li></ol><h3 id=-å¯åŠ¨å‘½ä»¤>ğŸš€ å¯åŠ¨å‘½ä»¤</h3><p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨é¡¹ç›®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡</span>
</span></span><span class=line><span class=cl>docker-compose up --build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è®¿é—®å‰ç«¯</span>
</span></span><span class=line><span class=cl>http://localhost:8080
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éªŒè¯æœåŠ¡</span>
</span></span><span class=line><span class=cl>docker-compose ps
</span></span></code></pre></td></tr></table></div></div><p><code>docker-compose up --build</code>å‘½ä»¤ä¼šæ„å»ºæ‰€æœ‰æœåŠ¡çš„é•œåƒå¹¶å¯åŠ¨å®¹å™¨ã€‚æ„å»ºè¿‡ç¨‹ä¸­ä¼šæ ¹æ®å„ä¸ª<code>Dockerfile</code>çš„é…ç½®è¿›è¡Œæ“ä½œã€‚æ„å»ºå®Œæˆåï¼Œå‰ç«¯æœåŠ¡å¯é€šè¿‡<code>http://localhost:8080</code>è®¿é—®ã€‚<code>docker-compose ps</code>å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨æœåŠ¡çŠ¶æ€ï¼Œç¡®ä¿å„ä¸ªæœåŠ¡æ­£å¸¸å¯åŠ¨ã€‚</p><p>é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„ Docker é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†å…¨æ ˆåšå®¢ç³»ç»Ÿçš„å‰ç«¯ã€åç«¯ä»¥åŠæ•°æ®åº“æœåŠ¡ä»¥å®¹å™¨åŒ–çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²å’Œç®¡ç†ï¼Œä¸ºé¡¹ç›®çš„ç¨³å®šè¿è¡Œå’Œåç»­æ‰©å±•æä¾›æœ‰åŠ›æ”¯æŒã€‚</p><h2 id=-docker-çƒ­æ›´æ–°>âš¡ Docker çƒ­æ›´æ–°</h2><p>åœ¨å®Œæˆç¬¬ä¸‰éƒ¨åˆ†çš„ Docker é…ç½®åï¼Œé¡¹ç›®å·²ç»å¯ä»¥ä»¥å®¹å™¨åŒ–çš„æ–¹å¼ç¨³å®šéƒ¨ç½²å’Œè¿è¡Œã€‚ä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé¢‘ç¹ä¿®æ”¹ä»£ç åéƒ½é‡æ–°æ„å»ºå’Œå¯åŠ¨å®¹å™¨ä¼šæå¤§åœ°é™ä½å¼€å‘æ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æå‡å¼€å‘ä½“éªŒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å®ç° Docker çƒ­é‡è½½ï¼Œè¿™æ ·åœ¨ä¿®æ”¹ä»£ç åï¼Œæ— éœ€é‡å¯å®¹å™¨å°±èƒ½å®æ—¶çœ‹åˆ°ä»£ç å˜æ›´çš„æ•ˆæœã€‚</p><h3 id=-å‰ç«¯çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ>ğŸ–¥ï¸ å‰ç«¯çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ</h3><h4 id=è°ƒæ•´å‰ç«¯-dockerfile>è°ƒæ•´å‰ç«¯ Dockerfile</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># frontend/Dockerfile.dev</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># ================= å¼€å‘é˜¶æ®µ =================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine AS dev</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> frontend/package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm install<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5173</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;run&#34;</span><span class=p>,</span> <span class=s2>&#34;dev&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºå¼€å‘ç¯å¢ƒçš„ <code>Dockerfile.dev</code>ã€‚åŸºäº<code>node:22-alpine</code>é•œåƒï¼Œè®¾ç½®å·¥ä½œç›®å½•ä¸º<code>/app</code>ï¼Œå¤åˆ¶å‰ç«¯é¡¹ç›®çš„<code>package*.json</code>æ–‡ä»¶å¹¶æ‰§è¡Œ<code>npm install</code>å®‰è£…ä¾èµ–ã€‚æš´éœ²ç«¯å£ 5173ï¼Œè¿™æ˜¯ Vite å¼€å‘æœåŠ¡å™¨é»˜è®¤çš„ç«¯å£ã€‚æœ€åå¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ã€‚</p><h4 id=æ·»åŠ -docker-composedevyml>æ·»åŠ  docker-compose.dev.yml</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>frontend/Dockerfile.dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./frontend:/app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/app/node_modules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5173:5173&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NODE_ENV=development</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨<code>docker-compose.dev.yml</code>ä¸­ï¼Œå®šä¹‰äº†å‰ç«¯æœåŠ¡åœ¨å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®ã€‚é€šè¿‡<code>volumes</code>å°†æœ¬åœ°çš„<code>./frontend</code>ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„<code>/app</code>ç›®å½•ï¼Œå®ç°ä»£ç çš„å®æ—¶åŒæ­¥ã€‚åŒæ—¶ï¼Œä½¿ç”¨<code>/app/node_modules</code>é˜²æ­¢æœ¬åœ°çš„<code>node_modules</code>è¦†ç›–å®¹å™¨å†…çš„ä¾èµ–ã€‚å°†å®¹å™¨çš„ 5173 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 5173 ç«¯å£ï¼Œæ–¹ä¾¿åœ¨æœ¬åœ°è®¿é—®å¼€å‘æœåŠ¡å™¨ã€‚è®¾ç½®ç¯å¢ƒå˜é‡<code>NODE_ENV</code>ä¸º<code>development</code>ã€‚</p><h4 id=é…ç½®-vite-å¼€å‘æœåŠ¡å™¨>é…ç½® Vite å¼€å‘æœåŠ¡å™¨</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// frontend/vite.config.ts
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>server</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// å…è®¸å¤–éƒ¨è®¿é—®
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>port</span><span class=o>:</span> <span class=mi>5173</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>usePolling</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// è§£å†³å®¹å™¨å†…æ–‡ä»¶ç›‘å¬é—®é¢˜
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ Vite é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®<code>host: true</code>å…è®¸å¤–éƒ¨è®¿é—®å¼€å‘æœåŠ¡å™¨ï¼Œ<code>port: 5173</code>æŒ‡å®šå¼€å‘æœåŠ¡å™¨çš„ç«¯å£ã€‚<code>watch.usePolling: true</code>è§£å†³äº†åœ¨ Docker å®¹å™¨å†…æ–‡ä»¶ç›‘å¬å¤±æ•ˆçš„é—®é¢˜ï¼Œé€šè¿‡è½®è¯¢çš„æ–¹å¼æ£€æµ‹æ–‡ä»¶å˜åŒ–ã€‚</p><h3 id=-å‰ç«¯çƒ­æ›´æ–°å·¥ä½œåŸç†>ğŸ”„ å‰ç«¯çƒ­æ›´æ–°å·¥ä½œåŸç†</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sequenceDiagram
</span></span><span class=line><span class=cl>    participant æœ¬åœ°ç¼–è¾‘å™¨
</span></span><span class=line><span class=cl>    participant Dockerå®¹å™¨
</span></span><span class=line><span class=cl>    participant æµè§ˆå™¨
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    æœ¬åœ°ç¼–è¾‘å™¨-&gt;&gt;Dockerå®¹å™¨: ä¿®æ”¹ä»£ç æ–‡ä»¶
</span></span><span class=line><span class=cl>    Dockerå®¹å™¨-&gt;&gt;ViteæœåŠ¡å™¨: æ£€æµ‹æ–‡ä»¶å˜åŒ–
</span></span><span class=line><span class=cl>    ViteæœåŠ¡å™¨-&gt;&gt;ViteæœåŠ¡å™¨: å¢é‡ç¼–è¯‘
</span></span><span class=line><span class=cl>    ViteæœåŠ¡å™¨-&gt;&gt;æµè§ˆå™¨: é€šè¿‡ WebSocket æ¨é€æ›´æ–°
</span></span><span class=line><span class=cl>    æµè§ˆå™¨-&gt;&gt;æµè§ˆå™¨: è‡ªåŠ¨åˆ·æ–°é¡µé¢
</span></span></code></pre></td></tr></table></div></div><p>å½“åœ¨æœ¬åœ°ç¼–è¾‘å™¨ä¿®æ”¹ä»£ç æ–‡ä»¶åï¼Œç”±äº<code>volumes</code>çš„æŒ‚è½½ï¼Œå®¹å™¨å†…çš„ä»£ç ä¹Ÿä¼šå®æ—¶æ›´æ–°ã€‚Vite æœåŠ¡å™¨æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–åè¿›è¡Œå¢é‡ç¼–è¯‘ï¼Œç„¶åé€šè¿‡ WebSocket å°†æ›´æ–°æ¨é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚</p><h3 id=-å‰ç«¯çƒ­æ›´æ–°éªŒè¯>âœ… å‰ç«¯çƒ­æ›´æ–°éªŒè¯</h3><ol><li><p><strong>å¯åŠ¨å¼€å‘ç¯å¢ƒ</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up frontend
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>ä¿®æ”¹å‰ç«¯ä»£ç </strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// frontend/src/App.tsx
</span></span></span><span class=line><span class=cl><span class=c1>// éšä¾¿ä¿®æ”¹ä¸€äº›åœ°æ–¹
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[vite] page reload src/App.tsx
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°</strong>
æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œé¡µé¢å°†è‡ªåŠ¨æ›´æ–°</p></li></ol><h3 id=-åç«¯çƒ­é‡è½½å®Œæ•´è§£å†³æ–¹æ¡ˆ>ğŸ—„ï¸ åç«¯çƒ­é‡è½½å®Œæ•´è§£å†³æ–¹æ¡ˆ</h3><h4 id=æ‹†åˆ†åç«¯-dockerfile>æ‹†åˆ†åç«¯ Dockerfile</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># backend/Dockerfile.dev</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine AS development</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># å®‰è£…å¼€å‘ä¾èµ–</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm install -g nodemon<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># å¯åŠ¨å¼€å‘æœåŠ¡å™¨</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;run&#34;</span><span class=p>,</span> <span class=s2>&#34;start:dev:docker&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># backend/Dockerfile.prod</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Stage 1: Build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Stage 2: Production</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:22-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/dist ./dist<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci --production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;node&#34;</span><span class=p>,</span> <span class=s2>&#34;dist/main.js&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>å°†åç«¯çš„ Dockerfile æ‹†åˆ†ä¸ºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸¤ä¸ªæ–‡ä»¶ã€‚åœ¨å¼€å‘ç¯å¢ƒçš„ Dockerfile ä¸­ï¼Œå®‰è£…<code>nodemon</code>ç”¨äºæ–‡ä»¶ç›‘æ§å’Œçƒ­é‡è½½ï¼Œå¤åˆ¶é¡¹ç›®æ–‡ä»¶å¹¶å®‰è£…ä¾èµ–ï¼Œæœ€åå¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚ç”Ÿäº§ç¯å¢ƒçš„ Dockerfile åˆ™å…ˆè¿›è¡Œä»£ç æ„å»ºï¼Œç„¶åå°†æ„å»ºåçš„æ–‡ä»¶å¤åˆ¶åˆ°ç”Ÿäº§ç¯å¢ƒé•œåƒä¸­ï¼Œåªå®‰è£…ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„ä¾èµ–ã€‚</p><h4 id=è°ƒæ•´-docker-compose-é…ç½®>è°ƒæ•´ docker-compose é…ç½®</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yml (ç”Ÿäº§é…ç½®)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile.prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./backend/.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NODE_ENV=production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./backend/.env:/app/.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mongo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.dev.yml (å¼€å‘é…ç½®)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile.dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./backend:/app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/app/node_modules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NODE_ENV=development</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨<code>docker-compose.yml</code>ä¸­é…ç½®ç”Ÿäº§ç¯å¢ƒçš„åç«¯æœåŠ¡ï¼Œä½¿ç”¨<code>Dockerfile.prod</code>è¿›è¡Œæ„å»ºã€‚åœ¨<code>docker-compose.dev.yml</code>ä¸­é…ç½®å¼€å‘ç¯å¢ƒçš„åç«¯æœåŠ¡ï¼Œä½¿ç”¨<code>Dockerfile.dev</code>è¿›è¡Œæ„å»ºï¼Œé€šè¿‡<code>volumes</code>å®ç°ä»£ç å®æ—¶åŒæ­¥ï¼Œé˜²æ­¢è¦†ç›–å®¹å™¨å†…çš„ä¾èµ–ã€‚</p><h4 id=nodemon-é…ç½®>nodemon é…ç½®</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=c1>// backend/package.json
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start:dev:docker&#34;</span><span class=p>:</span> <span class=s2>&#34;nodemon --legacy-watch src/main.ts&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//ç‰ˆæœ¬ä¾›å‚è€ƒ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nt>&#34;@types/nodemon&#34;</span><span class=p>:</span> <span class=s2>&#34;^1.19.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nodemon&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.1.0&#34;</span><span class=p>,</span> <span class=c1>// æ–°å¢çƒ­é‡è½½å·¥å…·
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nt>&#34;ts-node&#34;</span><span class=p>:</span> <span class=s2>&#34;^10.9.2&#34;</span> <span class=c1>// æ˜ç¡® TS è¿è¡Œæ—¶ç‰ˆæœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=c1>// backend/nodemon.json
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;watch&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;src&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ext&#34;</span><span class=p>:</span> <span class=s2>&#34;ts,json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ignore&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;src/**/*.spec.ts&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;exec&#34;</span><span class=p>:</span> <span class=s2>&#34;ts-node src/main.ts&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;legacyWatch&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;delay&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨<code>package.json</code>ä¸­æ·»åŠ <code>start:dev:docker</code>è„šæœ¬ï¼Œä½¿ç”¨<code>nodemon</code>ç›‘æ§<code>src</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å˜åŒ–ã€‚åœ¨<code>nodemon.json</code>ä¸­é…ç½®ç›‘æ§çš„ç›®å½•ã€æ–‡ä»¶ç±»å‹ã€å¿½ç•¥çš„æ–‡ä»¶ç­‰ï¼Œä½¿ç”¨<code>ts-node</code>ç›´æ¥è¿è¡Œ TypeScript æ–‡ä»¶ã€‚</p><h3 id=-åç«¯çƒ­é‡è½½éªŒè¯>âœ… åç«¯çƒ­é‡è½½éªŒè¯</h3><ol><li><p><strong>ä¿®æ”¹åç«¯ä»£ç </strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// backend/src/main.ts
</span></span></span><span class=line><span class=cl><span class=c1>// éšä¾¿ä¿®æ”¹
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>è§‚å¯Ÿå®¹å™¨æ—¥å¿—</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[nodemon] restarting due to changes...
</span></span><span class=line><span class=cl>Server running on http://localhost:3000
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>API æµ‹è¯•</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:3000/health
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=-ä¸€é”®å¯åŠ¨æ–¹æ¡ˆ>ğŸš€ ä¸€é”®å¯åŠ¨æ–¹æ¡ˆ</h3><h4 id=ç”Ÿäº§ç¯å¢ƒ>ç”Ÿäº§ç¯å¢ƒ</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f docker-compose.yml up --build
</span></span></code></pre></td></tr></table></div></div><h4 id=å¼€å‘ç¯å¢ƒå®Œæ•´çƒ­æ›´æ–°>å¼€å‘ç¯å¢ƒï¼ˆå®Œæ•´çƒ­æ›´æ–°ï¼‰</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ä¸»ç›®å½•ä¸‹åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶<code>dev-up.bat</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>docker-compose -f docker-compose.yml -f docker-compose.dev.yml up <span class=nv>%*</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªè„šæœ¬å¯ä»¥æ–¹ä¾¿åœ°å¯åŠ¨å¼€å‘ç¯å¢ƒï¼Œå°†<code>docker-compose.yml</code>å’Œ<code>docker-compose.dev.yml</code>çš„é…ç½®åˆå¹¶ä½¿ç”¨ã€‚</p><p>é€šè¿‡ä»¥ä¸Šå‰ç«¯å’Œåç«¯çš„çƒ­é‡è½½é…ç½®ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥æå¤§åœ°æé«˜æ•ˆç‡ï¼Œå®æ—¶çœ‹åˆ°ä»£ç ä¿®æ”¹çš„æ•ˆæœã€‚åŒæ—¶ï¼Œé€šè¿‡ä¸åŒçš„ Dockerfile å’Œ<code>docker-compose</code>é…ç½®ï¼Œæ¸…æ™°åœ°åˆ†ç¦»äº†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚</p><h2 id=-é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ>ğŸš¨ é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨å®Œæˆå‰é¢çš„ Docker é…ç½®åŠçƒ­é‡è½½è®¾ç½®åï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚æ¥ä¸‹æ¥å°†é’ˆå¯¹ç”¨æˆ·å’Œå¯†ç ç®¡ç†ã€æ–‡ä»¶è·¯å¾„åŠç¯å¢ƒå˜é‡åŠ è½½ç­‰æ–¹é¢çš„å¸¸è§é—®é¢˜è¿›è¡Œåˆ†æï¼Œå¹¶ç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id=-ç”¨æˆ·å’Œå¯†ç ç®¡ç†é—®é¢˜>ğŸ” ç”¨æˆ·å’Œå¯†ç ç®¡ç†é—®é¢˜</h3><h4 id=ç”¨æˆ·å’Œå¯†ç å®šä¹‰å…³ç³»>ç”¨æˆ·å’Œå¯†ç å®šä¹‰å…³ç³»</h4><p>ç”¨æˆ·å’Œå¯†ç çš„åˆ›å»ºæ¶‰åŠä¸¤ä¸ªå…³é”®æ–‡ä»¶ï¼Œå®ƒä»¬æœ‰ç€ä¸åŒçš„ä½œç”¨å’Œé…ç½®æ–¹å¼ã€‚</p><ul><li><strong>Root ç”¨æˆ· (ç®¡ç†å‘˜)</strong>ï¼šåœ¨ <code>docker-compose.yml</code> ä¸­å®šä¹‰ï¼Œç”¨äº MongoDB å®ä¾‹çš„åˆå§‹ç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯¹æ•´ä¸ª MongoDB å®ä¾‹æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>mongo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>MONGO_INITDB_ROOT_USERNAME=root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>MONGO_INITDB_ROOT_PASSWORD=rootpassword123</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>åº”ç”¨ç”¨æˆ· (tacticore)</strong>ï¼šåœ¨ <code>init-mongo.js</code> ä¸­å®šä¹‰ï¼Œä»…é™ç‰¹å®šæ•°æ®åº“çš„æ“ä½œæƒé™ã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>createUser</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>user</span><span class=o>:</span> <span class=s2>&#34;tacticore&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>pwd</span><span class=o>:</span> <span class=s2>&#34;pwd-tacticore&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>roles</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>role</span><span class=o>:</span> <span class=s2>&#34;readWrite&#34;</span><span class=p>,</span> <span class=nx>db</span><span class=o>:</span> <span class=s2>&#34;tacticore&#34;</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>è¿æ¥å­—ç¬¦ä¸² (MONGO_URI)</strong>ï¼šé…ç½®åœ¨ <code>.env</code> æˆ– <code>docker-compose.yml</code> ä¸­ï¼Œæ ¼å¼ä¸º <code>mongodb://&lt;åº”ç”¨ç”¨æˆ·>:&lt;åº”ç”¨å¯†ç >@mongo:27017/&lt;æ•°æ®åº“>?authSource=admin</code>ã€‚ä½¿ç”¨ <code>authSource=admin</code> æ˜¯å› ä¸º MongoDB è¦æ±‚é root ç”¨æˆ·å¿…é¡»åœ¨ <code>admin</code> æ•°æ®åº“è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li></ul><h4 id=ä¿®æ”¹ç”¨æˆ·å¯†ç >ä¿®æ”¹ç”¨æˆ·å¯†ç </h4><ul><li><strong>ä¿®æ”¹ Root ç”¨æˆ·</strong>ï¼šç›´æ¥ä¿®æ”¹ <code>docker-compose.yml</code> çš„ç¯å¢ƒå˜é‡ã€‚</li><li><strong>ä¿®æ”¹åº”ç”¨ç”¨æˆ·</strong>ï¼šæ›´æ–° <code>init-mongo.js</code> ä¸­çš„ <code>pwd</code> å­—æ®µï¼Œå¹¶é‡æ–°åˆå§‹åŒ–å®¹å™¨ã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose down -v  <span class=c1># åˆ é™¤æ•°æ®å·</span>
</span></span><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><h4 id=å®‰å…¨å»ºè®®>å®‰å…¨å»ºè®®</h4><ul><li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼šä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆå™¨ç”Ÿæˆå¤æ‚å¯†ç ï¼Œé€šè¿‡ Docker Secrets ç®¡ç†å¯†ç ï¼ˆè€Œéæ˜æ–‡å­˜å‚¨ï¼‰ï¼Œå®šæœŸè½®æ¢å‡­è¯ã€‚</li><li><strong>å¼€å‘ç¯å¢ƒ</strong>ï¼šåœ¨ <code>init-mongo.js</code> ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œç„¶ååœ¨ <code>docker-compose.yml</code> ä¸­æ³¨å…¥ã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// init-mongo.js ä½¿ç”¨å ä½ç¬¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>pwd</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MONGO_APP_PASSWORD</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>mongo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>MONGO_APP_PASSWORD=${MONGO_APP_PASSWORD}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=-docker-æ„å»ºå‰ç«¯é•œåƒæ—¶æ‰¾ä¸åˆ°-nginx-é…ç½®æ–‡ä»¶é—®é¢˜>ğŸ“‚ Docker æ„å»ºå‰ç«¯é•œåƒæ—¶æ‰¾ä¸åˆ° Nginx é…ç½®æ–‡ä»¶é—®é¢˜</h3><h4 id=é”™è¯¯åŸå› >é”™è¯¯åŸå› </h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>COPY infra/docker/nginx/tacticore.conf â†’ æ–‡ä»¶æœªæ‰¾åˆ°
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ˜¯ç”±äº Docker æ„å»ºä¸Šä¸‹æ–‡è·¯å¾„å’Œæ–‡ä»¶å¼•ç”¨è·¯å¾„ä¸åŒ¹é…ã€‚é¡¹ç›®ç»“æ„ä¸­ï¼Œé…ç½®æ–‡ä»¶åœ¨ <code>infra</code> ç›®å½•ï¼Œè€Œ Dockerfile åœ¨ <code>client</code> ç›®å½•ã€‚</p><h4 id=è§£å†³æ–¹æ¡ˆ>è§£å†³æ–¹æ¡ˆ</h4><p>åœ¨ <code>docker-compose.yml</code> ä¸­æŒ‡å®šæ­£ç¡®çš„æ„å»ºä¸Šä¸‹æ–‡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w> </span><span class=c># å°†æ„å»ºä¸Šä¸‹æ–‡è®¾ä¸ºé¡¹ç›®æ ¹ç›®å½•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>frontend/Dockerfile</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å…³é”®åŸç†æ˜¯ Docker åªèƒ½è®¿é—® <code>context</code> æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ‰€æœ‰ <code>COPY</code> æŒ‡ä»¤çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äº <code>context</code> ç›®å½•çš„ã€‚</p><h3 id=-ç¯å¢ƒå˜é‡åŠ è½½é—®é¢˜>ğŸ“Œ ç¯å¢ƒå˜é‡åŠ è½½é—®é¢˜</h3><h4 id=docker-compose-çš„ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§é—®é¢˜>Docker Compose çš„ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§é—®é¢˜</h4><p>åœ¨ <code>docker-compose.yml</code> ä¸­åŒæ—¶ä½¿ç”¨äº†ä¸¤ç§ç¯å¢ƒå˜é‡åŠ è½½æ–¹å¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env_file</span><span class=p>:</span><span class=w> </span><span class=l>./backend/.env</span><span class=w> </span><span class=c># æ–¹å¼1ï¼šä»æ–‡ä»¶åŠ è½½</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=c># æ–¹å¼2ï¼šç›´æ¥è®¾ç½®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MONGO_URI=${MONGO_URI}</span><span class=w> </span><span class=c># å¼•ç”¨å®¿ä¸»æœºç¯å¢ƒå˜é‡</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ ¹æ® Docker çš„å˜é‡ä¼˜å…ˆçº§è§„åˆ™ï¼Œ<code>environment</code> ç›´æ¥å®šä¹‰çš„å˜é‡ä¼šè¦†ç›– <code>env_file</code> ä¸­çš„åŒåå˜é‡ï¼Œ<code>${VAR}</code> è¯­æ³•ä¼šå°è¯•è¯»å–å®¿ä¸»æœºç¯å¢ƒå˜é‡ï¼ˆè€Œéæ–‡ä»¶ä¸­çš„å˜é‡ï¼‰ã€‚ç”±äºå®¿ä¸»æœºæ²¡æœ‰å®šä¹‰ <code>MONGO_URI</code> ç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´æœ€ç»ˆå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p><h4 id=è§£å†³æ–¹æ¡ˆ-1>è§£å†³æ–¹æ¡ˆ</h4><p>ç»Ÿä¸€ä½¿ç”¨ <code>env_file</code>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  backend:
</span></span><span class=line><span class=cl>    env_file:
</span></span><span class=line><span class=cl>      - ./backend/.env
</span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      - NODE_ENV=production
</span></span><span class=line><span class=cl><span class=gd>-     - MONGO_URI=${MONGO_URI}  # åˆ é™¤æ­¤è¡Œ
</span></span></span><span class=line><span class=cl><span class=gd>-     - JWT_SECRET=${JWT_SECRET} # åˆ é™¤æ­¤è¡Œ
</span></span></span></code></pre></td></tr></table></div></div><p>å˜é‡è¦†ç›–æœºåˆ¶å¦‚ä¸‹ï¼š</p><div class=table-wrapper><table><thead><tr><th>é…ç½®æ–¹å¼</th><th>ä¼˜å…ˆçº§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>environment</code></td><td>é«˜</td><td>éœ€è¦è¦†ç›–æ–‡ä»¶é…ç½®æ—¶</td></tr><tr><td><code>env_file</code></td><td>ä½</td><td>é›†ä¸­ç®¡ç†å¤šä¸ªå˜é‡</td></tr></tbody></table></div><p>é€šè¿‡ä»¥ä¸Šå¯¹å¸¸è§é—®é¢˜çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥æ›´å¥½åœ°åº”å¯¹ Docker é…ç½®å’Œä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„çŠ¶å†µï¼Œç¡®ä¿é¡¹ç›®çš„ç¨³å®šè¿è¡Œã€‚</p><h2 id=-é€šç”¨é…ç½®>âš™ï¸ é€šç”¨é…ç½®</h2><p>åœ¨å…¨æ ˆåšå®¢ç³»ç»Ÿçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®ŒæˆåŸºç¡€æ¶æ„æ­å»ºã€Docker é…ç½®ç­‰æ ¸å¿ƒéƒ¨åˆ†åï¼Œä¸€ç³»åˆ—é€šç”¨åŸºç¡€è®¾æ–½é…ç½®åŒæ ·ä¸å®¹å¿½è§†ï¼Œå®ƒä»¬å°†ä¸ºåç»­çš„é«˜æ•ˆå¼€å‘ä¸åä½œå¥ å®šåšå®åŸºç¡€ã€‚ä»¥ä¸‹è¯¦ç»†ä»‹ç»é€šç”¨é…ç½®éƒ¨åˆ†ã€‚</p><h3 id=-ç»Ÿä¸€ç¼–è¾‘å™¨è§„èŒƒeditorconfig>ğŸ› ï¸ ç»Ÿä¸€ç¼–è¾‘å™¨è§„èŒƒï¼ˆ.editorconfigï¼‰</h3><p>é€šè¿‡.editorconfig æ–‡ä»¶å¯ä»¥ç¡®ä¿å›¢é˜Ÿæˆå‘˜åœ¨ä¸åŒç¼–è¾‘å™¨ä¸‹ä¿æŒä¸€è‡´çš„ä»£ç é£æ ¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># .editorconfig</span>
</span></span><span class=line><span class=cl><span class=na>root</span> <span class=o>=</span> <span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[*]</span>
</span></span><span class=line><span class=cl><span class=na>charset</span> <span class=o>=</span> <span class=s>utf-8</span>
</span></span><span class=line><span class=cl><span class=na>end_of_line</span> <span class=o>=</span> <span class=s>lf</span>
</span></span><span class=line><span class=cl><span class=na>indent_size</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl><span class=na>indent_style</span> <span class=o>=</span> <span class=s>space</span>
</span></span><span class=line><span class=cl><span class=na>insert_final_newline</span> <span class=o>=</span> <span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>trim_trailing_whitespace</span> <span class=o>=</span> <span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[*.md]</span>
</span></span><span class=line><span class=cl><span class=na>trim_trailing_whitespace</span> <span class=o>=</span> <span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[*.{yml,yaml}]</span>
</span></span><span class=line><span class=cl><span class=na>indent_size</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[*.json]</span>
</span></span><span class=line><span class=cl><span class=na>indent_size</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Makefile]</span>
</span></span><span class=line><span class=cl><span class=na>indent_style</span> <span class=o>=</span> <span class=s>tab</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>root = true</code>ï¼šæ ‡è®°æ­¤ä¸ºæ ¹é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘å™¨å°†åœæ­¢å‘ä¸Šçº§ç›®å½•æœç´¢å…¶ä»–.editorconfig æ–‡ä»¶ï¼Œé˜²æ­¢ç»§æ‰¿çˆ¶ç›®å½•é…ç½®å¯¼è‡´è§„åˆ™å†²çªã€‚å…¶æŠ€æœ¯åŸç†éµå¾ªå°±è¿‘åŸåˆ™ï¼Œä¼˜å…ˆä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•é…ç½®ã€‚</li></ul><h3 id=-git-æäº¤æ¨¡æ¿gitmessage>ğŸ“ Git æäº¤æ¨¡æ¿ï¼ˆ.gitmessageï¼‰</h3><p>è§„èŒƒçš„ Git æäº¤ä¿¡æ¯æœ‰åŠ©äºå›¢é˜Ÿæˆå‘˜å¿«é€Ÿäº†è§£ä»£ç å˜æ›´å†…å®¹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># .gitmessage
</span></span><span class=line><span class=cl># Commit type:
</span></span><span class=line><span class=cl>#   feat     - æ–°åŠŸèƒ½    - ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
</span></span><span class=line><span class=cl>#   fix      - Bugä¿®å¤   - ç™»å½•é¡µé¢è¡¨å•éªŒè¯é”™è¯¯
</span></span><span class=line><span class=cl>#   docs     - æ–‡æ¡£å˜æ›´  - æ›´æ–°APIæ¥å£æ–‡æ¡£
</span></span><span class=line><span class=cl>#   style    - ä»£ç æ ¼å¼  - è°ƒæ•´ä»£ç ç¼©è¿›
</span></span><span class=line><span class=cl>#   refactor - ä»£ç é‡æ„  - æå‡ºå…¬å…±å‡½æ•°
</span></span><span class=line><span class=cl>#   test     - æµ‹è¯•ç›¸å…³  - æ·»åŠ å•å…ƒæµ‹è¯•
</span></span><span class=line><span class=cl>#   perf     - æ€§èƒ½ä¼˜åŒ–  - ä¼˜åŒ–æ€§èƒ½
</span></span><span class=line><span class=cl>#   chore    - æ„å»º/ä¾èµ– - æ›´æ–°ä¾èµ–
</span></span><span class=line><span class=cl>#   revert   - å›æ»š      - å›æ»šåˆ°ä¸Šä¸€ä¸ªæäº¤
</span></span><span class=line><span class=cl>#   build    - æ„å»º      - æ·»åŠ æ„å»ºè„šæœ¬
</span></span><span class=line><span class=cl>#   ci       - CI/CD     - æ›´æ–°CIé…ç½®
</span></span><span class=line><span class=cl>#   release  - å‘å¸ƒ      - å‘å¸ƒæ–°ç‰ˆæœ¬
</span></span><span class=line><span class=cl># --------------------
</span></span><span class=line><span class=cl># Scope (å¯é€‰):
</span></span><span class=line><span class=cl>#   frontend, backend, infra, docs, config
</span></span><span class=line><span class=cl>#   ä½œç”¨åŸŸå±‚çº§ä¸è¶…è¿‡2çº§ï¼ˆå¦‚feat(backend/login)ï¼‰
</span></span><span class=line><span class=cl>#   æ–°æ¨¡å—é¦–æ¬¡æäº¤ä½¿ç”¨feat(module): initialize
</span></span><span class=line><span class=cl># --------------------
</span></span><span class=line><span class=cl># Subject (å¿…å¡«):
</span></span><span class=line><span class=cl>#   ä¸è¶…è¿‡50ä¸ªå­—ç¬¦ï¼Œé¦–å­—æ¯å°å†™ï¼Œç»“å°¾ä¸åŠ å¥å·
</span></span><span class=line><span class=cl># --------------------
</span></span><span class=line><span class=cl># Body (å¯é€‰):
</span></span><span class=line><span class=cl>#   è¯¦ç»†æè¿°ä¿®æ”¹å†…å®¹
</span></span><span class=line><span class=cl>#   ä½¿ç”¨ç¥ˆä½¿å¥ï¼ˆå¦‚&#34;Add&#34;è€Œé&#34;Added&#34;ï¼‰
</span></span><span class=line><span class=cl>#   è¯´æ˜å˜æ›´åŠ¨æœºï¼ˆWhy &gt; Whatï¼‰
</span></span><span class=line><span class=cl>#   æŠ€æœ¯æ–¹æ¡ˆæ‘˜è¦ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
</span></span><span class=line><span class=cl># --------------------
</span></span><span class=line><span class=cl># Footer (å¯é€‰):
</span></span><span class=line><span class=cl>#   BREAKING CHANGE: é‡å¤§å˜æ›´è¯´æ˜
</span></span><span class=line><span class=cl># --------------------
</span></span><span class=line><span class=cl># Issues (å¯é€‰):
</span></span><span class=line><span class=cl>#   Close #123, Fix #456
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{type}({scope}): {subject}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[body]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[footer]
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>é…ç½®ç”Ÿæ•ˆæ­¥éª¤</strong>ï¼šæ‰§è¡Œ<code>git config commit.template .gitmessage</code>ä½¿é…ç½®ç”Ÿæ•ˆã€‚</p></li><li><p><strong>å¼ºåˆ¶æ ¡éªŒï¼ˆæ¨èï¼‰</strong>ï¼š</p><ul><li><p>é¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ<code>npm install husky @commitlint/cli @commitlint/config-conventional --save-dev</code>ã€‚å…¶ä¸­ï¼Œ<code>husky</code>æ˜¯ Git hooks ç®¡ç†å·¥å…·ï¼Œ<code>@commitlint/cli</code>æ˜¯æäº¤ä¿¡æ¯æ ¡éªŒå‘½ä»¤è¡Œå·¥å…·ï¼Œ<code>@commitlint/config-conventional</code>æ˜¯ç¤¾åŒºæ ‡å‡†æ ¡éªŒè§„åˆ™ã€‚</p></li><li><p>æ¥ç€æ‰§è¡Œ<code>npx husky-init &amp;c& npm install</code>åˆå§‹åŒ– husky é…ç½®ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆ.husky ç›®å½•ç»“æ„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.husky/
</span></span><span class=line><span class=cl>â”œâ”€â”€ _
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ .gitignore
</span></span><span class=line><span class=cl>â””â”€â”€ pre-commit
</span></span></code></pre></td></tr></table></div></div></li><li><p>åœ¨æ ¹ç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶.commitlintrc.jsonï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;extends&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;@commitlint/config-conventional&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;rules&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;header-max-length&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;always&#34;</span><span class=p>,</span> <span class=mi>100</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>æœ€ååœ¨.husky/commit-msg ä¸­æ·»åŠ <code>npx commitlint --edit $1</code>ç»“åˆ Husky ä½¿ç”¨ã€‚</p></li></ul></li><li><p><strong>å®Œæ•´æäº¤ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>feat(payment): é›†æˆæ”¯ä»˜å®æ‰«ç æ”¯ä»˜
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- æ·»åŠ æ”¯ä»˜å®SDKåˆå§‹åŒ–é…ç½®
</span></span><span class=line><span class=cl>- å®ç°æ‰«ç æ”¯ä»˜æ ¸å¿ƒé€»è¾‘
</span></span><span class=line><span class=cl>- å¢åŠ æ”¯ä»˜ç»“æœå›è°ƒå¤„ç†
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>BREAKING CHANGE: æ”¯ä»˜æ¥å£è¿”å›ç»“æ„å˜æ›´
</span></span><span class=line><span class=cl>Closes #112, #113
</span></span><span class=line><span class=cl>Refs: #98
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>å¸¸è§é—®é¢˜æ’æŸ¥</strong>ï¼š</p><div class=table-wrapper><table><thead><tr><th>é—®é¢˜ç°è±¡</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><code>command not found: husky</code></td><td>é‡æ–°æ‰§è¡Œ<code>npm install husky --save-dev</code></td></tr><tr><td>é’©å­æœªç”Ÿæ•ˆ</td><td>æ£€æŸ¥.husky ç›®å½•æ˜¯å¦åœ¨.git åŒçº§ç›®å½•</td></tr><tr><td>Windows æƒé™é—®é¢˜</td><td>åœ¨ PowerShell æ‰§è¡Œ<code>Set-ExecutionPolicy RemoteSigned</code></td></tr><tr><td>éœ€è¦è·³è¿‡æ ¡éªŒ</td><td><code>git commit --no-verify</code> (æ…ç”¨)</td></tr></tbody></table></div></li></ul><h3 id=-git-å±æ€§é…ç½®gitattributes>ğŸ” Git å±æ€§é…ç½®ï¼ˆ.gitattributesï¼‰</h3><p>.gitattributes æ–‡ä»¶ç”¨äºå®šä¹‰ Git å¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># .gitattributes
</span></span><span class=line><span class=cl>* text=auto eol=lf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*.sh text eol=lf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*.md linguist-language=Markdown
</span></span><span class=line><span class=cl>*.ts linguist-language=TypeScript
</span></span><span class=line><span class=cl>*.tsx linguist-language=TSX
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>package-lock.json binary
</span></span><span class=line><span class=cl>yarn.lock binary
</span></span></code></pre></td></tr></table></div></div><p>ä¾‹å¦‚ï¼Œ<code>* text=auto eol=lf</code>è¡¨ç¤ºè‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å°†æ¢è¡Œç¬¦è®¾ç½®ä¸º LFï¼›<code>package-lock.json binary</code>åˆ™å°†<code>package - lock.json</code>æ–‡ä»¶æ ‡è®°ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¿å…åœ¨åˆå¹¶æ—¶å‡ºç°ä¸å¿…è¦çš„å†²çªã€‚</p><h3 id=-åŸºç¡€-eslint-é…ç½®eslintconfigmjs>ğŸš¨ åŸºç¡€ ESLint é…ç½®ï¼ˆeslint.config.mjsï¼‰</h3><p>ESLint ç”¨äºæ£€æŸ¥å’Œè§„èŒƒä»£ç è´¨é‡ã€‚</p><p>ä½¿ç”¨<code>npx @eslint/migrate-config .eslintrc</code>è½¬æ¢<code>.eslintrc</code>æ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mjs data-lang=mjs><span class=line><span class=cl><span class=c1>// eslint.config.mjs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;eslint/config&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>typescriptEslint</span> <span class=nx>from</span> <span class=s2>&#34;@typescript-eslint/eslint-plugin&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>react</span> <span class=nx>from</span> <span class=s2>&#34;eslint-plugin-react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>_import</span> <span class=nx>from</span> <span class=s2>&#34;eslint-plugin-import&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>reactHooks</span> <span class=nx>from</span> <span class=s2>&#34;eslint-plugin-react-hooks&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>fixupPluginRules</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@eslint/compat&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>tsParser</span> <span class=nx>from</span> <span class=s2>&#34;@typescript-eslint/parser&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s2>&#34;node:path&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>fileURLToPath</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;node:url&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>js</span> <span class=nx>from</span> <span class=s2>&#34;@eslint/js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>FlatCompat</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@eslint/eslintrc&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>__filename</span> <span class=o>=</span> <span class=nx>fileURLToPath</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>__dirname</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>dirname</span><span class=p>(</span><span class=nx>__filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>compat</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FlatCompat</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>baseDirectory</span><span class=o>:</span> <span class=nx>__dirname</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>recommendedConfig</span><span class=o>:</span> <span class=nx>js</span><span class=p>.</span><span class=nx>configs</span><span class=p>.</span><span class=nx>recommended</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>allConfig</span><span class=o>:</span> <span class=nx>js</span><span class=p>.</span><span class=nx>configs</span><span class=p>.</span><span class=nx>all</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>([</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>extends</span><span class=o>:</span> <span class=nx>compat</span><span class=p>.</span><span class=kr>extends</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;eslint:recommended&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;plugin:@typescript-eslint/recommended&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;plugin:react/recommended&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;prettier&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>plugins</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;@typescript-eslint&#34;</span><span class=o>:</span> <span class=nx>typescriptEslint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>react</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=kr>import</span><span class=o>:</span> <span class=nx>fixupPluginRules</span><span class=p>(</span><span class=nx>_import</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;react-hooks&#34;</span><span class=o>:</span> <span class=nx>fixupPluginRules</span><span class=p>(</span><span class=nx>reactHooks</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>languageOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>parser</span><span class=o>:</span> <span class=nx>tsParser</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>settings</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>react</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>version</span><span class=o>:</span> <span class=s2>&#34;detect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>rules</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;@typescript-eslint/no-explicit-any&#34;</span><span class=o>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;react/react-in-jsx-scope&#34;</span><span class=o>:</span> <span class=s2>&#34;off&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;@typescript-eslint/explicit-function-return-type&#34;</span><span class=o>:</span> <span class=s2>&#34;off&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;react-hooks/rules-of-hooks&#34;</span><span class=o>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;react-hooks/exhaustive-deps&#34;</span><span class=o>:</span> <span class=s2>&#34;warn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;import/order&#34;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;error&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>groups</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;builtin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;external&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;internal&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;parent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sibling&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;index&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>],</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;newlines-between&#34;</span><span class=o>:</span> <span class=s2>&#34;always&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;react/prop-types&#34;</span><span class=o>:</span> <span class=s2>&#34;off&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>ä»¥<code>import/order</code>è§„åˆ™ä¸ºä¾‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»Ÿä¸€æ¨¡å—å¯¼å…¥é¡ºåºã€‚åˆ†ç»„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p><ul><li><code>builtin</code>ï¼šNode.js å†…ç½®æ¨¡å—ï¼ˆå¦‚<code>path</code>ï¼‰</li><li><code>external</code>ï¼š<code>node_modules</code>ä¾èµ–</li><li><code>internal</code>ï¼šé¡¹ç›®å†…éƒ¨åˆ«åè·¯å¾„</li><li><code>parent</code>ï¼šçˆ¶ç›®å½•å¼•ç”¨</li><li><code>sibling</code>ï¼šåŒçº§ç›®å½•</li><li><code>index</code>ï¼šç›®å½•ç´¢å¼•æ–‡ä»¶
ä¾‹å¦‚ï¼š</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// âœ… æ­£ç¡®é¡ºåº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s2>&#34;path&#34;</span><span class=p>;</span> <span class=c1>// builtin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span> <span class=c1>// external
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>Button</span> <span class=nx>from</span> <span class=s2>&#34;@/components/Button&#34;</span><span class=p>;</span> <span class=c1>// internal
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>utils</span> <span class=nx>from</span> <span class=s2>&#34;../utils&#34;</span><span class=p>;</span> <span class=c1>// parent
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>styles</span> <span class=nx>from</span> <span class=s2>&#34;./styles.module.css&#34;</span><span class=p>;</span> <span class=c1>// sibling
</span></span></span></code></pre></td></tr></table></div></div><h3 id=-prettier-æ ¼å¼åŒ–é…ç½®prettierrc>ğŸ¨ Prettier æ ¼å¼åŒ–é…ç½®ï¼ˆ.prettierrcï¼‰</h3><p>Prettier ç”¨äºä»£ç æ ¼å¼åŒ–ï¼Œä¿æŒä»£ç é£æ ¼ä¸€è‡´ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;printWidth&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tabWidth&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;useTabs&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;semi&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;singleQuote&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;trailingComma&#34;</span><span class=p>:</span> <span class=s2>&#34;all&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;bracketSpacing&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;arrowParens&#34;</span><span class=p>:</span> <span class=s2>&#34;avoid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;endOfLine&#34;</span><span class=p>:</span> <span class=s2>&#34;lf&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¾‹å¦‚ï¼Œ<code>printWidth</code>è®¾ç½®ä¸º 100ï¼Œè¡¨ç¤ºä¸€è¡Œä»£ç çš„æœ€å¤§å®½åº¦ä¸º 100 ä¸ªå­—ç¬¦ï¼›<code>singleQuote</code>è®¾ç½®ä¸º<code>true</code>è¡¨ç¤ºä½¿ç”¨å•å¼•å·ã€‚</p><h3 id=-husky-æäº¤è§„èŒƒhusky>ğŸ¶ Husky æäº¤è§„èŒƒï¼ˆ.husky/ï¼‰</h3><p>Husky å¯ä»¥åœ¨ Git æ“ä½œçš„ç‰¹å®šé˜¶æ®µæ‰§è¡Œè„šæœ¬ï¼Œç¡®ä¿ä»£ç è§„èŒƒã€‚åœ¨é…ç½® Husky æ—¶ï¼Œlint:staged å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚</p><h4 id=å®‰è£…ä¾èµ–><strong>å®‰è£…ä¾èµ–</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install lint-staged --save-dev
</span></span><span class=line><span class=cl><span class=c1># å®‰è£…ESLintä¾èµ–</span>
</span></span><span class=line><span class=cl>npm install eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin --save-dev
</span></span><span class=line><span class=cl><span class=c1># åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ</span>
</span></span><span class=line><span class=cl>npm install prettier --save-dev
</span></span></code></pre></td></tr></table></div></div><h4 id=ä¿®æ”¹><strong>ä¿®æ”¹<code>package.json</code></strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;echo \&#34;Tests placeholder\&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;lint:staged&#34;</span><span class=p>:</span> <span class=s2>&#34;lint-staged&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;lint-staged&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;*.{js,ts,tsx}&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;eslint --fix&#34;</span><span class=p>,</span> <span class=s2>&#34;prettier --write&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨æ­¤é…ç½®ä¸­ï¼Œ<code>lint-staged</code>å®šä¹‰äº†å¯¹æš‚å­˜çš„ç‰¹å®šæ–‡ä»¶ï¼ˆå¦‚<code>.js</code>ã€<code>.ts</code>ã€<code>.tsx</code>æ–‡ä»¶ï¼‰æ‰§è¡Œ<code>eslint --fix</code>è¿›è¡Œä»£ç æ£€æŸ¥å’Œä¿®å¤ï¼Œä»¥åŠ<code>prettier --write</code>è¿›è¡Œä»£ç æ ¼å¼åŒ–ã€‚</p><h4 id=ä¿®æ”¹-1><strong>ä¿®æ”¹<code>.husky/pre-commit</code></strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>. <span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>/_/husky.sh&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>npm run lint:staged
</span></span></code></pre></td></tr></table></div></div><p>ä¿®æ”¹åï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œ<code>git commit</code>è¿›è¡Œæäº¤æ—¶ï¼ŒHusky çš„<code>pre-commit</code>é’©å­ä¼šè‡ªåŠ¨è¿è¡Œ<code>npm run lint:staged</code>ï¼Œå¯¹æš‚å­˜æ–‡ä»¶è¿›è¡Œé¢„å…ˆæ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼Œç¡®ä¿æäº¤çš„ä»£ç ç¬¦åˆå›¢é˜Ÿè®¾å®šçš„ä»£ç è§„èŒƒã€‚</p><p>æ•´ä½“æ¥çœ‹ï¼ŒHusky ç»“åˆ lint:stagedï¼Œèƒ½å¤Ÿåœ¨ä»£ç æäº¤çš„å…³é”®èŠ‚ç‚¹ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–çš„è„šæœ¬æ‰§è¡Œï¼Œæœ‰æ•ˆæå‡ä»£ç è´¨é‡ï¼Œå‡å°‘å› ä»£ç é£æ ¼ä¸ä¸€è‡´ç­‰é—®é¢˜å¼•å‘çš„æ½œåœ¨é”™è¯¯å’Œæ²Ÿé€šæˆæœ¬ã€‚</p><h3 id=-åŸºç¡€ç¯å¢ƒæ¨¡æ¿envexample>ğŸŒ± åŸºç¡€ç¯å¢ƒæ¨¡æ¿ï¼ˆ.env.exampleï¼‰</h3><p>.env.example æ–‡ä»¶ç”¨äºå®šä¹‰é¡¹ç›®æ‰€éœ€çš„ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼Œæ–¹ä¾¿å›¢é˜Ÿæˆå‘˜äº†è§£å’Œé…ç½®ç¯å¢ƒã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=c1># å‰ç«¯</span>
</span></span><span class=line><span class=cl><span class=nv>VITE_API_BASE_URL</span><span class=o>=</span>http://localhost:4000/api/v1
</span></span><span class=line><span class=cl><span class=nv>VITE_SENTRY_DSN</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åç«¯</span>
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>4000</span>
</span></span><span class=line><span class=cl><span class=nv>MONGO_URI</span><span class=o>=</span>mongodb://mongo:27017/blog
</span></span><span class=line><span class=cl><span class=nv>JWT_SECRET</span><span class=o>=</span>change_this_in_production
</span></span></code></pre></td></tr></table></div></div><p>ä¾‹å¦‚ï¼Œå‰ç«¯é€šè¿‡<code>VITE_API_BASE_URL</code>é…ç½®åç«¯ API çš„åŸºç¡€åœ°å€ï¼›åç«¯é€šè¿‡<code>MONGO_URI</code>é…ç½® MongoDB çš„è¿æ¥å­—ç¬¦ä¸²ã€‚</p><h3 id=ä»£ç åˆ«åè®¾ç½®>ä»£ç åˆ«åè®¾ç½®</h3><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œåˆç†è®¾ç½®ä»£ç åˆ«åèƒ½æœ‰æ•ˆç®€åŒ–æ¨¡å—å¯¼å…¥è·¯å¾„ï¼Œæå‡ä»£ç çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚</p><h4 id=vite-é…ç½®><strong>Vite é…ç½®</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// https://vite.dev/config/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s2>&#34;node:path&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>resolve</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>alias</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;@&#34;</span><span class=o>:</span> <span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s2>&#34;./src&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ä¸Šè¿° Vite é…ç½®ä¸­ï¼Œé€šè¿‡<code>resolve.alias</code>å­—æ®µï¼Œå°†<code>@</code>åˆ«åæŒ‡å‘é¡¹ç›®çš„<code>src</code>ç›®å½•ã€‚è¿™æ„å‘³ç€åœ¨å‰ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@</code>æ¥ä»£æ›¿å†—é•¿çš„<code>src</code>è·¯å¾„å‰ç¼€è¿›è¡Œæ¨¡å—å¯¼å…¥ï¼Œä¾‹å¦‚<code>import { someFunction } from '@/utils/someFunction';</code>ï¼Œç›¸æ¯”<code>import { someFunction } from '../../../src/utils/someFunction';</code>æ›´åŠ ç®€æ´æ˜äº†ã€‚</p><h4 id=typescript-é…ç½®åœ¨æ‰€æœ‰-tsconfigjson-ç›¸å…³æ–‡ä»¶ä¸­><strong>TypeScript é…ç½®ï¼ˆåœ¨æ‰€æœ‰ tsconfig.json ç›¸å…³æ–‡ä»¶ä¸­ï¼‰</strong></h4><p>åœ¨<code>tsconfig.json</code>ã€<code>tsconfig.app.json</code>ã€<code>tsconfig.node.json</code>ã€<code>tsconfig.build.json</code>ç­‰ TypeScript é…ç½®æ–‡ä»¶ä¸­ï¼Œéœ€è¦åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;compilerOptions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;baseUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;paths&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;@/*&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;./src/*&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ï¼Œ<code>baseUrl</code>è®¾ç½®ä¸º<code>.</code>è¡¨ç¤ºä»¥é¡¹ç›®æ ¹ç›®å½•ä¸ºåŸºå‡†è·¯å¾„ã€‚<code>paths</code>å­—æ®µå®šä¹‰äº†è·¯å¾„æ˜ å°„è§„åˆ™ï¼Œ<code>@/*</code>è¡¨ç¤ºä»¥<code>@</code>å¼€å¤´çš„è·¯å¾„ï¼Œæ˜ å°„åˆ°<code>./src/*</code>ï¼Œå³<code>src</code>ç›®å½•ä¸‹çš„ç›¸åº”æ–‡ä»¶æˆ–å­ç›®å½•ã€‚è¿™æ ·ï¼ŒTypeScript ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶èƒ½å¤Ÿæ­£ç¡®è§£æä½¿ç”¨<code>@</code>åˆ«åçš„å¯¼å…¥è·¯å¾„ï¼Œç¡®ä¿é¡¹ç›®åœ¨ TypeScript ç¯å¢ƒä¸‹çš„æ­£å¸¸è¿è¡Œä¸ç±»å‹æ£€æŸ¥ã€‚</p><p>é€šè¿‡å®Œæˆä»¥ä¸Šé€šç”¨åŸºç¡€è®¾æ–½é…ç½®ï¼ŒåŒ…æ‹¬ä»£ç åˆ«åè®¾ç½®ï¼Œèƒ½å¤Ÿæå¤§æå‡å›¢é˜Ÿåä½œæ•ˆç‡ï¼Œå‡å°‘ä»£ç é£æ ¼ä¸ä¸€è‡´ã€æäº¤ä¿¡æ¯ä¸è§„èŒƒç­‰é—®é¢˜ï¼Œä¸ºå…¨æ ˆåšå®¢ç³»ç»Ÿçš„æŒç»­å¼€å‘æä¾›æœ‰åŠ›ä¿éšœã€‚</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><script src=//unpkg.com/@waline/client@v2/dist/waline.js></script><link href=//unpkg.com/@waline/client@v2/dist/waline.css rel=stylesheet><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script>Waline.init({avatar:"",dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],lang:"zh-CN",locale:{admin:"Admin",placeholder:"è¯´ç‚¹å•¥~"},requiredMeta:["nick","mail","url"],serverURL:"comment.cycbloom.com"})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 éé‡‘é˜</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>