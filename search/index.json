[{"content":" ğŸ› ï¸ ä»£ç æ„ç­‘ç†æƒ³ï¼ŒğŸ“– æ–‡å­—è®°å½•æˆé•¿\nğŸŒ± å¯ç¨‹è€…çš„ç‹¬ç™½ æ¯•ä¸šå­£ä¸´è¿‘ï¼Œæˆ‘åœ¨æŠ€æœ¯çŸ¥è¯†ä¸ä¸ªäººå±¥å†æ–¹é¢å‡ ä¹ä¸€ç‰‡ç©ºç™½ã€‚å›é¡¾å¤§å­¦å››å¹´ï¼Œå¾ˆå¤šå®è´µçš„å­¦ä¹ æ—¶é—´éƒ½è¢«æµªè´¹äº†ã€‚\nç»è¿‡åæ€ï¼Œæˆ‘æ¸…æ¥šåœ°è®¤è¯†åˆ°è‡ªå·±é¢ä¸´çš„ç°çŠ¶ï¼š\né¡¹ç›®ç»éªŒä¸¥é‡ä¸è¶³ï¼Œèƒ½åŠ›è–„å¼±ã€‚ çŸ¥è¯†å‚¨å¤‡åŒ®ä¹ï¼Œè®¸å¤šä¸“ä¸šçŸ¥è¯†é¢†åŸŸéƒ½æ²¡æœ‰æ¶‰è¶³ã€‚ å°šæœªå»ºç«‹ä¸ªäººå“ç‰Œï¼Œåœ¨è¡Œä¸šå†…æ¯«æ— å½±å“åŠ›ã€‚ ğŸš€ æ ¸å¿ƒä¸»çº¿ä»»åŠ¡ ğŸ› ï¸ æŠ€æœ¯æˆé•¿ ä¸ºç­‘ç‰¢æŠ€æœ¯æ ¹åŸºï¼Œæˆ‘è®¡åˆ’å€ŸåŠ©çº¿ä¸Šè¯¾ç¨‹ä¸å®˜æ–¹æ–‡æ¡£ï¼Œæ·±å…¥é’»ç ” Pythonã€JavaScript ç­‰ä¸»æµç¼–ç¨‹è¯­è¨€çš„æ ¸å¿ƒè¯­æ³•ä¸ç‰¹æ€§ï¼ŒåŒæ—¶æŒæ¡ Vueã€Django ç­‰å¼€å‘æ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œä»ç†è®ºå±‚é¢å¤¯å®åŸºç¡€ã€‚ä¸ºç§¯ç´¯å®æˆ˜ç»éªŒï¼Œæˆ‘æ‰“ç®—ç§¯æå‚ä¸å¼€æºé¡¹ç›®ï¼Œä¸»åŠ¨æ‰¿æ¥å°å‹å¤–åŒ…é¡¹ç›®ï¼Œåœ¨å®è·µä¸­åŠ æ·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚æ¯æ¬¡é¡¹ç›®ç»“æŸåï¼Œæˆ‘ä¼šå¯¹æˆæœè¿›è¡Œç³»ç»Ÿæ•´ç†ï¼Œå¹¶å¤ç›˜æŠ€æœ¯éš¾é¢˜çš„è§£å†³è¿‡ç¨‹ã€‚ä¸ºç´§è·ŸæŠ€æœ¯å‰æ²¿ï¼Œæ”»å…‹å¤æ‚æŠ€æœ¯éš¾é¢˜ï¼Œæˆ‘ä¼šå®šæœŸæµè§ˆæŠ€æœ¯è®ºå›ï¼Œå…³æ³¨å‰æ²¿ç ”ç©¶ï¼Œé’ˆå¯¹é«˜å¹¶å‘å¤„ç†ã€æ•°æ®å®‰å…¨ç­‰å…³é”®é¢†åŸŸå±•å¼€ä¸“é¡¹å­¦ä¹ ã€‚\nğŸ“š çŸ¥è¯†ç®¡ç† æˆ‘å°†å€ŸåŠ©ç¬”è®°è½¯ä»¶æ­å»ºä¸€å¥—å…¨é¢çš„æŠ€æœ¯çŸ¥è¯†ä½“ç³»ï¼ŒæŒ‰ç…§ç¼–ç¨‹è¯­è¨€ã€ç®—æ³•ã€å¼€å‘å·¥å…·ç­‰ç±»åˆ«è¿›è¡Œåˆ†ç±»ç®¡ç†ï¼Œè®©çŸ¥è¯†è„‰ç»œä¸€ç›®äº†ç„¶ã€‚åœ¨æ—¥å¸¸å­¦ä¹ å’Œé¡¹ç›®å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šæŠŠå­¦åˆ°çš„çŸ¥è¯†ã€ç§¯ç´¯çš„ç»éªŒä»¥æ–‡æœ¬ã€ä»£ç ç‰‡æ®µã€æ¡ˆä¾‹åˆ†æç­‰å½¢å¼è®°å½•åˆ°çŸ¥è¯†åº“ä¸­ï¼ŒæŒç»­ä¸°å¯ŒçŸ¥è¯†å‚¨å¤‡ã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜ä¼šæ’°å†™æŠ€æœ¯åšå®¢ï¼Œå°†å¤æ‚çš„æŠ€æœ¯çŸ¥è¯†ä»¥é€šä¿—æ˜“æ‡‚çš„è¯­è¨€åˆ†äº«å‡ºå»ï¼Œé€šè¿‡æ¥å—è¯»è€…åé¦ˆï¼Œè¿›ä¸€æ­¥åŠ æ·±å¯¹çŸ¥è¯†çš„ç†è§£ã€‚\nğŸ… ä¸ªäººå“ç‰Œå»ºè®¾ æˆ‘ä¼šåœ¨ GitHubã€æŠ€æœ¯è®ºå›ç­‰å¹³å°å®Œå–„ä¸ªäººèµ„æ–™ï¼Œä¸Šä¼ ä¸ªäººå¤´åƒï¼Œæ’°å†™ç®€ä»‹ï¼Œå±•ç¤ºé¡¹ç›®æˆæœï¼Œæ‰“é€ ä¸“ä¸šçš„çº¿ä¸Šå½¢è±¡ã€‚åŒæ—¶ï¼Œç§¯æå‚ä¸æŠ€æœ¯ç¤¾åŒºçš„è®¨è®ºï¼Œä¸»åŠ¨è§£ç­”ä»–äººé—®é¢˜ï¼Œåˆ†äº«ä¸ªäººè§è§£ï¼Œæå‡åœ¨ç¤¾åŒºå†…çš„æ´»è·ƒåº¦å’ŒçŸ¥ååº¦ã€‚æ­¤å¤–ï¼Œæˆ‘ä¼šå°†ä¼˜è´¨çš„é¡¹ç›®æˆæœå’ŒæŠ€æœ¯æ–‡ç« æ•´ç†æˆä½œå“é›†ï¼Œå…¨æ–¹ä½å±•ç¤ºä¸ªäººæŠ€æœ¯ä¼˜åŠ¿å’Œä¸“ä¸šèƒ½åŠ›ï¼Œå¸å¼•æ½œåœ¨åˆä½œä¼™ä¼´å’Œé›‡ä¸»çš„å…³æ³¨ ã€‚\nğŸ® å…³äºéé‡‘é˜ ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼ŒæŠŠæŠ€æœ¯å­¦ä¹ å½“æˆä¸€åœºæ¸¸æˆï¼Œæ¯æ”»å…‹ä¸€ä¸ªéš¾é¢˜ï¼Œå°±åƒå‡çº§æ‰“æ€ªä¸€æ ·è·å¾—æˆå°±æ„Ÿï¼Ÿæˆ‘å°±æ‰“ç®—è¿™ä¹ˆå¹²ï¼æˆ‘æƒ³ä»¥ç†Ÿç»ƒåº¦ç³»ç»Ÿä¸ºä¸»é¢˜ï¼ŒæŠŠæˆ‘çš„åšå®¢ â€”â€” éé‡‘é˜ï¼Œæ‰“é€ å¾—åˆ«å…·ä¸€æ ¼ã€‚â€‹\nåœ¨éé‡‘é˜é‡Œï¼Œæ¯ä¸€é¡¹æŠ€æœ¯çŸ¥è¯†éƒ½ä¼šè¢«åˆ’åˆ†æˆä¸åŒçš„ç†Ÿç»ƒåº¦ç­‰çº§ã€‚ä»æœ€åˆçš„ â€œæ–°æ‰‹å°ç™½â€ åˆ°ç‚‰ç«çº¯é’çš„ â€œå¤§å¸ˆçº§åˆ«â€ï¼Œå°±åƒæ¸¸æˆé€šå…³ä¸€æ ·ï¼Œä¼´éšç€ä¸€æ­¥æ­¥çš„æˆé•¿ã€‚å½“ä½ è·Ÿç€æˆ‘åˆ†äº«çš„æ–‡ç« å­¦ä¹ ï¼Œä½ ä¼šçœ‹åˆ°æ¯é¡¹æŠ€æœ¯å¦‚ä½•ä»åŸºç¡€çš„ç†è®ºï¼Œä¸€æ­¥æ­¥åœ¨å®è·µä¸­è¢«æ‰“ç£¨ï¼Œç›´è‡³æˆä¸ºå¯ä»¥çµæ´»è¿ç”¨çš„ â€œå¿…æ€æŠ€â€ã€‚â€‹\næˆ‘è¿˜ä¼šå°†æ¯æ¬¡å­¦ä¹ å’Œå®è·µè¿‡ç¨‹ä¸­çš„é¡¹ç›®ç»éªŒã€è¸©è¿‡çš„å‘ä»¥åŠè§£å†³æ–¹æ¡ˆï¼ŒæŒ‰ç…§ç†Ÿç»ƒåº¦ä½“ç³»æ¢³ç†å‡ºæ¥ã€‚æ— è®ºæ˜¯å¯¹åˆšå…¥é—¨çš„ç¼–ç¨‹å°ç™½ï¼Œè¿˜æ˜¯å·²ç»æœ‰ä¸€å®šç»éªŒï¼Œæƒ³è¦çªç ´æŠ€æœ¯ç“¶é¢ˆçš„å¼€å‘è€…æ¥è¯´ï¼Œéƒ½èƒ½åœ¨éé‡‘é˜æ‰¾åˆ°å¯¹åº”é˜¶æ®µçš„ â€œé€šå…³ç§˜ç±â€ã€‚â€‹\næˆ‘æœŸå¾…éé‡‘é˜ä¸ä»…æ˜¯æˆ‘è®°å½•æŠ€æœ¯æˆé•¿çš„å¹³å°ï¼Œæ›´èƒ½æˆä¸ºå¤§å®¶å…±åŒå­¦ä¹ ã€äº¤æµçš„æŠ€æœ¯ä¹å›­ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸€èµ·é€šè¿‡ä»£ç æ„ç­‘ç†æƒ³ï¼Œç”¨æ–‡å­—è®°å½•æˆé•¿ã€‚\nå…³äºåšå®¢æ­å»ºæ¡†æ¶ Stack For more information about this theme, check the documentation: https://stack.jimmycai.com/\nWant a site like this? Check out hugo-theme-stack-stater\nPhoto by Pawel Czerwinski on Unsplash\n","date":"2025-04-10T19:00:00+08:00","image":"https://blog.cycbloom.com/p/hello-world/cover_hu_e95a4276bf860a84.jpg","permalink":"https://blog.cycbloom.com/p/hello-world/","title":"Hello World"},{"content":" Chapter6: ä»»åŠ¡ç®¡ç†ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç° â€”â€”åŸºäº React å’Œ Zustand çš„ç°ä»£åŒ–ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ\nä¸€ã€çŠ¶æ€ç®¡ç†è®¾è®¡ TactiCore çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿé‡‡ç”¨ Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œå®ç°äº†é«˜æ•ˆçš„ä»»åŠ¡æ•°æ®å¤„ç†å’Œè¿‡æ»¤åŠŸèƒ½ã€‚\n1. ä»»åŠ¡çŠ¶æ€å­˜å‚¨è®¾è®¡ ä½¿ç”¨ Zustand åˆ›å»ºä»»åŠ¡çŠ¶æ€å­˜å‚¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 interface TaskState { tasks: Task[]; loading: boolean; error: string | null; selectedTask: Task | null; filters: { status: string; priority: string; search: string; }; } interface TaskActions { setTasks: (tasks: Task[]) =\u0026gt; void; setLoading: (loading: boolean) =\u0026gt; void; setError: (error: string | null) =\u0026gt; void; setSelectedTask: (task: Task | null) =\u0026gt; void; setFilters: (filters: Partial\u0026lt;TaskState[\u0026#34;filters\u0026#34;]\u0026gt;) =\u0026gt; void; addTask: (task: Task) =\u0026gt; void; updateTask: (task: Task) =\u0026gt; void; deleteTask: (id: string) =\u0026gt; void; } const useTaskStore = create\u0026lt;TaskState \u0026amp; TaskActions\u0026gt;((set) =\u0026gt; ({ // åˆå§‹çŠ¶æ€ tasks: [], loading: false, error: null, selectedTask: null, filters: { status: \u0026#34;all\u0026#34;, priority: \u0026#34;all\u0026#34;, search: \u0026#34;\u0026#34;, }, // çŠ¶æ€æ›´æ–°æ–¹æ³• setTasks: (tasks) =\u0026gt; set({ tasks }), setLoading: (loading) =\u0026gt; set({ loading }), setError: (error) =\u0026gt; set({ error }), setSelectedTask: (task) =\u0026gt; set({ selectedTask: task }), setFilters: (filters) =\u0026gt; set((state) =\u0026gt; ({ filters: { ...state.filters, ...filters }, })), addTask: (task) =\u0026gt; set((state) =\u0026gt; ({ tasks: [...state.tasks, task], })), updateTask: (task) =\u0026gt; set((state) =\u0026gt; ({ tasks: state.tasks.map((t) =\u0026gt; (t.id === task.id ? task : t)), })), deleteTask: (id) =\u0026gt; set((state) =\u0026gt; ({ tasks: state.tasks.filter((t) =\u0026gt; t.id !== id), })), })); çŠ¶æ€ç®¡ç†ç‰¹ç‚¹ï¼š\nçŠ¶æ€é›†ä¸­ç®¡ç†ï¼šæ‰€æœ‰ä»»åŠ¡ç›¸å…³çŠ¶æ€ç»Ÿä¸€ç®¡ç† ç±»å‹å®‰å…¨ï¼šä½¿ç”¨ TypeScript æ¥å£ç¡®ä¿ç±»å‹å®‰å…¨ ä¸å¯å˜æ›´æ–°ï¼šä½¿ç”¨ä¸å¯å˜æ–¹å¼æ›´æ–°çŠ¶æ€ è¿‡æ»¤çŠ¶æ€ï¼šåŒ…å«ä»»åŠ¡è¿‡æ»¤æ¡ä»¶çš„çŠ¶æ€ç®¡ç† äºŒã€API å±‚è®¾è®¡ 1. ä»»åŠ¡ API å°è£… ä½¿ç”¨ Axios å°è£…ä»»åŠ¡ç›¸å…³çš„ API è¯·æ±‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 export const taskApi = { // è·å–ä»»åŠ¡åˆ—è¡¨ getTasks: (filters: FilterFormData) =\u0026gt; { const cleanedFilters = cleanFilters(filters); return request.get\u0026lt;Task[]\u0026gt;(\u0026#34;/tasks\u0026#34;, { params: cleanedFilters, headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, } as AxiosRequestHeaders, }); }, // è·å–å•ä¸ªä»»åŠ¡ getTask: (id: string) =\u0026gt; { return request.get\u0026lt;Task\u0026gt;(`/tasks/${id}`); }, // åˆ›å»ºä»»åŠ¡ createTask: (taskData: TaskFormData) =\u0026gt; { return request.post\u0026lt;Task\u0026gt;(\u0026#34;/tasks\u0026#34;, taskData); }, // æ›´æ–°ä»»åŠ¡ updateTask: (id: string, taskData: Partial\u0026lt;TaskFormData\u0026gt;) =\u0026gt; { return request.put\u0026lt;Task\u0026gt;(`/tasks/${id}`, taskData); }, // åˆ é™¤ä»»åŠ¡ deleteTask: (id: string) =\u0026gt; { return request.delete(`/tasks/${id}`); }, }; API ç‰¹ç‚¹ï¼š\næ™ºèƒ½è¿‡æ»¤ï¼šè‡ªåŠ¨æ¸…ç†æ— æ•ˆçš„è¿‡æ»¤æ¡ä»¶ ç±»å‹å®‰å…¨ï¼šä½¿ç”¨æ³›å‹ç¡®ä¿å“åº”ç±»å‹ ç»Ÿä¸€ç®¡ç†ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰ä»»åŠ¡ç›¸å…³çš„ API ä¸‰ã€ç»„ä»¶å®ç° 1. ä»»åŠ¡é¡µé¢ç»„ä»¶ TaskPage ä½œä¸ºä»»åŠ¡ç®¡ç†çš„å®¹å™¨ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 const TaskPage: React.FC = () =\u0026gt; { const { tasks, loading, error, filters, setTasks, setLoading, setError, setFilters, addTask, updateTask, deleteTask, } = useTaskStore(); useEffect(() =\u0026gt; { const fetchTasks = async () =\u0026gt; { try { setLoading(true); const data = await taskApi.getTasks(filters as FilterFormData); setTasks(data); } catch (err) { setError(err instanceof Error ? err.message : \u0026#34;è·å–ä»»åŠ¡å¤±è´¥\u0026#34;); } finally { setLoading(false); } }; fetchTasks(); }, [filters]); // ... ä»»åŠ¡æ“ä½œå¤„ç†æ–¹æ³• return ( \u0026lt;Container maxWidth=\u0026#34;lg\u0026#34;\u0026gt; \u0026lt;Box sx={{ my: 4 }}\u0026gt; \u0026lt;Typography variant=\u0026#34;h4\u0026#34; component=\u0026#34;h1\u0026#34; gutterBottom\u0026gt; ä»»åŠ¡ç®¡ç† \u0026lt;/Typography\u0026gt; \u0026lt;TaskList tasks={tasks} filters={filters as FilterFormData} onFilterChange={handleFilterChange} onEditTask={handleEditTask} onDeleteTask={handleDeleteTask} onToggleStatus={handleToggleStatus} onCreateTask={handleCreateTask} /\u0026gt; \u0026lt;/Box\u0026gt; \u0026lt;/Container\u0026gt; ); }; 2. ä»»åŠ¡åˆ—è¡¨ç»„ä»¶ TaskList è´Ÿè´£å±•ç¤ºä»»åŠ¡åˆ—è¡¨å’Œè¿‡æ»¤åŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 const TaskList: React.FC\u0026lt;TaskListProps\u0026gt; = ({ tasks, filters, onFilterChange, onEditTask, onDeleteTask, onToggleStatus, onCreateTask, }) =\u0026gt; { const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false); return ( \u0026lt;Box\u0026gt; \u0026lt;Stack spacing={2} sx={{ mb: 3 }}\u0026gt; \u0026lt;TaskFilter filters={filters} onFilterChange={onFilterChange} /\u0026gt; \u0026lt;Button variant=\u0026#34;contained\u0026#34; onClick={() =\u0026gt; setIsCreateDialogOpen(true)}\u0026gt; åˆ›å»ºä»»åŠ¡ \u0026lt;/Button\u0026gt; \u0026lt;/Stack\u0026gt; \u0026lt;Stack spacing={2}\u0026gt; {tasks.map((task) =\u0026gt; ( \u0026lt;TaskCard key={task.id} task={task} onEdit={() =\u0026gt; onEditTask(task)} onDelete={() =\u0026gt; onDeleteTask(task.id)} onStatusChange={() =\u0026gt; onToggleStatus(task.id)} /\u0026gt; ))} \u0026lt;/Stack\u0026gt; \u0026lt;Dialog open={isCreateDialogOpen} onClose={() =\u0026gt; setIsCreateDialogOpen(false)} maxWidth=\u0026#34;sm\u0026#34; fullWidth \u0026gt; \u0026lt;Box sx={{ p: 3 }}\u0026gt; \u0026lt;TaskForm onSubmit={onCreateTask} onCancel={() =\u0026gt; setIsCreateDialogOpen(false)} /\u0026gt; \u0026lt;/Box\u0026gt; \u0026lt;/Dialog\u0026gt; \u0026lt;/Box\u0026gt; ); }; 3. ä»»åŠ¡è¿‡æ»¤ç»„ä»¶ TaskFilter å®ç°ä»»åŠ¡è¿‡æ»¤åŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 const TaskFilter: React.FC\u0026lt;TaskFilterProps\u0026gt; = ({ filters, onFilterChange }) =\u0026gt; { return ( \u0026lt;BaseForm\u0026lt;FilterFormData\u0026gt; onSubmit={onFilterChange} defaultValues={filters} schema={filterSchema} formTitle=\u0026#34;\u0026#34; submitButtonText=\u0026#34;\u0026#34; resetAfterSubmit={false} onFormDataChange={onFilterChange} \u0026gt; \u0026lt;Box sx={{ display: \u0026#34;flex\u0026#34;, gap: 2, alignItems: \u0026#34;flex-start\u0026#34; }}\u0026gt; \u0026lt;Box sx={{ flex: 2 }}\u0026gt; \u0026lt;FormInput name=\u0026#34;search\u0026#34; label=\u0026#34;æœç´¢ä»»åŠ¡\u0026#34; /\u0026gt; \u0026lt;/Box\u0026gt; \u0026lt;Box sx={{ flex: 1 }}\u0026gt; \u0026lt;GenericSelect name=\u0026#34;status\u0026#34; label=\u0026#34;çŠ¶æ€ç­›é€‰\u0026#34; options={statusOptionsWithAll} /\u0026gt; \u0026lt;/Box\u0026gt; \u0026lt;Box sx={{ flex: 1 }}\u0026gt; \u0026lt;GenericSelect name=\u0026#34;priority\u0026#34; label=\u0026#34;ä¼˜å…ˆçº§ç­›é€‰\u0026#34; options={priorityOptionsWithAll} /\u0026gt; \u0026lt;/Box\u0026gt; \u0026lt;/Box\u0026gt; \u0026lt;/BaseForm\u0026gt; ); }; å››ã€è·¯ç”±é…ç½® ä½¿ç”¨ React Router é…ç½®ä»»åŠ¡ç®¡ç†è·¯ç”±ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 export const router = createBrowserRouter([ { path: \u0026#34;/\u0026#34;, element: ( \u0026lt;ProtectedRoute\u0026gt; \u0026lt;Outlet /\u0026gt; \u0026lt;/ProtectedRoute\u0026gt; ), children: [ { path: \u0026#34;tasks\u0026#34;, element: \u0026lt;TaskPage /\u0026gt;, }, ], }, ]); äº”ã€æ€»ç»“ä¸å±•æœ› TactiCore çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ç°ä»£åŒ–ä»»åŠ¡ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚\næŠ€æœ¯äº®ç‚¹ï¼š\nçŠ¶æ€ç®¡ç†ï¼šä½¿ç”¨ Zustand å®ç°é«˜æ•ˆçš„çŠ¶æ€ç®¡ç† ç»„ä»¶è®¾è®¡ï¼šé‡‡ç”¨ç»„ä»¶åŒ–è®¾è®¡ï¼Œæé«˜ä»£ç å¤ç”¨æ€§ ç±»å‹å®‰å…¨ï¼šå…¨é¢ä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨ å®æ—¶è¿‡æ»¤ï¼šå®ç°äº†å®æ—¶ä»»åŠ¡è¿‡æ»¤åŠŸèƒ½ å“åº”å¼è®¾è®¡ï¼šä½¿ç”¨ Material-UI å®ç°å“åº”å¼ç•Œé¢ æœªæ¥å±•æœ›ï¼š\næ·»åŠ ä»»åŠ¡æ‹–æ‹½æ’åºåŠŸèƒ½ å®ç°ä»»åŠ¡æ ‡ç­¾ç³»ç»Ÿ æ·»åŠ ä»»åŠ¡ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½ ä¼˜åŒ–ä»»åŠ¡æœç´¢æ€§èƒ½ æ·»åŠ ä»»åŠ¡å¯¼å‡ºåŠŸèƒ½ é€šè¿‡è¿™äº›æ¨¡å—çš„å®ç°ï¼ŒTactiCore æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç”¨æˆ·å‹å¥½çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œä¸ºç”¨æˆ·æä¾›é«˜æ•ˆçš„ä»»åŠ¡ç®¡ç†ä½“éªŒã€‚\n","date":"2025-04-20T16:00:00+08:00","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/chapter6/","title":"Chapter6: ä»»åŠ¡ç®¡ç†ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°"},{"content":"å¼•è¨€ åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼ŒçŠ¶æ€ç®¡ç†æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚React ä½œä¸ºæœ€æµè¡Œçš„å‰ç«¯æ¡†æ¶ä¹‹ä¸€ï¼Œæä¾›äº† Context API ç”¨äºçŠ¶æ€å…±äº«ï¼ŒåŒæ—¶ç¤¾åŒºä¹Ÿæ¶Œç°å‡º Reduxã€Zustand ç­‰ä¼˜ç§€çš„çŠ¶æ€ç®¡ç†åº“ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ React Context ä¸çŠ¶æ€ç®¡ç†åº“çš„åŒºåˆ«ï¼Œå¸®åŠ©å¼€å‘è€…æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆã€‚\nåŸºç¡€æ¦‚å¿µ ä»€ä¹ˆæ˜¯ React Contextï¼Ÿ React Context æ˜¯ React æä¾›çš„ä¸€ç§ç»„ä»¶é—´æ•°æ®å…±äº«çš„æ–¹å¼ï¼Œä¸»è¦ç”¨äºè§£å†³\u0026quot;prop drilling\u0026quot;ï¼ˆå±æ€§é€ä¼ ï¼‰é—®é¢˜ã€‚å®ƒå…è®¸æˆ‘ä»¬åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®ï¼Œè€Œä¸å¿…æ‰‹åŠ¨åœ¨æ¯ä¸ªå±‚çº§ä¼ é€’ propsã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Contextåˆ›å»º const ThemeContext = createContext(); // Contextæä¾›è€… function ThemeProvider({ children }) { const [theme, setTheme] = useState(\u0026#34;light\u0026#34;); return ( \u0026lt;ThemeContext.Provider value={{ theme, setTheme }}\u0026gt; {children} \u0026lt;/ThemeContext.Provider\u0026gt; ); } // Contextæ¶ˆè´¹è€… function ThemedButton() { const { theme } = useContext(ThemeContext); return \u0026lt;button className={theme}\u0026gt;æŒ‰é’®\u0026lt;/button\u0026gt;; } ä»€ä¹ˆæ˜¯çŠ¶æ€ç®¡ç†åº“ï¼Ÿ çŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚ Reduxã€Zustandï¼‰æ˜¯ä¸“é—¨ç”¨äºç®¡ç†åº”ç”¨çŠ¶æ€çš„å·¥å…·ï¼Œå®ƒä»¬æä¾›äº†æ›´å¼ºå¤§çš„çŠ¶æ€ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼š\nå¯é¢„æµ‹çš„çŠ¶æ€æ›´æ–° ä¸­é—´ä»¶æ”¯æŒ å¼€å‘å·¥å…·é›†æˆ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Zustandç¤ºä¾‹ const useStore = create((set) =\u0026gt; ({ count: 0, increment: () =\u0026gt; set((state) =\u0026gt; ({ count: state.count + 1 })), decrement: () =\u0026gt; set((state) =\u0026gt; ({ count: state.count - 1 })), })); // ä½¿ç”¨ function Counter() { const { count, increment } = useStore(); return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;{count}\u0026lt;/p\u0026gt; \u0026lt;button onClick={increment}\u0026gt;å¢åŠ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); } æ ¸å¿ƒåŒºåˆ« 1. ä½¿ç”¨åœºæ™¯ åœºæ™¯ Context çŠ¶æ€ç®¡ç†åº“ ä¸»é¢˜åˆ‡æ¢ âœ… é€‚åˆ âš ï¸ è¿‡åº¦ ç”¨æˆ·è®¤è¯ âœ… é€‚åˆ âœ… é€‚åˆ å¤æ‚è¡¨å• âš ï¸ å¯èƒ½ä¸å¤Ÿ âœ… é€‚åˆ å…¨å±€ UI çŠ¶æ€ âœ… é€‚åˆ âœ… é€‚åˆ å¤æ‚ä¸šåŠ¡é€»è¾‘ âŒ ä¸é€‚åˆ âœ… é€‚åˆ å¼‚æ­¥æ•°æ®æµ âŒ ä¸é€‚åˆ âœ… é€‚åˆ 2. æ€§èƒ½è€ƒè™‘ Context åœ¨å€¼å˜åŒ–æ—¶ä¼šè§¦å‘æ‰€æœ‰è®¢é˜…ç»„ä»¶çš„é‡æ¸²æŸ“ï¼Œè€ŒçŠ¶æ€ç®¡ç†åº“é€šå¸¸æä¾›æ›´ç»†ç²’åº¦çš„æ›´æ–°æ§åˆ¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Context - æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šé‡æ¸²æŸ“ const UserContext = createContext(); function UserProvider({ children }) { const [user, setUser] = useState(null); return ( \u0026lt;UserContext.Provider value={{ user, setUser }}\u0026gt; {children} \u0026lt;/UserContext.Provider\u0026gt; ); } // Zustand - åªæœ‰ä½¿ç”¨ç‰¹å®šçŠ¶æ€çš„ç»„ä»¶ä¼šé‡æ¸²æŸ“ const useUserStore = create((set) =\u0026gt; ({ user: null, setUser: (user) =\u0026gt; set({ user }), // é€‰æ‹©å™¨ selectUserName: (state) =\u0026gt; state.user?.name, })); 3. å¼€å‘ä½“éªŒ çŠ¶æ€ç®¡ç†åº“é€šå¸¸æä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒï¼š\nRedux DevTools æ”¯æŒ æ—¶é—´æ—…è¡Œè°ƒè¯• ä¸­é—´ä»¶ç³»ç»Ÿ ç±»å‹å®‰å…¨ æœ€ä½³å®è·µ 1. ä½•æ—¶ä½¿ç”¨ Contextï¼Ÿ ä¸»é¢˜åˆ‡æ¢ ç”¨æˆ·è®¤è¯çŠ¶æ€ è¯­è¨€æœ¬åœ°åŒ– ç®€å•çš„å…¨å±€ UI çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ä¸»é¢˜Contextç¤ºä¾‹ const ThemeContext = createContext(); function ThemeProvider({ children }) { const [theme, setTheme] = useState(\u0026#34;light\u0026#34;); useEffect(() =\u0026gt; { document.body.className = theme; }, [theme]); return ( \u0026lt;ThemeContext.Provider value={{ theme, setTheme }}\u0026gt; {children} \u0026lt;/ThemeContext.Provider\u0026gt; ); } 2. ä½•æ—¶ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“ï¼Ÿ å¤æ‚çš„æ•°æ®æµ éœ€è¦ä¸­é—´ä»¶å¤„ç†çš„å¼‚æ­¥æ“ä½œ éœ€è¦æ—¶é—´æ—…è¡Œè°ƒè¯• éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // å¤æ‚çŠ¶æ€ç®¡ç†ç¤ºä¾‹ const useTaskStore = create((set) =\u0026gt; ({ tasks: [], loading: false, error: null, fetchTasks: async () =\u0026gt; { set({ loading: true }); try { const tasks = await api.getTasks(); set({ tasks, loading: false }); } catch (error) { set({ error, loading: false }); } }, })); 3. æ··åˆä½¿ç”¨ç­–ç•¥ åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šå¸¸å»ºè®®æ··åˆä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // ä½¿ç”¨Contextå¤„ç†UIçŠ¶æ€ const ThemeContext = createContext(); // ä½¿ç”¨çŠ¶æ€ç®¡ç†å¤„ç†ä¸šåŠ¡é€»è¾‘ const useTaskStore = create((set) =\u0026gt; ({ tasks: [], addTask: (task) =\u0026gt; set((state) =\u0026gt; ({ tasks: [...state.tasks, task], })), })); // ç»„ä»¶ä¸­ä½¿ç”¨ function TaskList() { const { theme } = useContext(ThemeContext); const { tasks, addTask } = useTaskStore(); return ( \u0026lt;div className={`task-list ${theme}`}\u0026gt; {tasks.map((task) =\u0026gt; ( \u0026lt;TaskItem key={task.id} task={task} /\u0026gt; ))} \u0026lt;/div\u0026gt; ); } å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ 1. Context å¯¼è‡´ä¸å¿…è¦çš„é‡æ¸²æŸ“ é—®é¢˜ï¼šå½“ Context å€¼å˜åŒ–æ—¶ï¼Œæ‰€æœ‰è®¢é˜…ç»„ä»¶éƒ½ä¼šé‡æ¸²æŸ“ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\nå°† Context æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„ Context ä½¿ç”¨ memo ä¼˜åŒ–ç»„ä»¶ è€ƒè™‘ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“ 2. çŠ¶æ€ç®¡ç†åº“å­¦ä¹ æ›²çº¿é™¡å³­ é—®é¢˜ï¼šRedux ç­‰åº“çš„å­¦ä¹ æ›²çº¿è¾ƒé™¡ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\nä»ç®€å•çš„çŠ¶æ€ç®¡ç†åº“å¼€å§‹ï¼ˆå¦‚ Zustandï¼‰ é€æ­¥å¼•å…¥æ›´å¤æ‚çš„åŠŸèƒ½ ä½¿ç”¨ TypeScript æé«˜ç±»å‹å®‰å…¨ 3. çŠ¶æ€åŒæ­¥é—®é¢˜ é—®é¢˜ï¼šå¤šä¸ªç»„ä»¶éœ€è¦åŒæ­¥æ›´æ–°çŠ¶æ€ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\nä½¿ç”¨å•ä¸€æ•°æ®æº å®ç°çŠ¶æ€è®¢é˜…æœºåˆ¶ ä½¿ç”¨ä¸­é—´ä»¶å¤„ç†å‰¯ä½œç”¨ æ€»ç»“ Context é€‚åˆç®€å•çš„å…¨å±€çŠ¶æ€å…±äº«ï¼Œä½¿ç”¨ç®€å•ä½†æ€§èƒ½å¯èƒ½ä¸æ˜¯æœ€ä¼˜ çŠ¶æ€ç®¡ç†åº“é€‚åˆå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œæ€§èƒ½ä¼˜åŒ– åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šå¸¸éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆ Context å’ŒçŠ¶æ€ç®¡ç†åº“å¯ä»¥é…åˆä½¿ç”¨ï¼Œå„å¸å…¶èŒ äº’åŠ¨è®¨è®º ä½ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿‡å“ªäº›çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Ÿ é‡åˆ°è¿‡å“ªäº›çŠ¶æ€ç®¡ç†çš„æŒ‘æˆ˜ï¼Ÿ å¯¹äºæ–°é¡¹ç›®ï¼Œä½ ä¼šå¦‚ä½•é€‰æ‹©çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Ÿ æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒå’Œæƒ³æ³•ï¼\n","date":"2025-04-20T11:00:00+08:00","permalink":"https://blog.cycbloom.com/p/state-management-context/","title":"ReactçŠ¶æ€ç®¡ç†æ·±åº¦è§£æï¼šContextä¸çŠ¶æ€ç®¡ç†åº“çš„å¯¹æ¯”ä¸å®è·µ"},{"content":" Chapter5: è®¤è¯ç³»ç»Ÿè®¾è®¡ä¸å®ç° â€”â€”ä»åç«¯åˆ°å‰ç«¯çš„å®Œæ•´è®¤è¯æµç¨‹\nä¸€ã€åç«¯è®¤è¯ç³»ç»Ÿè®¾è®¡ TactiCore çš„è®¤è¯ç³»ç»Ÿé‡‡ç”¨ JWT (JSON Web Token) å®ç°æ— çŠ¶æ€è®¤è¯ï¼Œç»“åˆ Prisma ORM è¿›è¡Œç”¨æˆ·æ•°æ®ç®¡ç†ã€‚\n1. ç”¨æˆ·æ•°æ®æ¨¡å‹è®¾è®¡ é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ Prisma schema ä¸­å®šä¹‰ç”¨æˆ·æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 model User { id String @id @default(uuid()) email String @unique username String @unique password String createdAt DateTime @default(now()) updatedAt DateTime @updatedAt } æ¨¡å‹ç‰¹ç‚¹ï¼š\nUUID ä¸»é”®ï¼šä½¿ç”¨ UUID ä½œä¸ºä¸»é”®ï¼Œæé«˜å®‰å…¨æ€§å’Œåˆ†å¸ƒå¼å…¼å®¹æ€§ å”¯ä¸€çº¦æŸï¼šé‚®ç®±å’Œç”¨æˆ·åè®¾ç½®å”¯ä¸€çº¦æŸï¼Œç¡®ä¿æ•°æ®å”¯ä¸€æ€§ æ—¶é—´æˆ³ï¼šè‡ªåŠ¨è®°å½•åˆ›å»ºå’Œæ›´æ–°æ—¶é—´ 2. æ•°æ®åº“åˆå§‹åŒ– é€šè¿‡ seed.ts å®ç°æ•°æ®åº“åˆå§‹åŒ–ï¼Œåˆ›å»ºé»˜è®¤ç”¨æˆ·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 async function main() { // åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜ç”¨æˆ· const adminPassword = await bcryptjs.hash(\u0026#34;admin123\u0026#34;, 10); await prisma.user.upsert({ where: { email: \u0026#34;admin@example.com\u0026#34; }, update: {}, create: { email: \u0026#34;admin@example.com\u0026#34;, username: \u0026#34;admin\u0026#34;, password: adminPassword, }, }); // åˆ›å»ºæµ‹è¯•ç”¨æˆ· const testPassword = await bcryptjs.hash(\u0026#34;test123\u0026#34;, 10); await prisma.user.upsert({ where: { email: \u0026#34;test@example.com\u0026#34; }, update: {}, create: { email: \u0026#34;test@example.com\u0026#34;, username: \u0026#34;test\u0026#34;, password: testPassword, }, }); } åˆå§‹åŒ–ç‰¹ç‚¹ï¼š\nå¯†ç åŠ å¯†ï¼šä½¿ç”¨ bcryptjs è¿›è¡Œå¯†ç åŠ å¯† upsert æ“ä½œï¼šä½¿ç”¨ upsert ç¡®ä¿æ•°æ®å¹‚ç­‰æ€§ é»˜è®¤ç”¨æˆ·ï¼šåˆ›å»ºç®¡ç†å‘˜å’Œæµ‹è¯•ç”¨æˆ· 3. ç”¨æˆ·æœåŠ¡å®ç° ç”¨æˆ·æœåŠ¡è´Ÿè´£å¤„ç†ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Injectable() export class UsersService { constructor(private prisma: PrismaService) {} async create(createUserDto: CreateUserDto) { const hashedPassword = await bcrypt.hash(createUserDto.password, 10); return this.prisma.user.create({ data: { ...createUserDto, password: hashedPassword, }, }); } async findOne(id: string) { return this.prisma.user.findUnique({ where: { id }, }); } async findByEmail(email: string) { return this.prisma.user.findUnique({ where: { email }, }); } } æœåŠ¡ç‰¹ç‚¹ï¼š\nä¾èµ–æ³¨å…¥ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ PrismaService å¯†ç åŠ å¯†ï¼šä½¿ç”¨ bcrypt è¿›è¡Œå¯†ç åŠ å¯† æŸ¥è¯¢æ–¹æ³•ï¼šæä¾›å¤šç§æŸ¥è¯¢æ–¹å¼ 4. è®¤è¯æœåŠ¡è®¾è®¡ è®¤è¯æœåŠ¡å¤„ç†ç™»å½•å’Œä»¤ç‰Œç”Ÿæˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Injectable() export class AuthService { constructor( private usersService: UsersService, private jwtService: JwtService ) {} async validateUser(email: string, password: string) { const user = await this.usersService.findByEmail(email); if (user \u0026amp;\u0026amp; (await bcrypt.compare(password, user.password))) { const { password, ...result } = user; return result; } return null; } async login(user: any) { const payload = { email: user.email, sub: user.id }; return { access_token: this.jwtService.sign(payload), }; } } è®¤è¯ç‰¹ç‚¹ï¼š\nå¯†ç éªŒè¯ï¼šä½¿ç”¨ bcrypt è¿›è¡Œå¯†ç æ¯”å¯¹ JWT ç”Ÿæˆï¼šä½¿ç”¨ JwtService ç”Ÿæˆè®¿é—®ä»¤ç‰Œ æ•°æ®è„±æ•ï¼šè¿”å›ç”¨æˆ·ä¿¡æ¯æ—¶ç§»é™¤å¯†ç å­—æ®µ 5. CurrentUser è£…é¥°å™¨ è‡ªå®šä¹‰è£…é¥°å™¨ç”¨äºè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼š\n1 2 3 4 5 6 export const CurrentUser = createParamDecorator( (data: unknown, ctx: ExecutionContext) =\u0026gt; { const request = ctx.switchToHttp().getRequest(); return request.user; } ); è£…é¥°å™¨ç‰¹ç‚¹ï¼š\nå‚æ•°è£…é¥°å™¨ï¼šä½¿ç”¨ createParamDecorator åˆ›å»º ä¸Šä¸‹æ–‡è®¿é—®ï¼šé€šè¿‡ ExecutionContext è®¿é—®è¯·æ±‚ä¸Šä¸‹æ–‡ ç”¨æˆ·ä¿¡æ¯æå–ï¼šä»è¯·æ±‚å¯¹è±¡ä¸­æå–ç”¨æˆ·ä¿¡æ¯ 6. CORS é…ç½® åœ¨ main.ts ä¸­é…ç½®è·¨åŸŸèµ„æºå…±äº«ï¼š\n1 2 3 4 5 app.enableCors({ origin: [\u0026#34;http://localhost:5173\u0026#34;], methods: \u0026#34;GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS\u0026#34;, credentials: true, }); CORS ç‰¹ç‚¹ï¼š\næºé™åˆ¶ï¼šåªå…è®¸ç‰¹å®šå‰ç«¯åŸŸåè®¿é—® æ–¹æ³•æ”¯æŒï¼šæ”¯æŒå¸¸ç”¨ HTTP æ–¹æ³• å‡­è¯æ”¯æŒï¼šå…è®¸æºå¸¦è®¤è¯ä¿¡æ¯ äºŒã€å‰ç«¯è®¤è¯ç³»ç»Ÿå®ç° å‰ç«¯è®¤è¯ç³»ç»Ÿé‡‡ç”¨ React Context å’Œè‡ªå®šä¹‰ Hook å®ç°çŠ¶æ€ç®¡ç†ã€‚\n1. API è®¾è®¡ åœ¨ api ç›®å½•ä¸‹å®šä¹‰è®¤è¯ç›¸å…³çš„ API è¯·æ±‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // auth.ts export const authApi = { login: (data: LoginData) =\u0026gt; request.post(\u0026#34;/auth/login\u0026#34;, data), getCurrentUser: () =\u0026gt; request.get(\u0026#34;/auth/me\u0026#34;), }; // request.ts const request = axios.create({ baseURL: import.meta.env.VITE_API_URL, timeout: 10000, }); // è¯·æ±‚æ‹¦æˆªå™¨ request.interceptors.request.use((config) =\u0026gt; { const token = localStorage.getItem(\u0026#34;token\u0026#34;); if (token) { config.headers.Authorization = `Bearer ${token}`; } return config; }); // å“åº”æ‹¦æˆªå™¨ request.interceptors.response.use( (response) =\u0026gt; response.data, (error) =\u0026gt; { if (error.response?.status === 401) { localStorage.removeItem(\u0026#34;token\u0026#34;); window.location.href = \u0026#34;/login\u0026#34;; } return Promise.reject(error); } ); API ç‰¹ç‚¹ï¼š\nè¯·æ±‚å°è£…ï¼šç»Ÿä¸€å¤„ç†è¯·æ±‚å’Œå“åº” ä»¤ç‰Œç®¡ç†ï¼šè‡ªåŠ¨æ·»åŠ è®¤è¯ä»¤ç‰Œ é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€å¤„ç†è®¤è¯é”™è¯¯ 2. è®¤è¯ä¸Šä¸‹æ–‡ ä½¿ç”¨ Context ç®¡ç†è®¤è¯çŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 export const AuthProvider: React.FC\u0026lt;{ children: React.ReactNode }\u0026gt; = ({ children, }) =\u0026gt; { const [user, setUser] = useState\u0026lt;UserData | null\u0026gt;(null); const [token, setToken] = useState\u0026lt;string | null\u0026gt;(null); const [isLoading, setIsLoading] = useState(true); useEffect(() =\u0026gt; { const storedToken = localStorage.getItem(\u0026#34;token\u0026#34;); if (storedToken) { setToken(storedToken); authApi .getCurrentUser() .then((response) =\u0026gt; setUser(response)) .catch(() =\u0026gt; { localStorage.removeItem(\u0026#34;token\u0026#34;); setToken(null); }) .finally(() =\u0026gt; setIsLoading(false)); } else { setIsLoading(false); } }, []); const login = async (data: LoginData) =\u0026gt; { const response = await authApi.login(data); const { access_token } = response; localStorage.setItem(\u0026#34;token\u0026#34;, access_token); setToken(access_token); const userData = await authApi.getCurrentUser(); setUser(userData); }; const logout = () =\u0026gt; { localStorage.removeItem(\u0026#34;token\u0026#34;); setToken(null); setUser(null); }; return ( \u0026lt;AuthContext.Provider value={{ user, token, login, logout, isLoading }}\u0026gt; {children} \u0026lt;/AuthContext.Provider\u0026gt; ); }; ä¸Šä¸‹æ–‡ç‰¹ç‚¹ï¼š\nçŠ¶æ€ç®¡ç†ï¼šç®¡ç†ç”¨æˆ·ä¿¡æ¯å’Œä»¤ç‰ŒçŠ¶æ€ è‡ªåŠ¨ç™»å½•ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤ç™»å½•çŠ¶æ€ æ–¹æ³•å°è£…ï¼šæä¾›ç™»å½•å’Œç™»å‡ºæ–¹æ³• 3. ç™»å½•ç»„ä»¶å®ç° ä½¿ç”¨ Material-UI å®ç°ç™»å½•è¡¨å•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 export default function LoginForm({ onSuccess }: LoginFormProps) { const navigate = useNavigate(); const { login } = useAuth(); const [error, setError] = useState(\u0026#34;\u0026#34;); const [loading, setLoading] = useState(false); const handleSubmit = async (data: LoginFormData) =\u0026gt; { setError(\u0026#34;\u0026#34;); setLoading(true); try { await login(data); onSuccess?.(); navigate(\u0026#34;/dashboard\u0026#34;); } catch (err: any) { setError(err.response?.data?.message || \u0026#34;ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•\u0026#34;); } finally { setLoading(false); } }; return ( \u0026lt;Container component=\u0026#34;main\u0026#34; maxWidth=\u0026#34;xs\u0026#34;\u0026gt; \u0026lt;Paper elevation={3} sx={{ marginTop: 8, padding: 4 }}\u0026gt; \u0026lt;BaseForm\u0026lt;LoginFormData\u0026gt; onSubmit={handleSubmit} defaultValues={{ username: \u0026#34;\u0026#34;, password: \u0026#34;\u0026#34; }} formTitle=\u0026#34;ç™»å½•åˆ° TactiCore\u0026#34; schema={loginSchema} submitButtonText={loading ? \u0026#34;ç™»å½•ä¸­...\u0026#34; : \u0026#34;ç™»å½•\u0026#34;} \u0026gt; {/* è¡¨å•å­—æ®µ */} \u0026lt;/BaseForm\u0026gt; \u0026lt;/Paper\u0026gt; \u0026lt;/Container\u0026gt; ); } ç»„ä»¶ç‰¹ç‚¹ï¼š\nè¡¨å•éªŒè¯ï¼šä½¿ç”¨ Zod è¿›è¡Œè¡¨å•éªŒè¯ çŠ¶æ€ç®¡ç†ï¼šå¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€ å¯¼èˆªæ§åˆ¶ï¼šç™»å½•æˆåŠŸåè‡ªåŠ¨å¯¼èˆª UI ç»„ä»¶ï¼šä½¿ç”¨ Material-UI å®ç°ç¾è§‚ç•Œé¢ ä¸‰ã€æ€»ç»“ä¸å±•æœ› TactiCore çš„è®¤è¯ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯æµç¨‹ï¼Œä»åç«¯çš„ç”¨æˆ·ç®¡ç†åˆ°å‰ç«¯çš„çŠ¶æ€ç®¡ç†ï¼Œéƒ½é‡‡ç”¨äº†ç°ä»£åŒ–çš„æŠ€æœ¯æ–¹æ¡ˆã€‚\næŠ€æœ¯äº®ç‚¹ï¼š\nJWT è®¤è¯ï¼šå®ç°æ— çŠ¶æ€è®¤è¯ å¯†ç åŠ å¯†ï¼šä½¿ç”¨ bcrypt ä¿æŠ¤ç”¨æˆ·å¯†ç  ä¸Šä¸‹æ–‡ç®¡ç†ï¼šä½¿ç”¨ React Context ç®¡ç†è®¤è¯çŠ¶æ€ è¡¨å•éªŒè¯ï¼šä½¿ç”¨ Zod å®ç°ç±»å‹å®‰å…¨çš„è¡¨å•éªŒè¯ UI ç»„ä»¶ï¼šä½¿ç”¨ Material-UI å®ç°ç¾è§‚çš„ç•Œé¢ é€šè¿‡è¿™ä¸€ç³»åˆ—æ¨¡å—çš„ç²¾å¿ƒè®¾è®¡å’Œå®ç°ï¼ŒTactiCore çš„è®¤è¯ç³»ç»Ÿä¸ºç”¨æˆ·æä¾›äº†å®‰å…¨ã€ä¾¿æ·çš„è®¤è¯ä½“éªŒï¼Œä¸ºç³»ç»Ÿçš„å…¶ä»–åŠŸèƒ½æ¨¡å—å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚\n","date":"2025-04-19T16:00:00+08:00","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/chapter5/","title":"Chapter5: è®¤è¯ç³»ç»Ÿè®¾è®¡ä¸å®ç°"},{"content":" Chapter4: åç«¯æ¶æ„ä¸å®ç° â€”â€”ä»è®¤è¯åˆ°ä»»åŠ¡ç®¡ç†çš„å…¨æ ˆè§£æ\nä¸€ã€é¡¹ç›®æ¶æ„æ¦‚è§ˆ TactiCore åç«¯é‡‡ç”¨ NestJS æ¡†æ¶æ„å»ºï¼Œéµå¾ªæ¨¡å—åŒ–è®¾è®¡åŸåˆ™ï¼Œå„åŠŸèƒ½æ¨¡å—é«˜åº¦è§£è€¦ã€‚æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 backend/ â”œâ”€â”€ src/ â”‚ â”œâ”€â”€ core/ # æ ¸å¿ƒæ¨¡å— â”‚ â”‚ â”œâ”€â”€ auth/ # è®¤è¯æ¨¡å— â”‚ â”‚ â””â”€â”€ config/ # é…ç½®æ¨¡å— â”‚ â”œâ”€â”€ database/ # æ•°æ®åº“æ¨¡å— â”‚ â”‚ â”œâ”€â”€ schemas/ # æ•°æ®æ¨¡å‹å®šä¹‰ â”‚ â”‚ â””â”€â”€ prisma/ # Prisma æœåŠ¡ â”‚ â”œâ”€â”€ task/ # ä»»åŠ¡ç®¡ç†æ¨¡å— â”‚ â””â”€â”€ main.ts # åº”ç”¨å…¥å£ â”œâ”€â”€ prisma/ # Prisma é…ç½® â”‚ â”œâ”€â”€ schema.prisma # æ•°æ®åº“æ¨¡å‹å®šä¹‰ â”‚ â””â”€â”€ migrations/ # æ•°æ®åº“è¿ç§»æ–‡ä»¶ â””â”€â”€ scripts/ # è¾…åŠ©è„šæœ¬ â””â”€â”€ init-db.sh # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ æ¶æ„ç‰¹ç‚¹ï¼š\næ¨¡å—åŒ–è®¾è®¡ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹å°è£…ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥å®ç°æ¾è€¦åˆ åˆ†å±‚æ¶æ„ï¼šæ§åˆ¶å™¨å±‚å¤„ç†è¯·æ±‚ï¼ŒæœåŠ¡å±‚å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæ•°æ®è®¿é—®å±‚ä¸æ•°æ®åº“äº¤äº’ ç±»å‹å®‰å…¨ï¼šå…¨é¢ä½¿ç”¨ TypeScript ç±»å‹ç³»ç»Ÿï¼Œç¡®ä¿ä»£ç å¥å£®æ€§ å®¹å™¨åŒ–éƒ¨ç½²ï¼šåŸºäº Docker å’Œ Docker Compose å®ç°ç¯å¢ƒä¸€è‡´æ€§ äºŒã€è®¤è¯æ¨¡å—å®ç° è®¤è¯æ¨¡å—æ˜¯ç³»ç»Ÿçš„å®‰å…¨åŸºçŸ³ï¼Œæˆ‘ä»¬é‡‡ç”¨ JWT (JSON Web Token) å®ç°æ— çŠ¶æ€è®¤è¯ã€‚\n1. JWT ç­–ç•¥è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // JwtStrategy å®ç° @Injectable() export class JwtStrategy extends PassportStrategy(Strategy) { constructor(private configService: ConfigService) { super({ jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(), ignoreExpiration: false, secretOrKey: configService.getOrThrow\u0026lt;string\u0026gt;(\u0026#34;JWT_SECRET\u0026#34;), }); } async validate(payload: any) { return { userId: payload.sub, username: payload.username }; } } å…³é”®æŠ€æœ¯ç‚¹ï¼š\nç­–ç•¥æ¨¡å¼ï¼šé€šè¿‡ç»§æ‰¿ PassportStrategy å®ç°è‡ªå®šä¹‰è®¤è¯ç­–ç•¥ é…ç½®æ³¨å…¥ï¼šä½¿ç”¨ ConfigService è·å–ç¯å¢ƒå˜é‡ä¸­çš„å¯†é’¥ ä»¤ç‰Œæå–ï¼šä»è¯·æ±‚å¤´ä¸­æå– Bearer ä»¤ç‰Œ è´Ÿè½½éªŒè¯ï¼šéªŒè¯ JWT ä»¤ç‰Œçš„æœ‰æ•ˆæ€§å¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯ 2. è®¤è¯æ¨¡å—é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Module({ imports: [ PassportModule, ConfigModule, JwtModule.registerAsync({ imports: [ConfigModule], useFactory: async (configService: ConfigService) =\u0026gt; ({ secret: configService.getOrThrow\u0026lt;string\u0026gt;(\u0026#34;JWT_SECRET\u0026#34;), signOptions: { expiresIn: \u0026#34;1d\u0026#34; }, }), inject: [ConfigService], }), ], providers: [JwtStrategy], exports: [JwtModule], }) export class AuthModule {} æ¨¡å—è®¾è®¡ï¼š\nå¼‚æ­¥é…ç½®ï¼šä½¿ç”¨ registerAsync å®ç° JWT æ¨¡å—çš„å¼‚æ­¥é…ç½® ä¾èµ–æ³¨å…¥ï¼šé€šè¿‡ inject æ³¨å…¥ ConfigService ä¾èµ– æ¨¡å—å¯¼å‡ºï¼šå¯¼å‡º JwtModule ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ 3. è®¤è¯å®ˆå« 1 2 3 4 5 6 @Injectable() export class JwtAuthGuard extends AuthGuard(\u0026#34;jwt\u0026#34;) { canActivate(context: ExecutionContext) { return super.canActivate(context); } } ä½¿ç”¨æ–¹å¼ï¼š\n1 2 3 4 5 @Controller(\u0026#34;tasks\u0026#34;) @UseGuards(JwtAuthGuard) export class TaskController { // æ§åˆ¶å™¨æ–¹æ³•... } è®¾è®¡ä¼˜åŠ¿ï¼š\nå…¨å±€ä¿æŠ¤ï¼šé€šè¿‡è£…é¥°å™¨è½»æ¾ä¸ºæ•´ä¸ªæ§åˆ¶å™¨æ·»åŠ è®¤è¯ä¿æŠ¤ çµæ´»é…ç½®ï¼šæ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æ‰©å±• å¼‚å¸¸å¤„ç†ï¼šè‡ªåŠ¨å¤„ç†è®¤è¯å¤±è´¥æƒ…å†µ ä¸‰ã€é…ç½®æ¨¡å—è®¾è®¡ é…ç½®æ¨¡å—è´Ÿè´£ç®¡ç†ç³»ç»Ÿé…ç½®ï¼Œæ”¯æŒç¯å¢ƒå˜é‡å’Œé…ç½®éªŒè¯ã€‚\n1. é…ç½®æ¨¡å¼å®šä¹‰ 1 2 3 4 5 6 7 8 9 10 // é…ç½®æ¨¡å¼å®šä¹‰ export const configValidationSchema = Joi.object({ NODE_ENV: Joi.string() .valid(\u0026#34;development\u0026#34;, \u0026#34;production\u0026#34;, \u0026#34;test\u0026#34;) .default(\u0026#34;development\u0026#34;), PORT: Joi.number().default(3000), JWT_SECRET: Joi.string().required(), POSTGRES_URL: Joi.string().required(), MONGODB_URL: Joi.string().required(), }); éªŒè¯æœºåˆ¶ï¼š\nç±»å‹å®‰å…¨ï¼šä½¿ç”¨ Joi è¿›è¡Œè¿è¡Œæ—¶ç±»å‹éªŒè¯ é»˜è®¤å€¼ï¼šä¸ºå¯é€‰é…ç½®æä¾›åˆç†çš„é»˜è®¤å€¼ å¿…å¡«é¡¹ï¼šæ ‡è®°å…³é”®é…ç½®ä¸ºå¿…å¡«é¡¹ 2. é…ç½®æœåŠ¡å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Injectable() export class ConfigService { private readonly config: Record\u0026lt;string, any\u0026gt;; constructor() { this.config = this.validateConfig(process.env); } get\u0026lt;T\u0026gt;(key: string): T { return this.config[key] as T; } getOrThrow\u0026lt;T\u0026gt;(key: string): T { const value = this.get\u0026lt;T\u0026gt;(key); if (value === undefined) { throw new Error(`é…ç½®é¡¹ ${key} æœªå®šä¹‰`); } return value; } private validateConfig(config: Record\u0026lt;string, any\u0026gt;): Record\u0026lt;string, any\u0026gt; { const { error, value } = configValidationSchema.validate(config, { abortEarly: false, allowUnknown: true, }); if (error) { throw new Error(`é…ç½®éªŒè¯å¤±è´¥: ${error.message}`); } return value; } } æœåŠ¡ç‰¹ç‚¹ï¼š\nç±»å‹å®‰å…¨ï¼šæ”¯æŒæ³›å‹è·å–é…ç½®å€¼ é”™è¯¯å¤„ç†ï¼šæä¾› getOrThrow æ–¹æ³•ç¡®ä¿å…³é”®é…ç½®å­˜åœ¨ éªŒè¯é€»è¾‘ï¼šåœ¨åˆå§‹åŒ–æ—¶éªŒè¯æ‰€æœ‰é…ç½®é¡¹ 3. é…ç½®æ¨¡å—æ³¨å†Œ 1 2 3 4 5 @Module({ providers: [ConfigService], exports: [ConfigService], }) export class ConfigModule {} æ¨¡å—è®¾è®¡ï¼š\nå•ä¾‹æ¨¡å¼ï¼šé…ç½®æœåŠ¡ä½œä¸ºå•ä¾‹åœ¨æ•´ä¸ªåº”ç”¨ä¸­å…±äº« ä¾èµ–å¯¼å‡ºï¼šå¯¼å‡ºé…ç½®æœåŠ¡ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ å››ã€æ•°æ®åº“æ¨¡å—å®ç° æ•°æ®åº“æ¨¡å—é‡‡ç”¨ Prisma ORM å®ç°ï¼Œæ”¯æŒ PostgreSQL å’Œ MongoDB åŒæ•°æ®åº“ã€‚\n1. Prisma æœåŠ¡è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Injectable() export class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy { constructor() { super({ log: [\u0026#34;query\u0026#34;, \u0026#34;info\u0026#34;, \u0026#34;warn\u0026#34;, \u0026#34;error\u0026#34;], }); } async onModuleInit() { await this.$connect(); try { await this.$executeRaw`SELECT 1`; console.log(\u0026#34;æ•°æ®åº“è¿æ¥æˆåŠŸ\u0026#34;); } catch (error) { console.error(\u0026#34;æ•°æ®åº“è¿æ¥å¤±è´¥:\u0026#34;, error); throw error; } } async onModuleDestroy() { await this.$disconnect(); } } æœåŠ¡ç‰¹ç‚¹ï¼š\nç”Ÿå‘½å‘¨æœŸé’©å­ï¼šå®ç° OnModuleInit å’Œ OnModuleDestroy æ¥å£ è¿æ¥ç®¡ç†ï¼šåœ¨æ¨¡å—åˆå§‹åŒ–æ—¶è¿æ¥æ•°æ®åº“ï¼Œé”€æ¯æ—¶æ–­å¼€è¿æ¥ å¥åº·æ£€æŸ¥ï¼šé€šè¿‡æ‰§è¡Œç®€å•æŸ¥è¯¢éªŒè¯æ•°æ®åº“è¿æ¥çŠ¶æ€ 2. æ•°æ®åº“æ¨¡å‹å®šä¹‰ 1 2 3 4 5 6 7 8 9 10 11 12 // Prisma schema å®šä¹‰ model Task { id String @id @default(uuid()) title String description String? status String @default(\u0026#34;todo\u0026#34;) priority String @default(\u0026#34;medium\u0026#34;) dueDate DateTime? tags String[] createdAt DateTime @default(now()) updatedAt DateTime @updatedAt } æ¨¡å‹è®¾è®¡ï¼š\nUUID ä¸»é”®ï¼šä½¿ç”¨ UUID ä½œä¸ºä¸»é”®ï¼Œæé«˜å®‰å…¨æ€§å’Œåˆ†å¸ƒå¼å…¼å®¹æ€§ é»˜è®¤å€¼ï¼šä¸ºå¸¸ç”¨å­—æ®µæä¾›åˆç†çš„é»˜è®¤å€¼ æ—¶é—´æˆ³ï¼šè‡ªåŠ¨è®°å½•åˆ›å»ºå’Œæ›´æ–°æ—¶é—´ 3. æ•°æ®åº“è¿ç§»ç®¡ç† æ•°æ®åº“è¿ç§»æ˜¯ç¡®ä¿æ•°æ®åº“ç»“æ„ä¸ä»£ç åŒæ­¥çš„å…³é”®ç¯èŠ‚ã€‚åœ¨ TactiCore ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°è¿ç§»ï¼š\nåˆ›å»ºè¿ç§»æ–‡ä»¶ï¼šåœ¨ docker å®¹å™¨æ§åˆ¶å°\n1 npx prisma migrate dev --name init è¿™ä¸ªå‘½ä»¤ä¼šï¼š\næ£€æµ‹æ¨¡å‹å˜åŒ– ç”Ÿæˆè¿ç§» SQL æ–‡ä»¶ åº”ç”¨è¿ç§»åˆ°æ•°æ®åº“ é‡æ–°ç”Ÿæˆ Prisma å®¢æˆ·ç«¯ è¿ç§»æ–‡ä»¶ç»“æ„ï¼š\n1 2 3 4 prisma/migrations/ â”œâ”€â”€ 20250415053129_init/ â”‚ â””â”€â”€ migration.sql â””â”€â”€ migration_lock.toml è¿ç§»æ–‡ä»¶å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 -- CreateTable CREATE TABLE \u0026#34;Task\u0026#34; ( \u0026#34;id\u0026#34; TEXT NOT NULL, \u0026#34;title\u0026#34; TEXT NOT NULL, \u0026#34;description\u0026#34; TEXT, \u0026#34;status\u0026#34; TEXT NOT NULL DEFAULT \u0026#39;todo\u0026#39;, \u0026#34;priority\u0026#34; TEXT NOT NULL DEFAULT \u0026#39;medium\u0026#39;, \u0026#34;dueDate\u0026#34; TIMESTAMP(3), \u0026#34;tags\u0026#34; TEXT[], \u0026#34;createdAt\u0026#34; TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP, \u0026#34;updatedAt\u0026#34; TIMESTAMP(3) NOT NULL, CONSTRAINT \u0026#34;Task_pkey\u0026#34; PRIMARY KEY (\u0026#34;id\u0026#34;) ); è‡ªåŠ¨åŒ–è¿ç§»ï¼š åœ¨ Docker ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆå§‹åŒ–è„šæœ¬è‡ªåŠ¨åº”ç”¨è¿ç§»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/sh # ç­‰å¾…æ•°æ®åº“å‡†å¤‡å°±ç»ª echo \u0026#34;ç­‰å¾…æ•°æ®åº“å‡†å¤‡å°±ç»ª...\u0026#34; sleep 5 # è¿è¡Œ Prisma è¿ç§» echo \u0026#34;è¿è¡Œæ•°æ®åº“è¿ç§»...\u0026#34; npx prisma migrate deploy # ç”Ÿæˆ Prisma å®¢æˆ·ç«¯ echo \u0026#34;ç”Ÿæˆ Prisma å®¢æˆ·ç«¯...\u0026#34; npx prisma generate echo \u0026#34;æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ\u0026#34; è¿ç§»ç­–ç•¥ï¼š\nå¼€å‘ç¯å¢ƒï¼šä½¿ç”¨ migrate dev å‘½ä»¤ï¼Œè‡ªåŠ¨åº”ç”¨è¿ç§»å¹¶æ›´æ–°å®¢æˆ·ç«¯ ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ migrate deploy å‘½ä»¤ï¼Œä»…åº”ç”¨å·²æœ‰è¿ç§»ï¼Œä¸ä¿®æ”¹æ•°æ®åº“ç»“æ„ ç‰ˆæœ¬æ§åˆ¶ï¼šè¿ç§»æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿å›¢é˜Ÿé—´æ•°æ®åº“ç»“æ„ä¸€è‡´ äº”ã€ä»»åŠ¡ç®¡ç†æ¨¡å—å®ç° ä»»åŠ¡ç®¡ç†æ¨¡å—æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼Œå®ç°äº†ä»»åŠ¡çš„ CRUD æ“ä½œã€‚\n1. æ•°æ®æ¨¡å‹å®šä¹‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // ä»»åŠ¡çŠ¶æ€æšä¸¾ export enum TaskStatus { TODO = \u0026#34;todo\u0026#34;, IN_PROGRESS = \u0026#34;inProgress\u0026#34;, COMPLETED = \u0026#34;completed\u0026#34;, } // ä»»åŠ¡ä¼˜å…ˆçº§æšä¸¾ export enum TaskPriority { LOW = \u0026#34;low\u0026#34;, MEDIUM = \u0026#34;medium\u0026#34;, HIGH = \u0026#34;high\u0026#34;, } // åˆ›å»ºä»»åŠ¡ DTO export class CreateTaskDto { @ApiProperty({ description: \u0026#34;ä»»åŠ¡æ ‡é¢˜\u0026#34; }) @IsString() title: string; @ApiProperty({ description: \u0026#34;ä»»åŠ¡æè¿°\u0026#34;, required: false, nullable: true }) @IsString() @IsOptional() description: string | null; @ApiProperty({ description: \u0026#34;ä»»åŠ¡çŠ¶æ€\u0026#34;, enum: TaskStatus, default: TaskStatus.TODO, }) @IsEnum(TaskStatus) @IsOptional() status?: TaskStatus; // å…¶ä»–å­—æ®µ... } // æ›´æ–°ä»»åŠ¡ DTO export class UpdateTaskDto extends CreateTaskDto { // ç»§æ‰¿è‡ª CreateTaskDtoï¼Œä¸éœ€è¦é¢å¤–å­—æ®µ } // ä»»åŠ¡å“åº” DTO export class TaskResponseDto extends CreateTaskDto { @ApiProperty({ description: \u0026#34;ä»»åŠ¡ID\u0026#34; }) @IsUUID() id: string; @ApiProperty({ description: \u0026#34;åˆ›å»ºæ—¶é—´\u0026#34; }) @IsDate() createdAt: Date; @ApiProperty({ description: \u0026#34;æ›´æ–°æ—¶é—´\u0026#34; }) @IsDate() updatedAt: Date; } DTO è®¾è®¡ï¼š\nç»§æ‰¿å…³ç³»ï¼šUpdateTaskDto ç»§æ‰¿è‡ª CreateTaskDtoï¼Œé¿å…ä»£ç é‡å¤ éªŒè¯è£…é¥°å™¨ï¼šä½¿ç”¨ class-validator è£…é¥°å™¨è¿›è¡Œè¾“å…¥éªŒè¯ API æ–‡æ¡£ï¼šä½¿ç”¨ @ApiProperty è£…é¥°å™¨ç”Ÿæˆ Swagger æ–‡æ¡£ ç±»å‹å®‰å…¨ï¼šä½¿ç”¨ TypeScript ç±»å‹ç³»ç»Ÿç¡®ä¿ç±»å‹å®‰å…¨ 2. ä»»åŠ¡æœåŠ¡å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 @Injectable() export class TaskService { constructor(private readonly prisma: PrismaService) {} // ç±»å‹è½¬æ¢å‡½æ•° private convertToTaskResponseDto(task: any): TaskResponseDto { return { ...task, status: task.status as TaskStatus, priority: task.priority as TaskPriority, }; } // åˆ›å»ºä»»åŠ¡ async createTask(createTaskDto: CreateTaskDto): Promise\u0026lt;TaskResponseDto\u0026gt; { const task = await this.prisma.task.create({ data: { ...createTaskDto, status: createTaskDto.status || TaskStatus.TODO, priority: createTaskDto.priority || TaskPriority.MEDIUM, }, }); return this.convertToTaskResponseDto(task); } // è·å–ä»»åŠ¡åˆ—è¡¨ async getTasks(filter: TaskFilterDto): Promise\u0026lt;TaskResponseDto[]\u0026gt; { const where = { ...(filter.status \u0026amp;\u0026amp; { status: filter.status }), ...(filter.priority \u0026amp;\u0026amp; { priority: filter.priority }), ...(filter.tags \u0026amp;\u0026amp; { tags: { hasSome: filter.tags } }), ...(filter.startDate \u0026amp;\u0026amp; { dueDate: { gte: filter.startDate } }), ...(filter.endDate \u0026amp;\u0026amp; { dueDate: { lte: filter.endDate } }), }; const tasks = await this.prisma.task.findMany({ where, orderBy: { createdAt: \u0026#34;desc\u0026#34;, }, }); return tasks.map((task) =\u0026gt; this.convertToTaskResponseDto(task)); } // å…¶ä»–æ–¹æ³•... } æœåŠ¡è®¾è®¡ï¼š\nä¾èµ–æ³¨å…¥ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ PrismaService ç±»å‹è½¬æ¢ï¼šä½¿ç”¨ convertToTaskResponseDto æ–¹æ³•ç¡®ä¿è¿”å›ç±»å‹æ­£ç¡® è¿‡æ»¤æ¡ä»¶ï¼šæ”¯æŒå¤šæ¡ä»¶ç»„åˆè¿‡æ»¤ é»˜è®¤å€¼ï¼šä¸ºå¯é€‰å­—æ®µæä¾›åˆç†çš„é»˜è®¤å€¼ 3. ä»»åŠ¡æ§åˆ¶å™¨å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @ApiTags(\u0026#34;tasks\u0026#34;) @Controller(\u0026#34;tasks\u0026#34;) @UseGuards(JwtAuthGuard) export class TaskController { constructor(private readonly taskService: TaskService) {} @Post() @ApiOperation({ summary: \u0026#34;åˆ›å»ºæ–°ä»»åŠ¡\u0026#34; }) @ApiResponse({ status: 201, description: \u0026#34;ä»»åŠ¡åˆ›å»ºæˆåŠŸ\u0026#34;, type: TaskResponseDto, }) async createTask( @Body() createTaskDto: CreateTaskDto ): Promise\u0026lt;TaskResponseDto\u0026gt; { return this.taskService.createTask(createTaskDto); } // å…¶ä»–ç«¯ç‚¹... } æ§åˆ¶å™¨è®¾è®¡ï¼š\nè·¯ç”±å®šä¹‰ï¼šä½¿ç”¨è£…é¥°å™¨å®šä¹‰ HTTP æ–¹æ³•å’Œè·¯å¾„ å‚æ•°ç»‘å®šï¼šä½¿ç”¨è£…é¥°å™¨ç»‘å®šè¯·æ±‚å‚æ•° API æ–‡æ¡£ï¼šä½¿ç”¨ Swagger è£…é¥°å™¨ç”Ÿæˆ API æ–‡æ¡£ è®¤è¯ä¿æŠ¤ï¼šä½¿ç”¨ JwtAuthGuard ä¿æŠ¤æ‰€æœ‰ç«¯ç‚¹ å…­ã€Docker éƒ¨ç½²é…ç½® TactiCore é‡‡ç”¨ Docker å’Œ Docker Compose å®ç°å®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§ã€‚\n1. å¼€å‘ç¯å¢ƒ Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 # backend/Dockerfile.dev FROM node:22-alpine AS development WORKDIR /app # å®‰è£…å¼€å‘ä¾èµ– RUN npm install -g nodemon COPY package*.json ./ RUN npm ci COPY . . # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ RUN npx prisma generate CMD [\u0026#34;npm\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;start:dev:docker\u0026#34;] å¼€å‘ç¯å¢ƒç‰¹ç‚¹ï¼š\nçƒ­é‡è½½ï¼šä½¿ç”¨ nodemon å®ç°ä»£ç å˜æ›´è‡ªåŠ¨é‡å¯ ä¾èµ–å®‰è£…ï¼šä½¿ç”¨ npm ci ç¡®ä¿ä¾èµ–ç‰ˆæœ¬ä¸€è‡´æ€§ Prisma ç”Ÿæˆï¼šåœ¨æ„å»ºæ—¶ç”Ÿæˆ Prisma å®¢æˆ·ç«¯ 2. ç”Ÿäº§ç¯å¢ƒ Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # å¼€å‘é˜¶æ®µ FROM node:22-alpine AS development WORKDIR /app COPY package*.json ./ RUN npm ci COPY . . RUN npx prisma generate RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM node:22-alpine AS production WORKDIR /app COPY --from=development /app/dist ./dist COPY --from=development /app/package*.json ./ COPY --from=development /app/node_modules/.prisma ./node_modules/.prisma COPY --from=development /app/prisma ./prisma COPY --from=development /app/scripts ./scripts RUN npm ci --production # è®¾ç½®è„šæœ¬æƒé™ RUN chmod +x ./scripts/init-db.sh # ä½¿ç”¨åˆå§‹åŒ–è„šæœ¬ CMD [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;./scripts/init-db.sh \u0026amp;\u0026amp; node dist/main.js\u0026#34;] ç”Ÿäº§ç¯å¢ƒç‰¹ç‚¹ï¼š\nå¤šé˜¶æ®µæ„å»ºï¼šä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒä½“ç§¯ ä¾èµ–ä¼˜åŒ–ï¼šä»…å®‰è£…ç”Ÿäº§ç¯å¢ƒä¾èµ– æ•°æ®åº“åˆå§‹åŒ–ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œæ•°æ®åº“è¿ç§» è„šæœ¬æ‰§è¡Œï¼šä½¿ç”¨ shell å‘½ä»¤ç»„åˆå¤šä¸ªæ“ä½œ 3. Docker Compose é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 services: frontend: build: context: . dockerfile: frontend/Dockerfile.prod target: prod ports: - \u0026#34;8080:80\u0026#34; depends_on: - backend backend: build: context: ./backend dockerfile: Dockerfile.prod env_file: - ./backend/.env environment: - NODE_ENV=production volumes: - ./backend/.env:/app/.env depends_on: - mongo - postgres ports: - \u0026#34;3000:3000\u0026#34; mongo: image: mongo:6 volumes: - mongo_data:/data/db environment: - MONGO_INITDB_ROOT_USERNAME=root - MONGO_INITDB_ROOT_PASSWORD=rootpassword123 ports: - \u0026#34;27017:27017\u0026#34; postgres: image: postgres:16.8-alpine3.20 environment: - POSTGRES_USER=postgres - POSTGRES_PASSWORD=postgres123 - POSTGRES_DB=tacticore volumes: - postgres_data:/var/lib/postgresql/data ports: - \u0026#34;5432:5432\u0026#34; healthcheck: test: [\u0026#34;CMD-SHELL\u0026#34;, \u0026#34;pg_isready -U postgres\u0026#34;] interval: 5s timeout: 5s retries: 5 volumes: mongo_data: postgres_data: Compose é…ç½®ç‰¹ç‚¹ï¼š\næœåŠ¡ä¾èµ–ï¼šä½¿ç”¨ depends_on å®šä¹‰æœåŠ¡å¯åŠ¨é¡ºåº ç¯å¢ƒå˜é‡ï¼šé€šè¿‡ env_file å’Œ environment é…ç½®ç¯å¢ƒå˜é‡ æ•°æ®æŒä¹…åŒ–ï¼šä½¿ç”¨å‘½åå·ä¿å­˜æ•°æ®åº“æ•°æ® å¥åº·æ£€æŸ¥ï¼šä¸ºæ•°æ®åº“æœåŠ¡é…ç½®å¥åº·æ£€æŸ¥ ç«¯å£æ˜ å°„ï¼šå°†å®¹å™¨ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£ ä¸ƒã€API æµ‹è¯•ä¸æ–‡æ¡£ æˆ‘ä»¬ä½¿ç”¨ Postman è¿›è¡Œ API æµ‹è¯•ï¼Œå¹¶ç”Ÿæˆ Swagger æ–‡æ¡£ã€‚\n1. Postman æµ‹è¯•é›†è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 { \u0026#34;info\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;TactiCore Task API\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;æµ‹è¯• TactiCore ä»»åŠ¡ç®¡ç† API\u0026#34;, \u0026#34;schema\u0026#34;: \u0026#34;https://schema.getpostman.com/json/collection/v2.1.0/collection.json\u0026#34; }, \u0026#34;item\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;åˆ›å»ºä»»åŠ¡\u0026#34;, \u0026#34;request\u0026#34;: { \u0026#34;method\u0026#34;: \u0026#34;POST\u0026#34;, \u0026#34;header\u0026#34;: [ { \u0026#34;key\u0026#34;: \u0026#34;Content-Type\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;application/json\u0026#34; } ], \u0026#34;body\u0026#34;: { \u0026#34;mode\u0026#34;: \u0026#34;raw\u0026#34;, \u0026#34;raw\u0026#34;: \u0026#34;{\\n \\\u0026#34;title\\\u0026#34;: \\\u0026#34;æµ‹è¯•ä»»åŠ¡\\\u0026#34;,\\n \\\u0026#34;description\\\u0026#34;: \\\u0026#34;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä»»åŠ¡\\\u0026#34;,\\n \\\u0026#34;status\\\u0026#34;: \\\u0026#34;todo\\\u0026#34;,\\n \\\u0026#34;priority\\\u0026#34;: \\\u0026#34;medium\\\u0026#34;,\\n \\\u0026#34;dueDate\\\u0026#34;: \\\u0026#34;2024-12-31T23:59:59Z\\\u0026#34;,\\n \\\u0026#34;tags\\\u0026#34;: [\\\u0026#34;æµ‹è¯•\\\u0026#34;, \\\u0026#34;ç¤ºä¾‹\\\u0026#34;]\\n}\u0026#34; }, \u0026#34;url\u0026#34;: { \u0026#34;raw\u0026#34;: \u0026#34;{{base_url}}/tasks\u0026#34;, \u0026#34;host\u0026#34;: [\u0026#34;{{base_url}}\u0026#34;], \u0026#34;path\u0026#34;: [\u0026#34;tasks\u0026#34;] }, \u0026#34;description\u0026#34;: \u0026#34;åˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡\u0026#34; } } // å…¶ä»–è¯·æ±‚... ], \u0026#34;auth\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;jwt\u0026#34;, \u0026#34;jwt\u0026#34;: [ { \u0026#34;key\u0026#34;: \u0026#34;secret\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;tacticore-jwt-secret\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;algorithm\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;HS256\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;headerPrefix\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;Bearer\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; } ] }, \u0026#34;variable\u0026#34;: [ { \u0026#34;key\u0026#34;: \u0026#34;base_url\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;http://localhost:3000\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;jwt_token\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;tacticore-jwt-secret\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;task_id\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; } ] } æµ‹è¯•é›†ç‰¹ç‚¹ï¼š\nç¯å¢ƒå˜é‡ï¼šä½¿ç”¨å˜é‡å®šä¹‰åŸºç¡€ URL å’Œè®¤è¯ä»¤ç‰Œ JWT è®¤è¯ï¼šé…ç½® JWT è®¤è¯æ–¹å¼ è¯·æ±‚ç»„ç»‡ï¼šæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡è¯·æ±‚ è¯·æ±‚æè¿°ï¼šä¸ºæ¯ä¸ªè¯·æ±‚æ·»åŠ è¯¦ç»†æè¿° 2. JWT è®¤è¯é…ç½® åœ¨ Postman ä¸­ï¼ŒJWT è®¤è¯é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026#34;auth\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;jwt\u0026#34;, \u0026#34;jwt\u0026#34;: [ { \u0026#34;key\u0026#34;: \u0026#34;secret\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;tacticore-jwt-secret\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;algorithm\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;HS256\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;headerPrefix\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;Bearer\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; } ] } è®¤è¯é…ç½®ç‰¹ç‚¹ï¼š\nå¯†é’¥é…ç½®ï¼šè®¾ç½® JWT ç­¾åå¯†é’¥ ç®—æ³•æŒ‡å®šï¼šä½¿ç”¨ HS256 ç®—æ³• å‰ç¼€è®¾ç½®ï¼šè®¾ç½® Bearer å‰ç¼€ 3. æµ‹è¯•æµç¨‹ åˆ›å»ºä»»åŠ¡ï¼š\nå‘é€ POST è¯·æ±‚åˆ° /tasks ç«¯ç‚¹ è¯·æ±‚ä½“åŒ…å«ä»»åŠ¡ä¿¡æ¯ ä»å“åº”ä¸­è·å–ä»»åŠ¡ ID æ›´æ–°ä»»åŠ¡ï¼š\nå°†ä»»åŠ¡ ID è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ task_id å‘é€ PUT è¯·æ±‚åˆ° /tasks/{{task_id}} ç«¯ç‚¹ è¯·æ±‚ä½“åŒ…å«æ›´æ–°çš„ä»»åŠ¡ä¿¡æ¯ è·å–ä»»åŠ¡ï¼š\nå‘é€ GET è¯·æ±‚åˆ° /tasks/{{task_id}} ç«¯ç‚¹ éªŒè¯è¿”å›çš„ä»»åŠ¡ä¿¡æ¯ åˆ é™¤ä»»åŠ¡ï¼š\nå‘é€ DELETE è¯·æ±‚åˆ° /tasks/{{task_id}} ç«¯ç‚¹ éªŒè¯ä»»åŠ¡å·²è¢«åˆ é™¤ å…«ã€æ€»ç»“ä¸å±•æœ› TactiCore åç«¯é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå®ç°äº†è®¤è¯ã€é…ç½®ã€æ•°æ®åº“å’Œä»»åŠ¡ç®¡ç†ç­‰åŠŸèƒ½ã€‚é€šè¿‡ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¡®ä¿äº†ç¯å¢ƒä¸€è‡´æ€§å’Œéƒ¨ç½²ä¾¿æ·æ€§ã€‚\næŠ€æœ¯äº®ç‚¹ï¼š\nç±»å‹å®‰å…¨ï¼šå…¨é¢ä½¿ç”¨ TypeScript ç±»å‹ç³»ç»Ÿ æ¨¡å—åŒ–è®¾è®¡ï¼šå„åŠŸèƒ½æ¨¡å—é«˜åº¦è§£è€¦ ä¾èµ–æ³¨å…¥ï¼šé€šè¿‡ NestJS ä¾èµ–æ³¨å…¥å®ç°æ¾è€¦åˆ æ•°æ®åº“è¿ç§»ï¼šä½¿ç”¨ Prisma ç®¡ç†æ•°æ®åº“è¿ç§» å®¹å™¨åŒ–éƒ¨ç½²ï¼šåŸºäº Docker å®ç°ç¯å¢ƒä¸€è‡´æ€§ æœªæ¥å±•æœ›ï¼š\nç¼“å­˜å±‚ï¼šå¼•å…¥ Redis ç¼“å­˜æé«˜æ€§èƒ½ æ¶ˆæ¯é˜Ÿåˆ—ï¼šé›†æˆæ¶ˆæ¯é˜Ÿåˆ—å¤„ç†å¼‚æ­¥ä»»åŠ¡ ç›‘æ§ç³»ç»Ÿï¼šæ·»åŠ  Prometheus å’Œ Grafana ç›‘æ§ CI/CDï¼šå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹ é€šè¿‡è¿™ä¸€ç³»åˆ—æ¨¡å—çš„ç²¾å¿ƒè®¾è®¡å’Œå®ç°ï¼ŒTactiCore åç«¯ä¸ºå…¨æ ˆåšå®¢ç³»ç»Ÿæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½ä¼˜åŒ–å¥ å®šäº†è‰¯å¥½çš„æ¶æ„åŸºç¡€ã€‚\n","date":"2025-04-15T14:00:00+08:00","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/chapter4/","title":"Chapter4: åç«¯æ¶æ„ä¸å®ç°"},{"content":" Chapter3: è¡¨å•ç³»ç»Ÿä¸ä»»åŠ¡ç®¡ç† â€”â€”åŸºäº React Hook Form å’Œ Zod æ„å»ºç°ä»£åŒ–çš„è¡¨å•ç³»ç»Ÿ\nä¸€ã€è¡¨å•ç³»ç»Ÿæ¶æ„è®¾è®¡ é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¸…æ™°çš„è¡¨å•ç»„ä»¶æ¶æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 frontend/src/ â”œâ”€â”€ components/ â”‚ â”œâ”€â”€ ui/ â”‚ â”‚ â”œâ”€â”€ common/ â”‚ â”‚ â”‚ â”œâ”€â”€ forms/ # è¡¨å•åŸºç¡€ç»„ä»¶ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ BaseForm.tsx # è¡¨å•åŸºç±» â”‚ â”‚ â”‚ â”‚ â””â”€â”€ FormProviderWrapper.tsx # è¡¨å•ä¸Šä¸‹æ–‡åŒ…è£…å™¨ â”‚ â”‚ â”‚ â””â”€â”€ form-controls/ # è¡¨å•æ§ä»¶ â”‚ â”‚ â”‚ â”œâ”€â”€ FormInput.tsx # åŸºç¡€è¾“å…¥æ¡† â”‚ â”‚ â”‚ â”œâ”€â”€ GenericSelect.tsx # é€šç”¨é€‰æ‹©å™¨ â”‚ â”‚ â”‚ â”œâ”€â”€ DatePickerField.tsx # æ—¥æœŸé€‰æ‹©å™¨ â”‚ â”‚ â”‚ â”œâ”€â”€ TagInput.tsx # æ ‡ç­¾è¾“å…¥ â”‚ â”‚ â”‚ â””â”€â”€ TagAutocomplete.tsx # æ ‡ç­¾è‡ªåŠ¨å®Œæˆ â”‚ â””â”€â”€ task/ # ä»»åŠ¡ç›¸å…³ç»„ä»¶ â”‚ â”œâ”€â”€ TaskForm.tsx # ä»»åŠ¡è¡¨å• â”‚ â”œâ”€â”€ TaskList.tsx # ä»»åŠ¡åˆ—è¡¨ â”‚ â””â”€â”€ TaskCard.tsx # ä»»åŠ¡å¡ç‰‡ â””â”€â”€ types/ â””â”€â”€ task.ts # ä»»åŠ¡ç›¸å…³ç±»å‹å®šä¹‰ æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š\nç»„ä»¶åˆ†å±‚ï¼šåŸºç¡€è¡¨å•ç»„ä»¶ä¸ä¸šåŠ¡ç»„ä»¶åˆ†ç¦» ç±»å‹å®‰å…¨ï¼šä½¿ç”¨ Zod è¿›è¡Œè¡¨å•éªŒè¯å’Œç±»å‹æ¨å¯¼ å¯å¤ç”¨æ€§ï¼šé€šç”¨è¡¨å•æ§ä»¶æ”¯æŒå¤šç§åœºæ™¯ äºŒã€æ ¸å¿ƒå®ç°è§£æ 1. è¡¨å•åŸºç¡€æ¶æ„ BaseForm ç»„ä»¶è®¾è®¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 interface BaseFormProps\u0026lt;T extends FieldValues\u0026gt; { onSubmit: SubmitHandler\u0026lt;T\u0026gt;; defaultValues: DefaultValues\u0026lt;T\u0026gt;; schema: ZodSchema\u0026lt;T\u0026gt;; children: React.ReactNode; onFormDataChange?: (data: T) =\u0026gt; void; } const BaseForm = \u0026lt;T extends FieldValues\u0026gt;({ onSubmit, defaultValues, schema, children, onFormDataChange, }: BaseFormProps\u0026lt;T\u0026gt;) =\u0026gt; { return ( \u0026lt;FormProviderWrapper\u0026lt;T\u0026gt; defaultValues={defaultValues} schema={schema}\u0026gt; {({ handleSubmit, watch }: UseFormReturn\u0026lt;T\u0026gt;) =\u0026gt; { watch((data) =\u0026gt; onFormDataChange?.(data as T)); return \u0026lt;form onSubmit={handleSubmit(onSubmit)}\u0026gt;{children}\u0026lt;/form\u0026gt;; }} \u0026lt;/FormProviderWrapper\u0026gt; ); }; å…³é”®æŠ€æœ¯ç‚¹ï¼š\næ³›å‹æ”¯æŒï¼šé€šè¿‡æ³›å‹å‚æ•°Tç¡®ä¿ç±»å‹å®‰å…¨ è¡¨å•éªŒè¯ï¼šä½¿ç”¨ Zod Schema è¿›è¡Œè¡¨å•éªŒè¯ æ•°æ®ç›‘å¬ï¼šé€šè¿‡watchå®ç°è¡¨å•æ•°æ®å˜åŒ–ç›‘å¬ 2. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ ä»»åŠ¡ç±»å‹å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 export interface Task { id: string; title: string; description?: string; status: TaskStatus; dueDate?: Date; priority: TaskPriority; tags?: string[]; createdAt: Date; updatedAt: Date; } export type TaskStatus = \u0026#34;todo\u0026#34; | \u0026#34;inProgress\u0026#34; | \u0026#34;completed\u0026#34;; export type TaskPriority = \u0026#34;low\u0026#34; | \u0026#34;medium\u0026#34; | \u0026#34;high\u0026#34;; è¡¨å•éªŒè¯ Schemaï¼š\n1 2 3 4 5 6 7 8 export const taskSchema = z.object({ title: z.string().min(1, \u0026#34;æ ‡é¢˜ä¸èƒ½ä¸ºç©º\u0026#34;), description: z.string().optional(), status: z.enum([\u0026#34;todo\u0026#34;, \u0026#34;inProgress\u0026#34;, \u0026#34;completed\u0026#34;]), priority: z.enum([\u0026#34;low\u0026#34;, \u0026#34;medium\u0026#34;, \u0026#34;high\u0026#34;]), dueDate: z.date().optional(), tags: z.array(z.string()).optional(), }); 3. è¡¨å•æ§ä»¶å®ç° é€šç”¨é€‰æ‹©å™¨ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 interface GenericSelectProps { name: string; label: string; options: SelectOption[]; } const GenericSelect = ({ name, label, options }: GenericSelectProps) =\u0026gt; { const { register, formState: { errors }, watch, } = useFormContext(); return ( \u0026lt;FormControl fullWidth margin=\u0026#34;normal\u0026#34;\u0026gt; \u0026lt;InputLabel\u0026gt;{label}\u0026lt;/InputLabel\u0026gt; \u0026lt;Select label={label} {...register(name)} value={watch(name) || \u0026#34;\u0026#34;} error={!!errors[name]} \u0026gt; {options.map((option) =\u0026gt; ( \u0026lt;MenuItem key={option.value} value={option.value}\u0026gt; {option.label} \u0026lt;/MenuItem\u0026gt; ))} \u0026lt;/Select\u0026gt; \u0026lt;/FormControl\u0026gt; ); }; æ ‡ç­¾è¾“å…¥ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 const TagInput = ({ name, label }: Props) =\u0026gt; { const [inputValue, setInputValue] = useState(\u0026#34;\u0026#34;); const { setValue, watch, formState: { errors }, } = useFormContext(); const tags = (watch(name) || []) as string[]; const handleAddTag = (tag: string) =\u0026gt; { if (tag.trim()) { const newTags = [...tags, tag.trim()]; setValue(\u0026#34;tags\u0026#34;, newTags); setInputValue(\u0026#34;\u0026#34;); } }; const handleRemoveTag = (index: number) =\u0026gt; { const newTags = tags.filter((_, i) =\u0026gt; i !== index); setValue(\u0026#34;tags\u0026#34;, newTags); }; return ( \u0026lt;Box\u0026gt; \u0026lt;TextField label={label} variant=\u0026#34;outlined\u0026#34; fullWidth margin=\u0026#34;normal\u0026#34; value={inputValue} onChange={(e) =\u0026gt; setInputValue(e.target.value)} onKeyDown={(e) =\u0026gt; { if (e.key === \u0026#34;Enter\u0026#34;) { e.preventDefault(); handleAddTag(inputValue); } }} error={!!errors[name]} helperText={errors[name]?.message?.toString()} /\u0026gt; \u0026lt;Box sx={{ mt: 1, display: \u0026#34;flex\u0026#34;, flexWrap: \u0026#34;wrap\u0026#34;, gap: 1 }}\u0026gt; {tags.map((tag, index) =\u0026gt; ( \u0026lt;Chip key={index} label={tag} onDelete={() =\u0026gt; handleRemoveTag(index)} /\u0026gt; ))} \u0026lt;/Box\u0026gt; \u0026lt;/Box\u0026gt; ); }; ä¸‰ã€å®ç°æ•ˆæœä¸ä¼˜åŒ–æ–¹å‘ å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ è¡¨å•éªŒè¯ï¼šåŸºäº Zod çš„å¼ºç±»å‹è¡¨å•éªŒè¯ çŠ¶æ€ç®¡ç†ï¼šä½¿ç”¨ React Hook Form ç®¡ç†è¡¨å•çŠ¶æ€ ç»„ä»¶å¤ç”¨ï¼šé€šç”¨è¡¨å•æ§ä»¶æ”¯æŒå¤šç§åœºæ™¯ ç±»å‹å®‰å…¨ï¼šå®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ ç»“è¯­\né€šè¿‡æ„å»ºè¿™å¥—è¡¨å•ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¸ä»…å®ç°äº†ç±»å‹å®‰å…¨ã€å¯å¤ç”¨çš„è¡¨å•ç»„ä»¶ï¼Œè¿˜å»ºç«‹äº†ä¸€å¥—å®Œæ•´çš„ä»»åŠ¡ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚æœªæ¥ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä¼˜åŒ–è¡¨å•ç³»ç»Ÿçš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œä¸ºå¼€å‘è€…æä¾›æ›´å¼ºå¤§çš„å·¥å…·æ”¯æŒã€‚\n","date":"2025-04-14T22:00:00+08:00","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/chapter3/","title":"Chapter3: è¡¨å•ç³»ç»Ÿä¸ä»»åŠ¡ç®¡ç†"},{"content":" Chapter2: å‰ç«¯æ§åˆ¶å°åº”ç”¨ â€”â€”æ¶æ„è®¾è®¡ä¸æ ¸å¿ƒå®ç°è§£æ\nä¸€ã€é¡¹ç›®ç»“æ„å…¨æ™¯ æ ¹æ®å®é™…ä»£ç ç»“æ„ï¼Œé¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 frontend/src/ â”œâ”€â”€ components/ â”‚ â”œâ”€â”€ ui/ # åŸå­ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ console/ # æ§åˆ¶å°UIç»„ä»¶ï¼ˆå«æ ‡ç­¾é¡µã€è¾“å…¥æ¡†ç­‰ï¼‰ â”‚ â”‚ â”œâ”€â”€ theme/ # ä¸»é¢˜ç›¸å…³ç»„ä»¶ï¼ˆå¦‚åˆ‡æ¢æŒ‰é’®ï¼‰ â”‚ â”‚ â””â”€â”€ common/ # é€šç”¨ç»„ä»¶ï¼ˆå¦‚å›¾æ ‡æŒ‰é’®ï¼‰ â”‚ â””â”€â”€ providers/ # çŠ¶æ€ç®¡ç†å±‚ â”‚ â””â”€â”€ console/ # æ§åˆ¶å°çŠ¶æ€ç®¡ç†ï¼ˆContexté€»è¾‘ï¼‰ â”œâ”€â”€ theme/ # ä¸»é¢˜ç³»ç»Ÿ â”‚ â”œâ”€â”€ dark/ # æ·±è‰²ä¸»é¢˜é…ç½® â”‚ â””â”€â”€ light/ # æµ…è‰²ä¸»é¢˜é…ç½® â”œâ”€â”€ types/ # ç±»å‹å®šä¹‰ â”‚ â”œâ”€â”€ command.ts # å‘½ä»¤ç³»ç»Ÿç±»å‹ â”‚ â””â”€â”€ console.ts # æ§åˆ¶å°çŠ¶æ€ç±»å‹ â””â”€â”€ utils/ # å·¥å…·å±‚ â””â”€â”€ command/ # å‘½ä»¤ç³»ç»Ÿ â”œâ”€â”€ parser.ts # å‘½ä»¤è§£æå™¨ â”œâ”€â”€ manager.ts # å‘½ä»¤ç®¡ç†å™¨ â””â”€â”€ commands/ # å…·ä½“å‘½ä»¤å®ç° â”œâ”€â”€ index.ts # å‘½ä»¤æ³¨å†Œå…¥å£ â””â”€â”€ help.ts # å¸®åŠ©å‘½ä»¤ å…³é”®è®¾è®¡è§£è¯»ï¼š\nUI ä¸çŠ¶æ€åˆ†ç¦»ï¼šæ§åˆ¶å°æ ‡ç­¾é¡µçš„ UI ç»„ä»¶ï¼ˆui/console/ConsoleTabsï¼‰ä»…è´Ÿè´£æ¸²æŸ“ï¼ŒçŠ¶æ€ç®¡ç†å®Œå…¨ç”±providers/console/å¤„ç† ç±»å‹é›†ä¸­ç®¡ç†ï¼štypes/console.tså®šä¹‰æ§åˆ¶å°çŠ¶æ€ç±»å‹ï¼Œcommand.tså®šä¹‰å‘½ä»¤ç³»ç»Ÿç±»å‹ å‘½ä»¤ç³»ç»Ÿæ¨¡å—åŒ–ï¼šæ¯ä¸ªå‘½ä»¤ç‹¬ç«‹å®ç°ï¼Œé€šè¿‡commands/index.tsç»Ÿä¸€æ³¨å†Œ äºŒã€æ ¸å¿ƒå®ç°è§£æ 1. ä¸»é¢˜ç³»ç»Ÿçš„åŠ¨æ€åˆ‡æ¢ ä¼ªä»£ç ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // åŸºç¡€ä¸»é¢˜é…ç½® const baseTheme = { typography: { fontFamily: \u0026#34;Consolas\u0026#34; }, components: { /* æ»šåŠ¨æ¡ç­‰å…¨å±€æ ·å¼ */ }, }; // æ·±è‰²ä¸»é¢˜æ´¾ç”Ÿ export const darkTheme = createTheme({ ...baseTheme, palette: { mode: \u0026#34;dark\u0026#34;, primary: { main: \u0026#34;#569cd6\u0026#34; } }, }); // Contextæ³¨å…¥ const ThemeContext = createContext(); export const ThemeProvider = ({ children }) =\u0026gt; { const [isDark, setIsDark] = useState(false); return ( \u0026lt;ThemeContext.Provider value={{ theme: isDark ? darkTheme : lightTheme }}\u0026gt; {children} \u0026lt;ThemeToggle onToggle={() =\u0026gt; setIsDark(!isDark)} /\u0026gt; \u0026lt;/ThemeContext.Provider\u0026gt; ); }; å®ç°æŠ€å·§ï¼š\né€šè¿‡createThemeåˆ›å»ºéš”ç¦»çš„ä¸»é¢˜å¯¹è±¡ï¼Œé¿å…æ ·å¼æ±¡æŸ“ åˆ‡æ¢æŒ‰é’®ä½¿ç”¨useThemeé’©å­å®æ—¶è·å–å½“å‰ä¸»é¢˜çŠ¶æ€ CSS è¿‡æ¸¡åŠ¨ç”»å®ç°å¹³æ»‘çš„ä¸»é¢˜åˆ‡æ¢æ•ˆæœ 2. æ§åˆ¶å°çŠ¶æ€ç®¡ç† ä¼ªä»£ç ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // ConsoleContextå®šä¹‰ interface ConsoleContext { consoles: ConsoleState[]; activeConsoleId: string; createConsole: () =\u0026gt; void; deleteConsole: (id: string) =\u0026gt; void; } // Providerå®ç° export const ConsoleProvider = ({ children }) =\u0026gt; { const [consoles, setConsoles] = useState([initConsole()]); const createConsole = () =\u0026gt; { const newConsole = { id: uuid(), name: `æ§åˆ¶å° ${consoles.length + 1}` }; setConsoles([...consoles, newConsole]); }; return ( \u0026lt;ConsoleContext.Provider value={{ consoles, createConsole }}\u0026gt; {children} \u0026lt;/ConsoleContext.Provider\u0026gt; ); }; æ¶æ„ä¼˜åŠ¿ï¼š\nå¤šå®ä¾‹éš”ç¦»ï¼šæ¯ä¸ªæ§åˆ¶å°ç»´æŠ¤ç‹¬ç«‹çš„è¾“å…¥ã€è¾“å‡ºå’Œå‘½ä»¤å†å² æ“ä½œè§£è€¦ï¼šUI ç»„ä»¶é€šè¿‡ Context è·å–çŠ¶æ€ï¼Œä¸ç›´æ¥æ“ä½œæ•°æ® å¯æµ‹è¯•æ€§ï¼šçŠ¶æ€ç®¡ç†é€»è¾‘å¯ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯• 3. ConsoleState æ·±åº¦è§£æ ConsoleState æ˜¯æ§åˆ¶å°åº”ç”¨çš„æ ¸å¿ƒæ•°æ®å®¹å™¨ï¼Œå…¶è®¾è®¡ç›´æ¥å†³å®šäº†å¤šæ§åˆ¶å°å®ä¾‹çš„ç®¡ç†èƒ½åŠ›å’ŒåŠŸèƒ½è¾¹ç•Œã€‚ä»¥ä¸‹æ˜¯å…¶å…·ä½“å®šä¹‰ä¸è®¾è®¡è€ƒé‡ï¼š\n1 2 3 4 5 6 7 8 9 10 interface ConsoleState { id: string; // å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒæ§åˆ¶å° name: string; // ç”¨æˆ·å¯è¯»åç§°ï¼ˆå¦‚\u0026#34;æ§åˆ¶å° 1\u0026#34;ï¼‰ input: string; // å½“å‰è¾“å…¥æ¡†å†…å®¹ output: CommandResult[]; // å†å²è¾“å‡ºç»“æœé›†åˆ commandHistory: string[]; // æ‰§è¡Œè¿‡çš„å‘½ä»¤å†å²è®°å½• historyIndex: number; // æ–¹å‘é”®å¯¼èˆªæ—¶çš„å†å²ç´¢å¼•ï¼ˆ-1è¡¨ç¤ºå½“å‰è¾“å…¥ï¼‰ showLogs: boolean; // æ˜¯å¦æ˜¾ç¤ºè°ƒè¯•æ—¥å¿— commandManager: CommandManager; // ä¸“å±å‘½ä»¤ç®¡ç†å™¨å®ä¾‹ } å…³é”®å­—æ®µè§£è¯» commandManager éš”ç¦»æ€§è®¾è®¡\næ¯ä¸ªæ§åˆ¶å°å®ä¾‹æŒæœ‰ç‹¬ç«‹çš„ CommandManagerï¼Œç¡®ä¿ï¼š\nå‘½ä»¤æ³¨å†Œéš”ç¦»ï¼šä¸åŒæ§åˆ¶å°å¯åŠ è½½ä¸åŒçš„å‘½ä»¤é›† æ‰§è¡Œç¯å¢ƒéš”ç¦»ï¼šå‘½ä»¤çš„å‰¯ä½œç”¨ï¼ˆå¦‚ä¸´æ—¶å˜é‡ï¼‰ä¸ä¼šè·¨æ§åˆ¶å°æ±¡æŸ“ output çš„ç»“æ„åŒ–å­˜å‚¨\nè¾“å‡ºç»“æœé‡‡ç”¨ CommandResult ç±»å‹å°è£…ï¼Œæ”¯æŒåŒºåˆ†ï¼š\n1 2 3 4 5 6 interface CommandResult { success: boolean; // æ‰§è¡Œæ˜¯å¦æˆåŠŸ message: string; // è¾“å‡ºä¿¡æ¯ data?: any; // é™„åŠ æ•°æ®ï¼ˆå¦‚APIè¿”å›ç»“æœï¼‰ isLog?: boolean; // æ˜¯å¦ä¸ºç³»ç»Ÿæ—¥å¿— } è¿™ç§è®¾è®¡ä½¿å¾—æ§åˆ¶å°å¯ä»¥å·®å¼‚åŒ–æ¸²æŸ“å‘½ä»¤ç»“æœä¸ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚é¢œè‰²åŒºåˆ†ï¼‰ã€‚\nhistoryIndex çš„åŒå‘å¯¼èˆª\nå€¼èŒƒå›´ï¼š-1ï¼ˆå½“å‰æ–°è¾“å…¥ï¼‰åˆ° commandHistory.length - 1ï¼ˆæœ€æ—©çš„å†å²å‘½ä»¤ï¼‰ å½“ç”¨æˆ·æŒ‰ â†‘ é”®æ—¶ï¼ŒhistoryIndex é€’å¢å¹¶æ˜¾ç¤ºå¯¹åº”å†å²å‘½ä»¤ æŒ‰ â†“ é”®æ—¶é€’å‡ï¼Œå½“å›åˆ°-1æ—¶æ¸…ç©ºè¾“å…¥æ¡† çŠ¶æ€æ›´æ–°ç­–ç•¥ é€šè¿‡ ConsoleProvider ä¸­çš„å·¥å…·å‡½æ•°ï¼ˆå¦‚ updateConsoleInputï¼‰å®ç°ä¸å¯å˜æ›´æ–°ï¼š\n1 2 3 4 5 6 // ä¼ªä»£ç ï¼šæ›´æ–°è¾“å…¥å†…å®¹ const updateConsoleInput = (consoles, consoleId, input) =\u0026gt; { return consoles.map((console) =\u0026gt; console.id === consoleId ? { ...console, input } : console ); }; æ­¤æ¨¡å¼ç¡®ä¿çŠ¶æ€å˜æ›´å¯è¿½è¸ªï¼Œä¸”ä¸ React çš„æ¸²æŸ“æœºåˆ¶æ·±åº¦å…¼å®¹ã€‚\n4. å‘½ä»¤è§£æå™¨ï¼ˆparseCommandï¼‰è®¾è®¡ è§£ææµç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 è¾“å…¥: \u0026#34;debug --level=info -s\u0026#34; è§£æè¿‡ç¨‹: 1. æ‹†åˆ†ä¸º [\u0026#34;debug\u0026#34;, \u0026#34;--level=info\u0026#34;, \u0026#34;-s\u0026#34;] 2. è¯†åˆ«å‘½ä»¤å: \u0026#34;debug\u0026#34; 3. è§£æå‚æ•°: - \u0026#34;--level=info\u0026#34; â†’ { level: \u0026#34;info\u0026#34; } - \u0026#34;-s\u0026#34; â†’ { show: true } (æ ¹æ®å‘½ä»¤å®šä¹‰çš„é€‰é¡¹åˆ«åæ˜ å°„) 4. è¿”å›ç»“æ„: { name: \u0026#34;debug\u0026#34;, args: { level: \u0026#34;info\u0026#34;, show: true } } å…³é”®æŠ€æœ¯ç‚¹ï¼š\né€‰é¡¹åˆ«åæ˜ å°„ï¼šé€šè¿‡å‘½ä»¤å®šä¹‰çš„optionså­—æ®µå°†-sæ˜ å°„ä¸ºshow ç±»å‹æ¨æ–­ï¼šæ ¹æ®é€‰é¡¹å®šä¹‰çš„typeè‡ªåŠ¨è½¬æ¢å‚æ•°ç±»å‹ï¼ˆå¦‚å­—ç¬¦ä¸² â†’ å¸ƒå°”å€¼ï¼‰ é”™è¯¯å¤„ç†ï¼šå¯¹ç¼ºå¤±å¿…å¡«å‚æ•°æˆ–ç±»å‹é”™è¯¯æŠ›å‡ºè¯¦ç»†å¼‚å¸¸ 5. æ—¥å¿—ç³»ç»Ÿçš„åŒå‘é€šä¿¡ å®ç°ç¤ºæ„å›¾ï¼š\n1 2 3 4 5 6 7 [ä»»æ„æ¨¡å—] --è°ƒç”¨--\u0026gt; logger.debug(\u0026#34;message\u0026#34;) â”‚ â†“ [Loggeræ ¸å¿ƒ] --é€šçŸ¥--\u0026gt; æ‰€æœ‰å·²æ³¨å†Œçš„ç›‘å¬å™¨ â”‚ â†“ [æ§åˆ¶å°ç»„ä»¶] --è¿‡æ»¤--\u0026gt; æ ¹æ®å½“å‰æ§åˆ¶å°çš„showLogsçŠ¶æ€å†³å®šæ˜¯å¦æ˜¾ç¤º æ ¸å¿ƒæœºåˆ¶ï¼š\nç›‘å¬å™¨æ¨¡å¼ï¼šæ§åˆ¶å°ç»„ä»¶é€šè¿‡logger.addListeneræ³¨å†Œæ—¥å¿—å›è°ƒ çº§åˆ«è¿‡æ»¤ï¼šç”Ÿäº§ç¯å¢ƒé»˜è®¤å±è”½ DEBUG æ—¥å¿— ä¸‰ã€é˜¶æ®µæˆæœä¸æ¼”è¿›æ–¹å‘ å·²å®ç°çš„æ ¸å¿ƒèƒ½åŠ› å¤šæ§åˆ¶å°ç®¡ç†ï¼šæ”¯æŒåˆ›å»ºã€åˆ é™¤ã€é‡å‘½åæ§åˆ¶å°å®ä¾‹ å‘½ä»¤ç”Ÿæ€ç³»ç»Ÿï¼šå†…ç½® helpã€debugã€cls ç­‰åŸºç¡€å‘½ä»¤ï¼Œæ”¯æŒæ‰©å±• ä¸»é¢˜å¯å®šåˆ¶åŒ–ï¼šå¼€å‘è€…å¯é€šè¿‡ä¿®æ”¹ä¸»é¢˜é…ç½®å¿«é€Ÿåˆ‡æ¢è§†è§‰é£æ ¼ æ—¥å¿—è¯Šæ–­å·¥å…·ï¼šå®æ—¶æ˜¾ç¤ºç³»ç»Ÿæ—¥å¿—ï¼Œæ”¯æŒæŒ‰çº§åˆ«è¿‡æ»¤ ä¸‹ä¸€æ­¥æ¼”è¿›è®¡åˆ’ æ–¹å‘ å…·ä½“å†…å®¹ å‘½ä»¤æ‰©å±• æ–°å¢ç”¨æˆ·è®¤è¯(auth)ã€æ–‡ç« ç®¡ç†(post)ç­‰ä¸šåŠ¡å‘½ä»¤ äº¤äº’ä¼˜åŒ– å®ç°å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ã€è¾“å‡ºç»“æœè¯­æ³•é«˜äº®ã€æ”¯æŒ Markdown æ¸²æŸ“ æ€§èƒ½æå‡ å¼•å…¥è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½ï¼Œä½¿ç”¨ Web Worker éš”ç¦»å‘½ä»¤è§£æçº¿ç¨‹ æŒä¹…åŒ–å­˜å‚¨ å°†å‘½ä»¤å†å²ã€æ§åˆ¶å°é…ç½®ä¿å­˜è‡³ LocalStorageï¼Œæ”¯æŒä¼šè¯æ¢å¤ ç›‘æ§å¢å¼º é›†æˆæ€§èƒ½æŒ‡æ ‡é¢æ¿ï¼Œå®æ—¶æ˜¾ç¤ºå†…å­˜ã€ç½‘ç»œçŠ¶æ€ç­‰ç³»ç»Ÿä¿¡æ¯ ç»“è¯­\nä»ä¸»é¢˜æŒ‰é’®åˆ°å¤šæ§åˆ¶å°ç³»ç»Ÿï¼Œæ¯ä¸€æ­¥è®¾è®¡éƒ½åœ¨å¹³è¡¡æ‰©å±•æ€§ä¸å¼€å‘ä½“éªŒã€‚å¦‚ä»Šçš„æ¶æ„å¦‚åŒç²¾å¯†çš„é½¿è½®ç»„ï¼Œæ¯ä¸ªæ¨¡å—ç‹¬ç«‹è¿è½¬åˆååŒå·¥ä½œã€‚æœªæ¥æˆ‘ä»¬å°†ç»§ç»­æ‰“å¼€è¿™è‰˜ã€Œæ§åˆ¶å°é£èˆ¹ã€çš„æ›´å¤šèˆ±å®¤ï¼Œæ¢ç´¢å…¨æ ˆåšå®¢ç³»ç»Ÿçš„æ·±å±‚å®‡å®™ã€‚\n","date":"2025-04-13T22:00:00+08:00","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/chapter2/","title":"Chapter2: å‰ç«¯æ§åˆ¶å°åº”ç”¨"},{"content":"ğŸ¬ åˆå§‹åŒ– ğŸ”§ åˆå§‹åŒ–è¿‡ç¨‹è¯¦è§£ 1ï¸âƒ£ ç‰ˆæœ¬æ§åˆ¶åˆå§‹åŒ–\nğŸ“¦ ä½¿ç”¨ git init åˆå§‹åŒ– Git ä»“åº“\nğŸš« åˆ›å»º .gitignore æ–‡ä»¶æ’é™¤ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 node_modules/ # ç¬¬ä¸‰æ–¹ä¾èµ– .env # æ•æ„Ÿé…ç½® .DS_Store # Macç³»ç»Ÿæ–‡ä»¶ *.log # æ—¥å¿—æ–‡ä»¶ dist/ # æ„å»ºäº§ç‰© coverage/ # æµ‹è¯•æŠ¥å‘Š 2ï¸âƒ£ å‰ç«¯è„šæ‰‹æ¶æ­å»º\nâš¡ é€šè¿‡ Vite å¿«é€Ÿç”Ÿæˆé¡¹ç›®ï¼š\n1 npm create vite@latest â–¸ é¡¹ç›®åç§°ï¼šfrontend\nâ–¸ æ¡†æ¶é€‰æ‹©ï¼šReact + TypeScript\nğŸ’¡ ä¼˜åŠ¿ï¼šç»„ä»¶åŒ–å¼€å‘ + ç±»å‹å®‰å…¨\n3ï¸âƒ£ æ ¸å¿ƒä¾èµ–å®‰è£…\nğŸ”Œ è¿›å…¥é¡¹ç›®ç›®å½•æ‰§è¡Œå®‰è£…ï¼š\n1 cd frontend \u0026amp;\u0026amp; npm install ğŸ“š å…³é”®ä¾èµ–è¯´æ˜ï¼š\nä¾èµ–åŒ… åŠŸèƒ½ @mui/material Material Design ç»„ä»¶åº“ react-router-dom SPA è·¯ç”±ç®¡ç† @reduxjs/toolkit çŠ¶æ€ç®¡ç†å·¥å…· axios HTTP å®¢æˆ·ç«¯ 4ï¸âƒ£ åç«¯æœåŠ¡åˆå§‹åŒ–\nğŸ› ï¸ åˆ›å»º NestJS é¡¹ç›®ï¼š\n1 2 3 mkdir backend \u0026amp;\u0026amp; cd backend npm install -g @nestjs/cli nest new . --package-manager npm ğŸ“‚ é¡¹ç›®ç»“æ„è§„èŒƒ é¡¹ç›®ç»“æ„çš„åˆç†è§„åˆ’å¯¹äºé¡¹ç›®çš„é•¿æœŸç»´æŠ¤å’Œæ‰©å±•ååˆ†å…³é”®ã€‚æˆ‘ä»¬çš„å…¨æ ˆåšå®¢ç³»ç»Ÿé‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 TactiCore/ â”œâ”€â”€ .github/ # GitHub é…ç½® â”‚ â”œâ”€â”€ workflows/ # CI/CD æµæ°´çº¿ â”‚ â””â”€â”€ ISSUE_TEMPLATE/ # Issue æ¨¡æ¿ â”œâ”€â”€ frontend/ # å‰ç«¯ (Vite + React) â”‚ â”œâ”€â”€ public/ â”‚ â”‚ â”œâ”€â”€ favicons/ # å¤šå°ºå¯¸ç½‘ç«™å›¾æ ‡ â”‚ â”‚ â””â”€â”€ robots.txt â”‚ â””â”€â”€ src/ â”‚ â”œâ”€â”€ api/ # API è¯·æ±‚å°è£… â”‚ â”œâ”€â”€ assets/ # é™æ€èµ„æº â”‚ â”‚ â”œâ”€â”€ fonts/ â”‚ â”‚ â”œâ”€â”€ images/ â”‚ â”‚ â””â”€â”€ styles/ # å…¨å±€æ ·å¼ â”‚ â”œâ”€â”€ components/ # ç»„ä»¶åº“ â”‚ â”‚ â”œâ”€â”€ ui/ # åŸå­ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ shared/ # ä¸šåŠ¡ç»„ä»¶ â”‚ â”‚ â””â”€â”€ providers/ # Context æä¾›è€… â”‚ â”œâ”€â”€ features/ # Redux Toolkit æ¨¡å— â”‚ â”œâ”€â”€ hooks/ # è‡ªå®šä¹‰ Hooks â”‚ â”œâ”€â”€ layouts/ # é¡µé¢å¸ƒå±€ â”‚ â”œâ”€â”€ locales/ # å›½é™…åŒ– â”‚ â”‚ â”œâ”€â”€ en/ â”‚ â”‚ â””â”€â”€ zh/ â”‚ â”œâ”€â”€ pages/ # è·¯ç”±é¡µé¢ â”‚ â”œâ”€â”€ stores/ # çŠ¶æ€ç®¡ç† â”‚ â”œâ”€â”€ test/ # æµ‹è¯•å¥—ä»¶ â”‚ â”‚ â”œâ”€â”€ e2e/ # ç«¯åˆ°ç«¯æµ‹è¯• â”‚ â”‚ â”œâ”€â”€ integration/ â”‚ â”‚ â”œâ”€â”€ unit/ â”‚ â”‚ â””â”€â”€ mocks/ # Mock æ•°æ® â”‚ â”œâ”€â”€ theme/ # ä¸»é¢˜ç³»ç»Ÿ â”‚ â”‚ â”œâ”€â”€ dark/ â”‚ â”‚ â””â”€â”€ light/ â”‚ â”œâ”€â”€ types/ # TS ç±»å‹å®šä¹‰ â”‚ â”œâ”€â”€ utils/ # å·¥å…·å‡½æ•° â”‚ â”‚ â”œâ”€â”€ helpers/ â”‚ â”‚ â”œâ”€â”€ validation/ â”‚ â”‚ â””â”€â”€ performance/ # æ€§èƒ½ç›‘æ§ â”‚ â””â”€â”€ main.tsx â”œâ”€â”€ backend/ # åç«¯ (NestJS + MongoDB) â”‚ â”œâ”€â”€ src/ â”‚ â”‚ â”œâ”€â”€ app.module.ts # æ ¹æ¨¡å— â”‚ â”‚ â”œâ”€â”€ main.ts # å…¥å£æ–‡ä»¶ â”‚ â”‚ â”œâ”€â”€ core/ # æ ¸å¿ƒæ¨¡å— â”‚ â”‚ â”‚ â”œâ”€â”€ config/ # ç¯å¢ƒé…ç½® â”‚ â”‚ â”‚ â”‚ â””â”€â”€ config.module.ts â”‚ â”‚ â”‚ â”œâ”€â”€ exceptions/ # å…¨å±€å¼‚å¸¸å¤„ç† â”‚ â”‚ â”‚ â””â”€â”€ decorators/ # è‡ªå®šä¹‰è£…é¥°å™¨ â”‚ â”‚ â”œâ”€â”€ database/ # æ•°æ®åº“æ¨¡å— â”‚ â”‚ â”‚ â”œâ”€â”€ database.module.ts â”‚ â”‚ â”‚ â””â”€â”€ schemas/ # MongoDB Schema â”‚ â”‚ â”œâ”€â”€ users/ # ç”¨æˆ·æ¨¡å—ç¤ºä¾‹ â”‚ â”‚ â”‚ â”œâ”€â”€ dto/ # æ•°æ®ä¼ è¾“å¯¹è±¡ â”‚ â”‚ â”‚ â”œâ”€â”€ entities/ # æ•°æ®åº“å®ä½“ â”‚ â”‚ â”‚ â”œâ”€â”€ users.module.ts â”‚ â”‚ â”‚ â”œâ”€â”€ users.service.ts â”‚ â”‚ â”‚ â””â”€â”€ users.controller.ts â”‚ â”‚ â”œâ”€â”€ common/ # é€šç”¨å·¥å…· â”‚ â”‚ â”‚ â”œâ”€â”€ filters/ # å¼‚å¸¸è¿‡æ»¤å™¨ â”‚ â”‚ â”‚ â”œâ”€â”€ interceptors/ # æ‹¦æˆªå™¨ â”‚ â”‚ â”‚ â””â”€â”€ pipes/ # æ•°æ®ç®¡é“ â”‚ â”‚ â””â”€â”€ health/ # å¥åº·æ£€æŸ¥æ¨¡å— â”‚ â”œâ”€â”€ test/ # æµ‹è¯•å¥—ä»¶ â”‚ â”‚ â”œâ”€â”€ e2e/ # ç«¯åˆ°ç«¯æµ‹è¯• â”‚ â”‚ â””â”€â”€ unit/ # å•å…ƒæµ‹è¯• â”‚ â”œâ”€â”€ docker/ # Docker é…ç½® â”‚ â”‚ â””â”€â”€ entrypoint.sh # å®¹å™¨å¯åŠ¨è„šæœ¬ â”‚ â”œâ”€â”€ .env.example # ç¯å¢ƒå˜é‡æ¨¡æ¿ â”‚ â””â”€â”€ nest-cli.json # Nest CLI é…ç½® â”œâ”€â”€ docs/ # æ–‡æ¡£ä¸­å¿ƒ â”‚ â”œâ”€â”€ api.md # API æ–‡æ¡£ â”‚ â”œâ”€â”€ architecture.md # æ¶æ„è®¾è®¡ â”‚ â”œâ”€â”€ setup.md # ç¯å¢ƒé…ç½® â”‚ â””â”€â”€ CHANGELOG.md # æ›´æ–°æ—¥å¿— â”œâ”€â”€ infra/ # åŸºç¡€è®¾æ–½ â”‚ â”œâ”€â”€ docker/ # Docker é…ç½® â”‚ â”‚ â”œâ”€â”€ nginx/ â”‚ â”‚ â””â”€â”€ mongo/ â”‚ â”œâ”€â”€ k8s/ # Kubernetes é…ç½® â”‚ â””â”€â”€ monitoring/ # ç›‘æ§é…ç½® â”‚ â”œâ”€â”€ prometheus/ â”‚ â””â”€â”€ grafana/ â”œâ”€â”€ scripts/ # è‡ªåŠ¨åŒ–è„šæœ¬ â”œâ”€â”€ .vscode/ # IDE é…ç½® â”œâ”€â”€ .husky/ # Git hooks â”œâ”€â”€ .editorconfig # ç¼–è¾‘å™¨è§„èŒƒ â”œâ”€â”€ .eslintrc # ä»£ç æ£€æŸ¥ â”œâ”€â”€ .prettierrc # ä»£ç æ ¼å¼åŒ– â”œâ”€â”€ .env.example # ç¯å¢ƒå˜é‡æ¨¡æ¿ â”œâ”€â”€ .gitattributes # Git é…ç½® â”œâ”€â”€ .gitmessage # æäº¤ä¿¡æ¯æ¨¡æ¿ â”œâ”€â”€ docker-compose.yml # å®¹å™¨ç¼–æ’ â”œâ”€â”€ package.json # å…¨å±€è„šæœ¬ â”œâ”€â”€ CONTRIBUTING.md # è´¡çŒ®æŒ‡å— â””â”€â”€ README.md # é¡¹ç›®æ€»è§ˆ é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¨¡å¼ï¼Œå‰ç«¯åŸºäº React+vite ç”Ÿæ€ï¼Œåç«¯ä½¿ç”¨ NestJS æ¡†æ¶ã€‚å‰ç«¯çš„srcç›®å½•ä¸­æ¶µç›–äº†ä»åŸºç¡€çš„ API å°è£…ã€é™æ€èµ„æºç®¡ç†ï¼Œåˆ°å¤æ‚çš„ç»„ä»¶åº“æ„å»ºã€çŠ¶æ€ç®¡ç†ä»¥åŠå›½é™…åŒ–ç­‰åŠŸèƒ½æ¨¡å—ã€‚åç«¯çš„srcç›®å½•åˆ™åŒ…å«äº†æ ¹æ¨¡å—ã€æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚ç¯å¢ƒé…ç½®ã€å¼‚å¸¸å¤„ç†ï¼‰ã€æ•°æ®åº“æ¨¡å—ã€ç”¨æˆ·æ¨¡å—ç¤ºä¾‹ä»¥åŠé€šç”¨å·¥å…·ç­‰ã€‚åˆç†çš„é¡¹ç›®ç»“æ„è®¾è®¡ä¸ºåç»­çš„å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ä»¥åŠç³»ç»Ÿæ‰©å±•éƒ½æä¾›äº†åšå®çš„åŸºç¡€ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ä¸ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚\nğŸš€ åç«¯ MVP åœ¨å®Œæˆç¬¬ä¸€éƒ¨åˆ†çš„é¡¹ç›®åˆå§‹åŒ–åï¼Œæˆ‘ä»¬ä¸ºå…¨æ ˆåšå®¢ç³»ç»Ÿæ­å»ºèµ·äº†åˆæ­¥æ¡†æ¶ï¼Œæ¥ä¸‹æ¥ä¾¿è¦è¿›å…¥åç«¯çš„ MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰å®ç°é˜¶æ®µï¼Œç€æ‰‹æ­å»ºåç«¯åŸºç¡€é¡¹ç›®ç»“æ„ï¼Œè¿™æ˜¯ä½¿åç«¯æœåŠ¡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œå¹¶æä¾›åŸºç¡€åŠŸèƒ½çš„å…³é”®ä¸€æ­¥ã€‚\nâš™ï¸ æ ¸å¿ƒé…ç½® 1ï¸âƒ£ å®‰è£…å¿…è¦ä¾èµ–ï¼šä¸ºäº†æ„å»ºåŠŸèƒ½å®Œå¤‡çš„åç«¯æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ç³»åˆ—å¿…è¦çš„ä¾èµ–åŒ…ã€‚\n@nestjs/mongooseå’Œmongooseç”¨äºè¿æ¥å’Œæ“ä½œ MongoDB æ•°æ®åº“ï¼Œè¿™å¯¹äºå­˜å‚¨åšå®¢æ•°æ®è‡³å…³é‡è¦ã€‚ dotenvèƒ½å¸®åŠ©æˆ‘ä»¬åŠ è½½ç¯å¢ƒå˜é‡ï¼Œä¾¿äºç®¡ç†ä¸åŒç¯å¢ƒä¸‹çš„é…ç½®ä¿¡æ¯ã€‚ class-validatorå’Œclass-transformerç”¨äºæ•°æ®éªŒè¯å’Œè½¬æ¢ï¼Œä¿éšœæ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚ @nestjs/configç”¨äºç®¡ç†åº”ç”¨çš„é…ç½®ï¼Œ@nestjs/swaggerç”¨äºç”Ÿæˆç¾è§‚ä¸”å®ç”¨çš„ API æ–‡æ¡£ï¼Œ@nestjs/passportå’Œpassport-jwtåˆ™ç”¨äºå®ç°åŸºäº JWT çš„èº«ä»½éªŒè¯åŠŸèƒ½ã€‚ å¼€å‘ç¯å¢ƒä¸‹ï¼Œå®‰è£…@types/passport-jwtä»¥è·å–ç±»å‹å®šä¹‰ï¼Œæ–¹ä¾¿ TypeScript é¡¹ç›®å¼€å‘ã€‚ 1 2 3 npm install @nestjs/mongoose mongoose dotenv class-validator class-transformer npm install @nestjs/config @nestjs/swagger @nestjs/passport passport-jwt npm install --save-dev @types/passport-jwt 2ï¸âƒ£ ç¯å¢ƒå˜é‡é…ç½® (.env)ï¼šåˆç†é…ç½®ç¯å¢ƒå˜é‡èƒ½ä½¿æˆ‘ä»¬çš„åç«¯æœåŠ¡é€‚åº”ä¸åŒçš„è¿è¡Œç¯å¢ƒã€‚åœ¨.envæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†æœåŠ¡è¿è¡Œçš„ç«¯å£PORTï¼Œè¿™é‡Œé»˜è®¤è®¾ä¸º3000ã€‚MONGO_URIç”¨äºæŒ‡å®š MongoDB æ•°æ®åº“çš„è¿æ¥åœ°å€ï¼Œéœ€å¡«å…¥æ­£ç¡®çš„æ•°æ®åº“åœ°å€åŠç›¸å…³è®¤è¯ä¿¡æ¯ã€‚JWT_SECRETåˆ™æ˜¯ç”¨äº JWT èº«ä»½éªŒè¯çš„å¯†é’¥ï¼ŒåŠ¡å¿…å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²ã€‚\n1 2 3 PORT=3000 MONGO_URI=mongodb://tacticore:pwd_tacticore@mongo:27017/tacticore?authSource=admin JWT_SECRET=your_jwt_secret_here ğŸ§© å®ç°æ ¸å¿ƒæ¨¡å— åˆ›å»ºåŸºç¡€æ¨¡å—ç»“æ„ï¼šåˆ©ç”¨ Nest CLI å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåˆ›å»ºåŸºç¡€æ¨¡å—ç»“æ„ã€‚nest generate module core/configç”¨äºåˆ›å»ºé…ç½®æ¨¡å—ï¼Œç®¡ç†åº”ç”¨çš„å„ç§é…ç½®ä¿¡æ¯ï¼›nest generate module databaseåˆ›å»ºæ•°æ®åº“æ¨¡å—ï¼Œè´Ÿè´£ä¸æ•°æ®åº“çš„è¿æ¥å’Œäº¤äº’ï¼›nest generate controller healthåˆ™åˆ›å»ºäº†å¥åº·æ£€æŸ¥æ§åˆ¶å™¨ï¼Œç”¨äºç›‘æ§åç«¯æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚\n1 2 3 nest generate module core/config nest generate module database nest generate controller health é…ç½®æ¨¡å— (src/core/config/config.module.ts)ï¼šåœ¨é…ç½®æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†@nestjs/configæ¨¡å—ï¼Œå¹¶ä½¿ç”¨Joiåº“å¯¹ç¯å¢ƒå˜é‡è¿›è¡ŒéªŒè¯ã€‚Joiæ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript æ•°æ®éªŒè¯åº“ï¼Œåœ¨ NestJS ä¸­å¸¸ä¸@nestjs/configç»“åˆä½¿ç”¨ã€‚é¦–å…ˆéœ€è¦å®‰è£…joiåŠå…¶ç±»å‹å®šä¹‰ï¼ˆTypeScript é¡¹ç›®éœ€è¦ï¼‰ï¼š\n1 npm install joi @types/joi å®‰è£…å®Œæˆåï¼Œåœ¨é…ç½®æ¨¡å—ä¸­å¼•å…¥å¹¶å®šä¹‰éªŒè¯è§„åˆ™ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // src/config/config.module.ts import { Module } from \u0026#34;@nestjs/common\u0026#34;; import { ConfigModule } from \u0026#34;@nestjs/config\u0026#34;; import * as Joi from \u0026#34;joi\u0026#34;; @Module({ imports: [ ConfigModule.forRoot({ isGlobal: true, envFilePath: \u0026#34;.env\u0026#34;, validationSchema: Joi.object({ PORT: Joi.number().default(3000), MONGO_URI: Joi.string().required(), JWT_SECRET: Joi.string().min(16).required(), NODE_ENV: Joi.string() .valid(\u0026#34;development\u0026#34;, \u0026#34;production\u0026#34;, \u0026#34;test\u0026#34;) .default(\u0026#34;development\u0026#34;), }), validationOptions: { allowUnknown: true, abortEarly: true, }, }), ], exports: [ConfigModule], }) export class ConfigurationModule {} è¿™é‡Œçš„éªŒè¯è§„åˆ™å¦‚ä¸‹ï¼š\nJoi.number().default(3000)ï¼šè¡¨ç¤ºPORTå¿…é¡»æ˜¯æ•°å­—ï¼Œé»˜è®¤å€¼ä¸º3000ã€‚ Joi.string().required()ï¼šè¯´æ˜MONGO_URIæ˜¯å¿…å¡«çš„å­—ç¬¦ä¸²ã€‚ Joi.string().min(16)ï¼šè¦æ±‚JWT_SECRETæ˜¯æœ€å°é•¿åº¦ä¸º16çš„å­—ç¬¦ä¸²ã€‚ Joi.string().valid(...)ï¼šé™å®šNODE_ENVåªèƒ½æ˜¯developmentã€productionã€testä¸­çš„ä¸€ä¸ªï¼Œé»˜è®¤å€¼ä¸ºdevelopmentã€‚ å¦‚æœ.envæ–‡ä»¶ç¼ºå°‘MONGO_URIæˆ–JWT_SECRETç­‰å¿…å¡«é¡¹ï¼Œå¯åŠ¨æ—¶å°±ä¼šæŠ¥é”™ï¼Œä¾‹å¦‚ï¼š 1 Error: Config validation error: \u0026#34;MONGO_URI\u0026#34; is required æ•°æ®åº“æ¨¡å— (src/database/database.module.ts)ï¼šæ•°æ®åº“æ¨¡å—è´Ÿè´£è¿æ¥åˆ° MongoDB æ•°æ®åº“ã€‚é€šè¿‡MongooseModule.forRootAsyncæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè¿™é‡Œä»ç¯å¢ƒå˜é‡process.env.MONGO_URIä¸­è·å–è¿æ¥åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 import { Module } from \u0026#34;@nestjs/common\u0026#34;; import { MongooseModule } from \u0026#34;@nestjs/mongoose\u0026#34;; @Module({ imports: [ MongooseModule.forRootAsync({ useFactory: () =\u0026gt; ({ uri: process.env.MONGO_URI, }), }), ], }) export class DatabaseModule {} ğŸ©º å¥åº·æ£€æŸ¥ç«¯ç‚¹ (src/health/health.controller.ts) å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼šå¥åº·æ£€æŸ¥ç«¯ç‚¹ç”¨äºæ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚é€šè¿‡@Controller('health')è£…é¥°å™¨å®šä¹‰äº†æ§åˆ¶å™¨çš„è·¯ç”±å‰ç¼€ä¸ºhealthã€‚@Get()è£…é¥°å™¨è¡¨ç¤ºè¯¥æ–¹æ³•å¤„ç† HTTP GET è¯·æ±‚ï¼Œ@ApiOperationå’Œ@ApiResponseè£…é¥°å™¨ç”¨äºåœ¨ Swagger æ–‡æ¡£ä¸­æè¿°è¯¥æ¥å£çš„åŠŸèƒ½å’Œå“åº”ä¿¡æ¯ã€‚å½“è®¿é—®/healthç«¯ç‚¹æ—¶ï¼Œä¼šè¿”å›æœåŠ¡çš„çŠ¶æ€å’Œå½“å‰æ—¶é—´æˆ³ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import { Controller, Get } from \u0026#34;@nestjs/common\u0026#34;; import { ApiOperation, ApiResponse } from \u0026#34;@nestjs/swagger\u0026#34;; @Controller(\u0026#34;health\u0026#34;) export class HealthController { @Get() @ApiOperation({ summary: \u0026#34;æœåŠ¡å¥åº·æ£€æŸ¥\u0026#34; }) @ApiResponse({ status: 200, description: \u0026#34;æœåŠ¡è¿è¡Œæ­£å¸¸\u0026#34; }) checkHealth() { return { status: \u0026#34;UP\u0026#34;, timestamp: new Date().toISOString(), }; } } ğŸ”§ è°ƒæ•´å…¥å£æ–‡ä»¶ (src/main.ts) åœ¨å…¥å£æ–‡ä»¶src/main.tsä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† Nest åº”ç”¨å®ä¾‹ï¼Œå¹¶ä½¿ç”¨app.useGlobalPipesæ–¹æ³•å¯ç”¨äº†å…¨å±€éªŒè¯ç®¡é“ã€‚è¯¥ç®¡é“é…ç½®äº†whitelist: trueï¼Œè¡¨ç¤ºåªæ¥å—éªŒè¯é€šè¿‡çš„å±æ€§ï¼ŒforbidNonWhitelisted: trueåˆ™ç¦æ­¢æ¥å—æœªé€šè¿‡éªŒè¯çš„å±æ€§ï¼Œä»è€Œç¡®ä¿è¾“å…¥æ•°æ®çš„åˆæ³•æ€§ã€‚æœ€åï¼Œåº”ç”¨ç›‘å¬æŒ‡å®šç«¯å£ï¼Œå¹¶åœ¨æ§åˆ¶å°è¾“å‡ºåº”ç”¨è¿è¡Œçš„åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import { NestFactory } from \u0026#34;@nestjs/core\u0026#34;; import { AppModule } from \u0026#34;./app.module\u0026#34;; import { ValidationPipe } from \u0026#34;@nestjs/common\u0026#34;; async function bootstrap() { const app = await NestFactory.create(AppModule); // å…¨å±€éªŒè¯ç®¡é“ app.useGlobalPipes( new ValidationPipe({ whitelist: true, forbidNonWhitelisted: true, }) ); await app.listen(process.env.PORT || 3000); console.log(`Application running on: ${await app.getUrl()}`); } bootstrap(); âœ… éªŒè¯æ­¥éª¤ å®Œæˆä¸Šè¿°é…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š\nè¿è¡Œæµ‹è¯•ï¼šæ‰§è¡Œnpm run testå‘½ä»¤ï¼Œè¿è¡Œé¡¹ç›®ä¸­çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿å„ä¸ªæ¨¡å—çš„åŠŸèƒ½ç¬¦åˆé¢„æœŸã€‚ å¯åŠ¨å¼€å‘æ¨¡å¼ï¼šä½¿ç”¨npm run start:devå‘½ä»¤ï¼Œä»¥å¼€å‘æ¨¡å¼å¯åŠ¨åç«¯æœåŠ¡ï¼Œä¾¿äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­å®æ—¶æŸ¥çœ‹ä»£ç å˜æ›´å¸¦æ¥çš„æ•ˆæœã€‚ éªŒè¯ç«¯ç‚¹ï¼šé€šè¿‡curl http://localhost:3000/healthå‘½ä»¤ï¼Œå‘å¥åº·æ£€æŸ¥ç«¯ç‚¹å‘é€è¯·æ±‚ï¼ŒéªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚å¦‚æœæœåŠ¡æ­£å¸¸ï¼Œå°†è¿”å›ç±»ä¼¼å¦‚ä¸‹çš„ç»“æœï¼š 1 2 3 4 { \u0026#34;status\u0026#34;: \u0026#34;UP\u0026#34;, \u0026#34;timestamp\u0026#34;: \u0026#34;2025-04-11T12:00:00.000Z\u0026#34; } ğŸ› ï¸ æ¨èå·¥å…·é“¾ ä¸ºäº†è¿›ä¸€æ­¥æå‡åç«¯å¼€å‘æ•ˆç‡å’ŒæœåŠ¡è´¨é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€äº›å·¥å…·ï¼š\nå·¥å…· ç”¨é€” å®‰è£…å‘½ä»¤ NestJS Swagger API æ–‡æ¡£ç”Ÿæˆ npm install @nestjs/swagger NestJS CQRS å¤æ‚ä¸šåŠ¡é€»è¾‘ç®¡ç† npm install @nestjs/cqrs NestJS Cache ç¼“å­˜ç®¡ç† npm install @nestjs/cache-manager Jest å•å…ƒæµ‹è¯• å†…ç½® Compodoc é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ npm install @compodoc/compodoc NestJS Swagger å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„ API æ–‡æ¡£ï¼Œæ–¹ä¾¿å›¢é˜Ÿåä½œå’Œæ¥å£è°ƒè¯•ï¼›NestJS CQRS æœ‰åŠ©äºç®¡ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼›NestJS Cache ç”¨äºç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼›Jest ä½œä¸ºå†…ç½®çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œèƒ½å¤Ÿä¿è¯ä»£ç è´¨é‡ï¼›Compodoc åˆ™å¯ä»¥ç”Ÿæˆå…¨é¢çš„é¡¹ç›®æ–‡æ¡£ï¼Œæ–¹ä¾¿å›¢é˜Ÿæˆå‘˜äº†è§£é¡¹ç›®ç»“æ„å’ŒåŠŸèƒ½ã€‚\né€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬åˆæ­¥å®Œæˆäº†åç«¯çš„ MVP å®ç°ï¼Œæ­å»ºèµ·äº†åŸºç¡€é¡¹ç›®ç»“æ„ï¼Œä¸ºåç»­æ·»åŠ æ›´å¤šä¸šåŠ¡åŠŸèƒ½å¥ å®šäº†åšå®åŸºç¡€ã€‚\nğŸ³ å®¹å™¨åŒ–éƒ¨ç½² åœ¨å®Œæˆç¬¬äºŒéƒ¨åˆ†åç«¯åŸºç¡€é¡¹ç›®ç»“æ„æ­å»ºåï¼Œä¸ºäº†å®ç°é¡¹ç›®çš„å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºåœ¨ä¸åŒç¯å¢ƒä¸­å¿«é€Ÿã€ç¨³å®šåœ°è¿è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Docker é…ç½®ç›¸å…³å†…å®¹ã€‚Docker èƒ½å¤Ÿå°†åº”ç”¨åŠå…¶ä¾èµ–æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„é•œåƒï¼Œç¡®ä¿åœ¨ä»»ä½•ç¯å¢ƒä¸­éƒ½èƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Œå¤§å¤§æå‡äº†é¡¹ç›®éƒ¨ç½²çš„æ•ˆç‡å’Œä¸€è‡´æ€§ã€‚\nğŸ“ æ–‡ä»¶ç»“æ„é¢„è§ˆ æ ¹æ®é¡¹ç›®ç»“æ„è§„åˆ’ï¼ŒDocker ç›¸å…³é…ç½®ä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹ä½ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 TactiCore/ â”œâ”€â”€ infra/ â”‚ â”œâ”€â”€ docker/ â”‚ â”‚ â”œâ”€â”€ nginx/ â”‚ â”‚ â”‚ â”œâ”€â”€ nginx.conf # Nginx ä¸»é…ç½® â”‚ â”‚ â”‚ â””â”€â”€ tacticore.conf # é¡¹ç›®ä¸“ç”¨é…ç½® â”‚ â”‚ â””â”€â”€ mongo/ â”‚ â”‚ â””â”€â”€ init-mongo.js # MongoDB åˆå§‹åŒ–è„šæœ¬ â”œâ”€â”€ docker-compose.yml # ä¸»ç¼–æ’æ–‡ä»¶ â”œâ”€â”€ frontend/ | â”œâ”€â”€ Dockerfile.prod # å‰ç«¯é•œåƒé…ç½® | â””â”€â”€ Dockerfile.dev â””â”€â”€ backend/ â”œâ”€â”€ Dockerfile.prod # åç«¯é•œåƒé…ç½® â””â”€â”€Dockerfile.dev ä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»å…·ä½“çš„é…ç½®æ­¥éª¤ï¼š\nğŸ–¥ï¸ å‰ç«¯é•œåƒé…ç½® (frontend/Dockerfile.prod) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # frontend/Dockerfile.prod # ================= æ„å»ºé˜¶æ®µ ================= FROM node:22-alpine AS builder WORKDIR /app COPY frontend/package*.json ./ RUN npm ci COPY frontend/ . RUN npm run build # ================= ç”Ÿäº§é˜¶æ®µ ================= FROM nginx:alpine AS prod COPY --from=builder /app/dist /usr/share/nginx/html COPY infra/docker/nginx/tacticore.conf /etc/nginx/conf.d/default.conf EXPOSE 80 CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] æ„å»ºé˜¶æ®µï¼šåŸºäºnode:22-alpineé•œåƒåˆ›å»ºä¸€ä¸ªåä¸ºbuilderçš„æ„å»ºé˜¶æ®µã€‚è®¾ç½®å·¥ä½œç›®å½•ä¸º/appï¼Œå°†å‰ç«¯é¡¹ç›®çš„package*.jsonæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œæ‰§è¡Œnpm ciå®‰è£…ä¾èµ–ã€‚è¿™é‡Œä½¿ç”¨npm ciè€Œénpm installï¼Œnpm ciæ˜¯ä¸“é—¨ä¸ºè‡ªåŠ¨åŒ–ç¯å¢ƒè®¾è®¡çš„ä¾èµ–å®‰è£…å‘½ä»¤ï¼Œå®ƒä¸¥æ ¼æŒ‰ç…§package-lock.jsonçš„ç‰ˆæœ¬å®‰è£…ä¾èµ–ï¼Œä¸ä¿®æ”¹ä»»ä½•æ–‡ä»¶ï¼Œèƒ½ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒçš„ä¾èµ–å®Œå…¨ä¸€è‡´ï¼Œé¿å…â€œåœ¨æˆ‘æœºå™¨ä¸Šæ˜¯å¥½çš„â€é—®é¢˜ï¼ŒåŒæ—¶æ˜¾è‘—åŠ å¿« Docker é•œåƒæ„å»ºé€Ÿåº¦ã€‚æ¥ç€å°†æ•´ä¸ªå‰ç«¯é¡¹ç›®å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¹¶æ‰§è¡Œnpm run buildè¿›è¡Œé¡¹ç›®æ„å»ºã€‚ ç”Ÿäº§é˜¶æ®µï¼šåŸºäºnginx:alpineé•œåƒåˆ›å»ºç”Ÿäº§é˜¶æ®µã€‚ä»builderé˜¶æ®µå¤åˆ¶ç¼–è¯‘å¥½çš„å‰ç«¯æ–‡ä»¶åˆ°/usr/share/nginx/htmlç›®å½•ï¼Œè¿™æ˜¯ Nginx é»˜è®¤çš„é™æ€èµ„æºç›®å½•ã€‚åŒæ—¶ï¼Œå°†é¡¹ç›®è‡ªå®šä¹‰çš„ Nginx é…ç½®æ–‡ä»¶infra/docker/nginx/tacticore.confå¤åˆ¶åˆ°/etc/nginx/conf.d/default.confï¼Œè¦†ç›–é»˜è®¤çš„ Nginx é…ç½®ã€‚é€šè¿‡EXPOSE 80å£°æ˜å®¹å™¨ç›‘å¬ç«¯å£ä¸º 80ï¼Œæœ€åä½¿ç”¨CMD [\u0026quot;nginx\u0026quot;, \u0026quot;-g\u0026quot;, \u0026quot;daemon off;\u0026quot;]ä»¥å‰å°æ¨¡å¼å¯åŠ¨ Nginx æœåŠ¡ï¼Œç¡®ä¿ Docker å®¹å™¨è¿è¡Œæ—¶ Nginx æœåŠ¡å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ ğŸ—„ï¸ åç«¯é•œåƒé…ç½® (backend/Dockerfile.prod) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¼€å‘é˜¶æ®µ FROM node:22-alpine AS development WORKDIR /app COPY package*.json ./ RUN npm ci COPY . . RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM node:22-alpine AS production WORKDIR /app COPY --from=development /app/dist ./dist COPY --from=development /app/package*.json ./ RUN npm ci --production CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/main.js\u0026#34;] å¼€å‘é˜¶æ®µï¼šåŸºäºnode:22-alpineé•œåƒåˆ›å»ºåä¸ºdevelopmentçš„å¼€å‘é˜¶æ®µã€‚è®¾ç½®å·¥ä½œç›®å½•ä¸º/appï¼Œå¤åˆ¶åç«¯é¡¹ç›®çš„package*.jsonæ–‡ä»¶ï¼Œæ‰§è¡Œnpm ciå®‰è£…ä¾èµ–ï¼Œå†å°†æ•´ä¸ªåç«¯é¡¹ç›®å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¹¶æ‰§è¡Œnpm run buildè¿›è¡Œé¡¹ç›®æ„å»ºã€‚ ç”Ÿäº§é˜¶æ®µï¼šåŒæ ·åŸºäºnode:22-alpineé•œåƒåˆ›å»ºproductioné˜¶æ®µã€‚ä»developmenté˜¶æ®µå¤åˆ¶ç¼–è¯‘åçš„æ–‡ä»¶åˆ°/app/distç›®å½•ï¼ŒåŒæ—¶å¤åˆ¶package*.jsonæ–‡ä»¶ã€‚æ‰§è¡Œnpm ci --productionå®‰è£…ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„ä¾èµ–ï¼Œè¿™é‡Œ--productionå‚æ•°ä¼šè·³è¿‡å®‰è£…devDependenciesã€‚æœ€åé€šè¿‡CMD [\u0026quot;node\u0026quot;, \u0026quot;dist/main.js\u0026quot;]å¯åŠ¨åç«¯æœåŠ¡ã€‚ ğŸ§© æ•°æ®åº“åˆå§‹åŒ– (infra/docker/mongo/init-mongo.js) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // ==================== å®‰å…¨å¢å¼º ==================== // 1. åˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“ï¼ˆæ˜¾å¼åˆ›å»ºæ•°æ®åº“ï¼‰ db = db.getSiblingDB(\u0026#34;tacticore\u0026#34;); // 2. åˆ›å»ºä¸“ç”¨ç”¨æˆ· db.createUser({ user: \u0026#34;tacticore\u0026#34;, pwd: \u0026#34;pwd-tacticore\u0026#34;, // ç”Ÿäº§ç¯å¢ƒåº”ä»ç¯å¢ƒå˜é‡è·å– roles: [ { role: \u0026#34;readWrite\u0026#34;, db: \u0026#34;tacticore\u0026#34; }, // åº”ç”¨æ•°æ®åº“æƒé™ { role: \u0026#34;clusterMonitor\u0026#34;, db: \u0026#34;admin\u0026#34; }, // ç›‘æ§æƒé™ï¼ˆå¯é€‰ï¼‰ ], }); // 3. åˆ›å»ºåˆå§‹é›†åˆï¼ˆå¯é€‰ï¼‰ db.createCollection(\u0026#34;users\u0026#34;, { validator: { $jsonSchema: { bsonType: \u0026#34;object\u0026#34;, required: [\u0026#34;username\u0026#34;, \u0026#34;email\u0026#34;], properties: { username: { bsonType: \u0026#34;string\u0026#34; }, email: { bsonType: \u0026#34;string\u0026#34; }, }, }, }, }); // 4. åˆ›å»ºç´¢å¼•ï¼ˆå¯é€‰ï¼‰ db.users.createIndex({ email: 1 }, { unique: true }); // 5. æ’å…¥åˆå§‹æ•°æ®ï¼ˆå¯é€‰ï¼‰ db.users.insertOne({ username: \u0026#34;admin\u0026#34;, email: \u0026#34;admin@tacticore.com\u0026#34;, createdAt: new Date(), }); // 6. éªŒè¯ç»“æœï¼ˆè°ƒè¯•ç”¨ï¼‰ print(\u0026#34;========== åˆå§‹åŒ–å®Œæˆ ==========\u0026#34;); printjson(db.getUsers()); åœ¨è¿™ä¸ªè„šæœ¬ä¸­ï¼Œé¦–å…ˆåˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“tacticoreï¼Œè‹¥æ•°æ®åº“ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ç„¶ååˆ›å»ºä¸€ä¸ªä¸“ç”¨ç”¨æˆ·tacticoreï¼Œå¹¶èµ‹äºˆå…¶åœ¨tacticoreæ•°æ®åº“çš„è¯»å†™æƒé™ä»¥åŠåœ¨adminæ•°æ®åº“çš„ç›‘æ§æƒé™ï¼ˆå¯é€‰ï¼‰ã€‚æ¥ç€å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚åˆ›å»ºåˆå§‹é›†åˆusersï¼Œå¹¶å®šä¹‰é›†åˆçš„æ•°æ®æ ¡éªŒè§„åˆ™ï¼Œè¦æ±‚usernameå’Œemailå­—æ®µä¸ºå¿…å¡«ï¼Œä¸”ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚ä¸ºemailå­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œç¡®ä¿emailçš„å”¯ä¸€æ€§ã€‚è¿˜å¯ä»¥æ’å…¥ä¸€æ¡åˆå§‹æ•°æ®ç”¨äºæµ‹è¯•ã€‚æœ€åè¾“å‡ºåˆå§‹åŒ–å®Œæˆçš„ä¿¡æ¯ï¼Œå¹¶æ‰“å°å½“å‰ç”¨æˆ·åˆ—è¡¨ç”¨äºè°ƒè¯•ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯†ç åº”ä»ç¯å¢ƒå˜é‡è·å–ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚\nğŸŒ Nginx é…ç½® (infra/docker/nginx/tacticore.conf) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 server { listen 80; server_name localhost; # å‰ç«¯è·¯ç”±å¤„ç† location / { root /usr/share/nginx/html; try_files $uri $uri/ /index.html; } # åç«¯ä»£ç† location /api/ { proxy_pass http://backend:3000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; } } Nginx åœ¨é¡¹ç›®ä¸­æ‰¿æ‹…ç€é‡è¦è§’è‰²ã€‚é€šè¿‡è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼ŒNginx ç›‘å¬ç«¯å£ 80ã€‚åœ¨å‰ç«¯è·¯ç”±å¤„ç†æ–¹é¢ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„æ—¶ï¼ŒNginx ä¼šä»/usr/share/nginx/htmlç›®å½•æŸ¥æ‰¾å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè‹¥æœªæ‰¾åˆ°åˆ™è¿”å›index.htmlï¼Œè¿™å¯¹äºå•é¡µåº”ç”¨ï¼ˆSPAï¼‰çš„è·¯ç”±å¤„ç†éå¸¸å…³é”®ã€‚åœ¨åç«¯ä»£ç†æ–¹é¢ï¼Œå½“æ¥æ”¶åˆ°ä»¥/api/å¼€å¤´çš„è¯·æ±‚æ—¶ï¼ŒNginx ä¼šå°†è¯·æ±‚è½¬å‘åˆ°http://backend:3000ï¼ŒåŒæ—¶è®¾ç½®Hostå’ŒX-Real-IPå¤´éƒ¨ä¿¡æ¯ï¼Œéšè—åç«¯çœŸå®ç«¯å£å’Œç»†èŠ‚ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚\nğŸ› docker-compose ç¼–æ’ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 services: frontend: build: context: . dockerfile: frontend/Dockerfile.prod target: prod # é»˜è®¤ç”Ÿäº§ç¯å¢ƒ ports: - \u0026#34;8080:80\u0026#34; depends_on: - backend backend: build: context: ./backend dockerfile: Dockerfile.prod env_file: - ./backend/.env environment: - NODE_ENV=production volumes: - ./backend/.env:/app/.env depends_on: - mongo ports: - \u0026#34;3000:3000\u0026#34; mongo: image: mongo:6 volumes: - mongo_data:/data/db - ./infra/docker/mongo/init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro environment: - MONGO_INITDB_ROOT_USERNAME=root - MONGO_INITDB_ROOT_PASSWORD=rootpassword123 ports: - \u0026#34;27017:27017\u0026#34; volumes: mongo_data: docker-compose.ymlç”¨äºç¼–æ’å¤šä¸ª Docker å®¹å™¨æœåŠ¡ã€‚è¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªæœåŠ¡ï¼š\nfrontendï¼šåŸºäºå‰ç«¯é¡¹ç›®æ ¹ç›®å½•æ„å»ºé•œåƒï¼Œä½¿ç”¨frontend/Dockerfile.prodï¼Œç›®æ ‡ä¸ºç”Ÿäº§ç¯å¢ƒã€‚å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£ï¼Œå¹¶ä¸”ä¾èµ–backendæœåŠ¡ï¼Œç¡®ä¿backendæœåŠ¡å…ˆå¯åŠ¨ã€‚ backendï¼šåŸºäºåç«¯é¡¹ç›®ç›®å½•æ„å»ºé•œåƒï¼Œä½¿ç”¨backend/Dockerfile.prodã€‚é€šè¿‡env_fileåŠ è½½./backend/.envæ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œè®¾ç½®NODE_ENVä¸ºproductionã€‚å°†ä¸»æœºçš„./backend/.envæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…çš„/app/.envï¼Œå®ç°ç¯å¢ƒå˜é‡çš„åŒæ­¥ã€‚ä¾èµ–mongoæœåŠ¡ï¼Œç¡®ä¿mongoæœåŠ¡å…ˆå¯åŠ¨ã€‚å°†å®¹å™¨çš„ 3000 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 3000 ç«¯å£ã€‚ mongoï¼šä½¿ç”¨mongo:6å®˜æ–¹é•œåƒã€‚å°†mongo_dataå·æŒ‚è½½åˆ°å®¹å™¨å†…çš„/data/dbç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨ MongoDB æ•°æ®ã€‚å°†./infra/docker/mongo/init-mongo.jsæ–‡ä»¶åªè¯»æŒ‚è½½åˆ°/docker-entrypoint-initdb.d/init-mongo.jsï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬è¿›è¡Œ MongoDB çš„åˆå§‹åŒ–ã€‚è®¾ç½®MONGO_INITDB_ROOT_USERNAMEå’ŒMONGO_INITDB_ROOT_PASSWORDç¯å¢ƒå˜é‡ï¼Œç”¨äºåˆå§‹åŒ– MongoDB çš„ root ç”¨æˆ·ã€‚å°†å®¹å™¨çš„ 27017 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 27017 ç«¯å£ã€‚ ğŸš€ å¯åŠ¨å‘½ä»¤ å®Œæˆä¸Šè¿°é…ç½®åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨é¡¹ç›®ï¼š\n1 2 3 4 5 6 7 8 # æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ docker-compose up --build # è®¿é—®å‰ç«¯ http://localhost:8080 # éªŒè¯æœåŠ¡ docker-compose ps docker-compose up --buildå‘½ä»¤ä¼šæ„å»ºæ‰€æœ‰æœåŠ¡çš„é•œåƒå¹¶å¯åŠ¨å®¹å™¨ã€‚æ„å»ºè¿‡ç¨‹ä¸­ä¼šæ ¹æ®å„ä¸ªDockerfileçš„é…ç½®è¿›è¡Œæ“ä½œã€‚æ„å»ºå®Œæˆåï¼Œå‰ç«¯æœåŠ¡å¯é€šè¿‡http://localhost:8080è®¿é—®ã€‚docker-compose pså‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨æœåŠ¡çŠ¶æ€ï¼Œç¡®ä¿å„ä¸ªæœåŠ¡æ­£å¸¸å¯åŠ¨ã€‚\né€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„ Docker é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†å…¨æ ˆåšå®¢ç³»ç»Ÿçš„å‰ç«¯ã€åç«¯ä»¥åŠæ•°æ®åº“æœåŠ¡ä»¥å®¹å™¨åŒ–çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²å’Œç®¡ç†ï¼Œä¸ºé¡¹ç›®çš„ç¨³å®šè¿è¡Œå’Œåç»­æ‰©å±•æä¾›æœ‰åŠ›æ”¯æŒã€‚\nâš¡ Docker çƒ­æ›´æ–° åœ¨å®Œæˆç¬¬ä¸‰éƒ¨åˆ†çš„ Docker é…ç½®åï¼Œé¡¹ç›®å·²ç»å¯ä»¥ä»¥å®¹å™¨åŒ–çš„æ–¹å¼ç¨³å®šéƒ¨ç½²å’Œè¿è¡Œã€‚ä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé¢‘ç¹ä¿®æ”¹ä»£ç åéƒ½é‡æ–°æ„å»ºå’Œå¯åŠ¨å®¹å™¨ä¼šæå¤§åœ°é™ä½å¼€å‘æ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æå‡å¼€å‘ä½“éªŒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å®ç° Docker çƒ­é‡è½½ï¼Œè¿™æ ·åœ¨ä¿®æ”¹ä»£ç åï¼Œæ— éœ€é‡å¯å®¹å™¨å°±èƒ½å®æ—¶çœ‹åˆ°ä»£ç å˜æ›´çš„æ•ˆæœã€‚\nğŸ–¥ï¸ å‰ç«¯çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ è°ƒæ•´å‰ç«¯ Dockerfile 1 2 3 4 5 6 7 8 # frontend/Dockerfile.dev # ================= å¼€å‘é˜¶æ®µ ================= FROM node:22-alpine AS dev WORKDIR /app COPY frontend/package*.json ./ RUN npm install EXPOSE 5173 CMD [\u0026#34;npm\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;dev\u0026#34;] è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºå¼€å‘ç¯å¢ƒçš„ Dockerfile.devã€‚åŸºäºnode:22-alpineé•œåƒï¼Œè®¾ç½®å·¥ä½œç›®å½•ä¸º/appï¼Œå¤åˆ¶å‰ç«¯é¡¹ç›®çš„package*.jsonæ–‡ä»¶å¹¶æ‰§è¡Œnpm installå®‰è£…ä¾èµ–ã€‚æš´éœ²ç«¯å£ 5173ï¼Œè¿™æ˜¯ Vite å¼€å‘æœåŠ¡å™¨é»˜è®¤çš„ç«¯å£ã€‚æœ€åå¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ã€‚\næ·»åŠ  docker-compose.dev.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 services: frontend: build: context: . dockerfile: frontend/Dockerfile.dev target: dev volumes: - ./frontend:/app - /app/node_modules ports: - \u0026#34;5173:5173\u0026#34; environment: - NODE_ENV=development åœ¨docker-compose.dev.ymlä¸­ï¼Œå®šä¹‰äº†å‰ç«¯æœåŠ¡åœ¨å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®ã€‚é€šè¿‡volumeså°†æœ¬åœ°çš„./frontendç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„/appç›®å½•ï¼Œå®ç°ä»£ç çš„å®æ—¶åŒæ­¥ã€‚åŒæ—¶ï¼Œä½¿ç”¨/app/node_modulesé˜²æ­¢æœ¬åœ°çš„node_modulesè¦†ç›–å®¹å™¨å†…çš„ä¾èµ–ã€‚å°†å®¹å™¨çš„ 5173 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 5173 ç«¯å£ï¼Œæ–¹ä¾¿åœ¨æœ¬åœ°è®¿é—®å¼€å‘æœåŠ¡å™¨ã€‚è®¾ç½®ç¯å¢ƒå˜é‡NODE_ENVä¸ºdevelopmentã€‚\né…ç½® Vite å¼€å‘æœåŠ¡å™¨ 1 2 3 4 5 6 7 8 9 10 // frontend/vite.config.ts export default defineConfig({ server: { host: true, // å…è®¸å¤–éƒ¨è®¿é—® port: 5173, watch: { usePolling: true, // è§£å†³å®¹å™¨å†…æ–‡ä»¶ç›‘å¬é—®é¢˜ }, }, }); åœ¨ Vite é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®host: trueå…è®¸å¤–éƒ¨è®¿é—®å¼€å‘æœåŠ¡å™¨ï¼Œport: 5173æŒ‡å®šå¼€å‘æœåŠ¡å™¨çš„ç«¯å£ã€‚watch.usePolling: trueè§£å†³äº†åœ¨ Docker å®¹å™¨å†…æ–‡ä»¶ç›‘å¬å¤±æ•ˆçš„é—®é¢˜ï¼Œé€šè¿‡è½®è¯¢çš„æ–¹å¼æ£€æµ‹æ–‡ä»¶å˜åŒ–ã€‚\nğŸ”„ å‰ç«¯çƒ­æ›´æ–°å·¥ä½œåŸç† 1 2 3 4 5 6 7 8 9 10 sequenceDiagram participant æœ¬åœ°ç¼–è¾‘å™¨ participant Dockerå®¹å™¨ participant æµè§ˆå™¨ æœ¬åœ°ç¼–è¾‘å™¨-\u0026gt;\u0026gt;Dockerå®¹å™¨: ä¿®æ”¹ä»£ç æ–‡ä»¶ Dockerå®¹å™¨-\u0026gt;\u0026gt;ViteæœåŠ¡å™¨: æ£€æµ‹æ–‡ä»¶å˜åŒ– ViteæœåŠ¡å™¨-\u0026gt;\u0026gt;ViteæœåŠ¡å™¨: å¢é‡ç¼–è¯‘ ViteæœåŠ¡å™¨-\u0026gt;\u0026gt;æµè§ˆå™¨: é€šè¿‡ WebSocket æ¨é€æ›´æ–° æµè§ˆå™¨-\u0026gt;\u0026gt;æµè§ˆå™¨: è‡ªåŠ¨åˆ·æ–°é¡µé¢ å½“åœ¨æœ¬åœ°ç¼–è¾‘å™¨ä¿®æ”¹ä»£ç æ–‡ä»¶åï¼Œç”±äºvolumesçš„æŒ‚è½½ï¼Œå®¹å™¨å†…çš„ä»£ç ä¹Ÿä¼šå®æ—¶æ›´æ–°ã€‚Vite æœåŠ¡å™¨æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–åè¿›è¡Œå¢é‡ç¼–è¯‘ï¼Œç„¶åé€šè¿‡ WebSocket å°†æ›´æ–°æ¨é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚\nâœ… å‰ç«¯çƒ­æ›´æ–°éªŒè¯ å¯åŠ¨å¼€å‘ç¯å¢ƒ\n1 docker-compose up frontend ä¿®æ”¹å‰ç«¯ä»£ç \n1 2 // frontend/src/App.tsx // éšä¾¿ä¿®æ”¹ä¸€äº›åœ°æ–¹ è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º\n1 [vite] page reload src/App.tsx æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–° æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œé¡µé¢å°†è‡ªåŠ¨æ›´æ–°\nğŸ—„ï¸ åç«¯çƒ­é‡è½½å®Œæ•´è§£å†³æ–¹æ¡ˆ æ‹†åˆ†åç«¯ Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 # backend/Dockerfile.dev FROM node:22-alpine AS development WORKDIR /app # å®‰è£…å¼€å‘ä¾èµ– RUN npm install -g nodemon COPY package*.json ./ RUN npm ci COPY . . # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ CMD [\u0026#34;npm\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;start:dev:docker\u0026#34;] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # backend/Dockerfile.prod # Stage 1: Build FROM node:22-alpine AS builder WORKDIR /app COPY package*.json ./ RUN npm ci COPY . . RUN npm run build # Stage 2: Production FROM node:22-alpine WORKDIR /app COPY --from=builder /app/dist ./dist COPY --from=builder /app/package*.json ./ RUN npm ci --production CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/main.js\u0026#34;] å°†åç«¯çš„ Dockerfile æ‹†åˆ†ä¸ºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸¤ä¸ªæ–‡ä»¶ã€‚åœ¨å¼€å‘ç¯å¢ƒçš„ Dockerfile ä¸­ï¼Œå®‰è£…nodemonç”¨äºæ–‡ä»¶ç›‘æ§å’Œçƒ­é‡è½½ï¼Œå¤åˆ¶é¡¹ç›®æ–‡ä»¶å¹¶å®‰è£…ä¾èµ–ï¼Œæœ€åå¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚ç”Ÿäº§ç¯å¢ƒçš„ Dockerfile åˆ™å…ˆè¿›è¡Œä»£ç æ„å»ºï¼Œç„¶åå°†æ„å»ºåçš„æ–‡ä»¶å¤åˆ¶åˆ°ç”Ÿäº§ç¯å¢ƒé•œåƒä¸­ï¼Œåªå®‰è£…ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„ä¾èµ–ã€‚\nè°ƒæ•´ docker-compose é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # docker-compose.yml (ç”Ÿäº§é…ç½®) services: backend: build: context: ./backend dockerfile: Dockerfile.prod env_file: - ./backend/.env environment: - NODE_ENV=production volumes: - ./backend/.env:/app/.env depends_on: - mongo ports: - \u0026#34;3000:3000\u0026#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 # docker-compose.dev.yml (å¼€å‘é…ç½®) services: backend: build: context: ./backend dockerfile: Dockerfile.dev volumes: - ./backend:/app - /app/node_modules ports: - \u0026#34;3000:3000\u0026#34; environment: - NODE_ENV=development åœ¨docker-compose.ymlä¸­é…ç½®ç”Ÿäº§ç¯å¢ƒçš„åç«¯æœåŠ¡ï¼Œä½¿ç”¨Dockerfile.prodè¿›è¡Œæ„å»ºã€‚åœ¨docker-compose.dev.ymlä¸­é…ç½®å¼€å‘ç¯å¢ƒçš„åç«¯æœåŠ¡ï¼Œä½¿ç”¨Dockerfile.devè¿›è¡Œæ„å»ºï¼Œé€šè¿‡volumeså®ç°ä»£ç å®æ—¶åŒæ­¥ï¼Œé˜²æ­¢è¦†ç›–å®¹å™¨å†…çš„ä¾èµ–ã€‚\nnodemon é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 // backend/package.json { \u0026#34;scripts\u0026#34;: { \u0026#34;start:dev:docker\u0026#34;: \u0026#34;nodemon --legacy-watch src/main.ts\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { //ç‰ˆæœ¬ä¾›å‚è€ƒ \u0026#34;@types/nodemon\u0026#34;: \u0026#34;^1.19.5\u0026#34;, \u0026#34;nodemon\u0026#34;: \u0026#34;^3.1.0\u0026#34;, // æ–°å¢çƒ­é‡è½½å·¥å…· \u0026#34;ts-node\u0026#34;: \u0026#34;^10.9.2\u0026#34; // æ˜ç¡® TS è¿è¡Œæ—¶ç‰ˆæœ¬ } } 1 2 3 4 5 6 7 8 9 // backend/nodemon.json { \u0026#34;watch\u0026#34;: [\u0026#34;src\u0026#34;], \u0026#34;ext\u0026#34;: \u0026#34;ts,json\u0026#34;, \u0026#34;ignore\u0026#34;: [\u0026#34;src/**/*.spec.ts\u0026#34;], \u0026#34;exec\u0026#34;: \u0026#34;ts-node src/main.ts\u0026#34;, \u0026#34;legacyWatch\u0026#34;: true, \u0026#34;delay\u0026#34;: \u0026#34;1\u0026#34; } åœ¨package.jsonä¸­æ·»åŠ start:dev:dockerè„šæœ¬ï¼Œä½¿ç”¨nodemonç›‘æ§srcç›®å½•ä¸‹çš„æ–‡ä»¶å˜åŒ–ã€‚åœ¨nodemon.jsonä¸­é…ç½®ç›‘æ§çš„ç›®å½•ã€æ–‡ä»¶ç±»å‹ã€å¿½ç•¥çš„æ–‡ä»¶ç­‰ï¼Œä½¿ç”¨ts-nodeç›´æ¥è¿è¡Œ TypeScript æ–‡ä»¶ã€‚\nâœ… åç«¯çƒ­é‡è½½éªŒè¯ ä¿®æ”¹åç«¯ä»£ç \n1 2 // backend/src/main.ts // éšä¾¿ä¿®æ”¹ è§‚å¯Ÿå®¹å™¨æ—¥å¿—\n1 2 [nodemon] restarting due to changes... Server running on http://localhost:3000 API æµ‹è¯•\n1 curl http://localhost:3000/health ğŸš€ ä¸€é”®å¯åŠ¨æ–¹æ¡ˆ ç”Ÿäº§ç¯å¢ƒ 1 docker-compose -f docker-compose.yml up --build å¼€å‘ç¯å¢ƒï¼ˆå®Œæ•´çƒ­æ›´æ–°ï¼‰ 1 docker-compose -f docker-compose.yml -f docker-compose.dev.yml up åœ¨ä¸»ç›®å½•ä¸‹åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶dev-up.batï¼š\n1 2 @echo off docker-compose -f docker-compose.yml -f docker-compose.dev.yml up %* è¿™ä¸ªè„šæœ¬å¯ä»¥æ–¹ä¾¿åœ°å¯åŠ¨å¼€å‘ç¯å¢ƒï¼Œå°†docker-compose.ymlå’Œdocker-compose.dev.ymlçš„é…ç½®åˆå¹¶ä½¿ç”¨ã€‚\né€šè¿‡ä»¥ä¸Šå‰ç«¯å’Œåç«¯çš„çƒ­é‡è½½é…ç½®ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥æå¤§åœ°æé«˜æ•ˆç‡ï¼Œå®æ—¶çœ‹åˆ°ä»£ç ä¿®æ”¹çš„æ•ˆæœã€‚åŒæ—¶ï¼Œé€šè¿‡ä¸åŒçš„ Dockerfile å’Œdocker-composeé…ç½®ï¼Œæ¸…æ™°åœ°åˆ†ç¦»äº†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚\nğŸš¨ é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ åœ¨å®Œæˆå‰é¢çš„ Docker é…ç½®åŠçƒ­é‡è½½è®¾ç½®åï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚æ¥ä¸‹æ¥å°†é’ˆå¯¹ç”¨æˆ·å’Œå¯†ç ç®¡ç†ã€æ–‡ä»¶è·¯å¾„åŠç¯å¢ƒå˜é‡åŠ è½½ç­‰æ–¹é¢çš„å¸¸è§é—®é¢˜è¿›è¡Œåˆ†æï¼Œå¹¶ç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚\nğŸ” ç”¨æˆ·å’Œå¯†ç ç®¡ç†é—®é¢˜ ç”¨æˆ·å’Œå¯†ç å®šä¹‰å…³ç³» ç”¨æˆ·å’Œå¯†ç çš„åˆ›å»ºæ¶‰åŠä¸¤ä¸ªå…³é”®æ–‡ä»¶ï¼Œå®ƒä»¬æœ‰ç€ä¸åŒçš„ä½œç”¨å’Œé…ç½®æ–¹å¼ã€‚\nRoot ç”¨æˆ· (ç®¡ç†å‘˜)ï¼šåœ¨ docker-compose.yml ä¸­å®šä¹‰ï¼Œç”¨äº MongoDB å®ä¾‹çš„åˆå§‹ç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯¹æ•´ä¸ª MongoDB å®ä¾‹æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒã€‚ 1 2 3 4 mongo: environment: - MONGO_INITDB_ROOT_USERNAME=root - MONGO_INITDB_ROOT_PASSWORD=rootpassword123 åº”ç”¨ç”¨æˆ· (tacticore)ï¼šåœ¨ init-mongo.js ä¸­å®šä¹‰ï¼Œä»…é™ç‰¹å®šæ•°æ®åº“çš„æ“ä½œæƒé™ã€‚ 1 2 3 4 5 db.createUser({ user: \u0026#34;tacticore\u0026#34;, pwd: \u0026#34;pwd-tacticore\u0026#34;, roles: [{ role: \u0026#34;readWrite\u0026#34;, db: \u0026#34;tacticore\u0026#34; }], }); è¿æ¥å­—ç¬¦ä¸² (MONGO_URI)ï¼šé…ç½®åœ¨ .env æˆ– docker-compose.yml ä¸­ï¼Œæ ¼å¼ä¸º mongodb://\u0026lt;åº”ç”¨ç”¨æˆ·\u0026gt;:\u0026lt;åº”ç”¨å¯†ç \u0026gt;@mongo:27017/\u0026lt;æ•°æ®åº“\u0026gt;?authSource=adminã€‚ä½¿ç”¨ authSource=admin æ˜¯å› ä¸º MongoDB è¦æ±‚é root ç”¨æˆ·å¿…é¡»åœ¨ admin æ•°æ®åº“è¿›è¡Œèº«ä»½éªŒè¯ã€‚ ä¿®æ”¹ç”¨æˆ·å¯†ç  ä¿®æ”¹ Root ç”¨æˆ·ï¼šç›´æ¥ä¿®æ”¹ docker-compose.yml çš„ç¯å¢ƒå˜é‡ã€‚ ä¿®æ”¹åº”ç”¨ç”¨æˆ·ï¼šæ›´æ–° init-mongo.js ä¸­çš„ pwd å­—æ®µï¼Œå¹¶é‡æ–°åˆå§‹åŒ–å®¹å™¨ã€‚ 1 2 docker-compose down -v # åˆ é™¤æ•°æ®å· docker-compose up -d å®‰å…¨å»ºè®® ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆå™¨ç”Ÿæˆå¤æ‚å¯†ç ï¼Œé€šè¿‡ Docker Secrets ç®¡ç†å¯†ç ï¼ˆè€Œéæ˜æ–‡å­˜å‚¨ï¼‰ï¼Œå®šæœŸè½®æ¢å‡­è¯ã€‚ å¼€å‘ç¯å¢ƒï¼šåœ¨ init-mongo.js ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œç„¶ååœ¨ docker-compose.yml ä¸­æ³¨å…¥ã€‚ 1 2 // init-mongo.js ä½¿ç”¨å ä½ç¬¦ pwd: process.env.MONGO_APP_PASSWORD; 1 2 3 mongo: environment: - MONGO_APP_PASSWORD=${MONGO_APP_PASSWORD} ğŸ“‚ Docker æ„å»ºå‰ç«¯é•œåƒæ—¶æ‰¾ä¸åˆ° Nginx é…ç½®æ–‡ä»¶é—®é¢˜ é”™è¯¯åŸå›  1 COPY infra/docker/nginx/tacticore.conf â†’ æ–‡ä»¶æœªæ‰¾åˆ° è¿™æ˜¯ç”±äº Docker æ„å»ºä¸Šä¸‹æ–‡è·¯å¾„å’Œæ–‡ä»¶å¼•ç”¨è·¯å¾„ä¸åŒ¹é…ã€‚é¡¹ç›®ç»“æ„ä¸­ï¼Œé…ç½®æ–‡ä»¶åœ¨ infra ç›®å½•ï¼Œè€Œ Dockerfile åœ¨ client ç›®å½•ã€‚\nè§£å†³æ–¹æ¡ˆ åœ¨ docker-compose.yml ä¸­æŒ‡å®šæ­£ç¡®çš„æ„å»ºä¸Šä¸‹æ–‡ã€‚\n1 2 3 4 5 services: frontend: build: context: . # å°†æ„å»ºä¸Šä¸‹æ–‡è®¾ä¸ºé¡¹ç›®æ ¹ç›®å½• dockerfile: frontend/Dockerfile å…³é”®åŸç†æ˜¯ Docker åªèƒ½è®¿é—® context æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ‰€æœ‰ COPY æŒ‡ä»¤çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äº context ç›®å½•çš„ã€‚\nğŸ“Œ ç¯å¢ƒå˜é‡åŠ è½½é—®é¢˜ Docker Compose çš„ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§é—®é¢˜ åœ¨ docker-compose.yml ä¸­åŒæ—¶ä½¿ç”¨äº†ä¸¤ç§ç¯å¢ƒå˜é‡åŠ è½½æ–¹å¼ï¼š\n1 2 3 env_file: ./backend/.env # æ–¹å¼1ï¼šä»æ–‡ä»¶åŠ è½½ environment: # æ–¹å¼2ï¼šç›´æ¥è®¾ç½® - MONGO_URI=${MONGO_URI} # å¼•ç”¨å®¿ä¸»æœºç¯å¢ƒå˜é‡ æ ¹æ® Docker çš„å˜é‡ä¼˜å…ˆçº§è§„åˆ™ï¼Œenvironment ç›´æ¥å®šä¹‰çš„å˜é‡ä¼šè¦†ç›– env_file ä¸­çš„åŒåå˜é‡ï¼Œ${VAR} è¯­æ³•ä¼šå°è¯•è¯»å–å®¿ä¸»æœºç¯å¢ƒå˜é‡ï¼ˆè€Œéæ–‡ä»¶ä¸­çš„å˜é‡ï¼‰ã€‚ç”±äºå®¿ä¸»æœºæ²¡æœ‰å®šä¹‰ MONGO_URI ç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´æœ€ç»ˆå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚\nè§£å†³æ–¹æ¡ˆ ç»Ÿä¸€ä½¿ç”¨ env_fileã€‚\n1 2 3 4 5 6 7 8 services: backend: env_file: - ./backend/.env environment: - NODE_ENV=production - - MONGO_URI=${MONGO_URI} # åˆ é™¤æ­¤è¡Œ - - JWT_SECRET=${JWT_SECRET} # åˆ é™¤æ­¤è¡Œ å˜é‡è¦†ç›–æœºåˆ¶å¦‚ä¸‹ï¼š\né…ç½®æ–¹å¼ ä¼˜å…ˆçº§ é€‚ç”¨åœºæ™¯ environment é«˜ éœ€è¦è¦†ç›–æ–‡ä»¶é…ç½®æ—¶ env_file ä½ é›†ä¸­ç®¡ç†å¤šä¸ªå˜é‡ é€šè¿‡ä»¥ä¸Šå¯¹å¸¸è§é—®é¢˜çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥æ›´å¥½åœ°åº”å¯¹ Docker é…ç½®å’Œä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„çŠ¶å†µï¼Œç¡®ä¿é¡¹ç›®çš„ç¨³å®šè¿è¡Œã€‚\nâš™ï¸ é€šç”¨é…ç½® åœ¨å…¨æ ˆåšå®¢ç³»ç»Ÿçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®ŒæˆåŸºç¡€æ¶æ„æ­å»ºã€Docker é…ç½®ç­‰æ ¸å¿ƒéƒ¨åˆ†åï¼Œä¸€ç³»åˆ—é€šç”¨åŸºç¡€è®¾æ–½é…ç½®åŒæ ·ä¸å®¹å¿½è§†ï¼Œå®ƒä»¬å°†ä¸ºåç»­çš„é«˜æ•ˆå¼€å‘ä¸åä½œå¥ å®šåšå®åŸºç¡€ã€‚ä»¥ä¸‹è¯¦ç»†ä»‹ç»é€šç”¨é…ç½®éƒ¨åˆ†ã€‚\nğŸ› ï¸ ç»Ÿä¸€ç¼–è¾‘å™¨è§„èŒƒï¼ˆ.editorconfigï¼‰ é€šè¿‡.editorconfig æ–‡ä»¶å¯ä»¥ç¡®ä¿å›¢é˜Ÿæˆå‘˜åœ¨ä¸åŒç¼–è¾‘å™¨ä¸‹ä¿æŒä¸€è‡´çš„ä»£ç é£æ ¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # .editorconfig root = true [*] charset = utf-8 end_of_line = lf indent_size = 2 indent_style = space insert_final_newline = true trim_trailing_whitespace = true [*.md] trim_trailing_whitespace = false [*.{yml,yaml}] indent_size = 2 [*.json] indent_size = 2 [Makefile] indent_style = tab root = trueï¼šæ ‡è®°æ­¤ä¸ºæ ¹é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘å™¨å°†åœæ­¢å‘ä¸Šçº§ç›®å½•æœç´¢å…¶ä»–.editorconfig æ–‡ä»¶ï¼Œé˜²æ­¢ç»§æ‰¿çˆ¶ç›®å½•é…ç½®å¯¼è‡´è§„åˆ™å†²çªã€‚å…¶æŠ€æœ¯åŸç†éµå¾ªå°±è¿‘åŸåˆ™ï¼Œä¼˜å…ˆä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•é…ç½®ã€‚ ğŸ“ Git æäº¤æ¨¡æ¿ï¼ˆ.gitmessageï¼‰ è§„èŒƒçš„ Git æäº¤ä¿¡æ¯æœ‰åŠ©äºå›¢é˜Ÿæˆå‘˜å¿«é€Ÿäº†è§£ä»£ç å˜æ›´å†…å®¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # .gitmessage # Commit type: # feat - æ–°åŠŸèƒ½ - ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ # fix - Bugä¿®å¤ - ç™»å½•é¡µé¢è¡¨å•éªŒè¯é”™è¯¯ # docs - æ–‡æ¡£å˜æ›´ - æ›´æ–°APIæ¥å£æ–‡æ¡£ # style - ä»£ç æ ¼å¼ - è°ƒæ•´ä»£ç ç¼©è¿› # refactor - ä»£ç é‡æ„ - æå‡ºå…¬å…±å‡½æ•° # test - æµ‹è¯•ç›¸å…³ - æ·»åŠ å•å…ƒæµ‹è¯• # perf - æ€§èƒ½ä¼˜åŒ– - ä¼˜åŒ–æ€§èƒ½ # chore - æ„å»º/ä¾èµ– - æ›´æ–°ä¾èµ– # revert - å›æ»š - å›æ»šåˆ°ä¸Šä¸€ä¸ªæäº¤ # build - æ„å»º - æ·»åŠ æ„å»ºè„šæœ¬ # ci - CI/CD - æ›´æ–°CIé…ç½® # release - å‘å¸ƒ - å‘å¸ƒæ–°ç‰ˆæœ¬ # -------------------- # Scope (å¯é€‰): # frontend, backend, infra, docs, config # ä½œç”¨åŸŸå±‚çº§ä¸è¶…è¿‡2çº§ï¼ˆå¦‚feat(backend/login)ï¼‰ # æ–°æ¨¡å—é¦–æ¬¡æäº¤ä½¿ç”¨feat(module): initialize # -------------------- # Subject (å¿…å¡«): # ä¸è¶…è¿‡50ä¸ªå­—ç¬¦ï¼Œé¦–å­—æ¯å°å†™ï¼Œç»“å°¾ä¸åŠ å¥å· # -------------------- # Body (å¯é€‰): # è¯¦ç»†æè¿°ä¿®æ”¹å†…å®¹ # ä½¿ç”¨ç¥ˆä½¿å¥ï¼ˆå¦‚\u0026#34;Add\u0026#34;è€Œé\u0026#34;Added\u0026#34;ï¼‰ # è¯´æ˜å˜æ›´åŠ¨æœºï¼ˆWhy \u0026gt; Whatï¼‰ # æŠ€æœ¯æ–¹æ¡ˆæ‘˜è¦ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ # -------------------- # Footer (å¯é€‰): # BREAKING CHANGE: é‡å¤§å˜æ›´è¯´æ˜ # -------------------- # Issues (å¯é€‰): # Close #123, Fix #456 {type}({scope}): {subject} [body] [footer] é…ç½®ç”Ÿæ•ˆæ­¥éª¤ï¼šæ‰§è¡Œgit config commit.template .gitmessageä½¿é…ç½®ç”Ÿæ•ˆã€‚\nå¼ºåˆ¶æ ¡éªŒï¼ˆæ¨èï¼‰ï¼š\né¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œnpm install husky @commitlint/cli @commitlint/config-conventional --save-devã€‚å…¶ä¸­ï¼Œhuskyæ˜¯ Git hooks ç®¡ç†å·¥å…·ï¼Œ@commitlint/cliæ˜¯æäº¤ä¿¡æ¯æ ¡éªŒå‘½ä»¤è¡Œå·¥å…·ï¼Œ@commitlint/config-conventionalæ˜¯ç¤¾åŒºæ ‡å‡†æ ¡éªŒè§„åˆ™ã€‚\næ¥ç€æ‰§è¡Œnpx husky-init \u0026amp;c\u0026amp; npm installåˆå§‹åŒ– husky é…ç½®ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆ.husky ç›®å½•ç»“æ„ï¼š\n1 2 3 4 .husky/ â”œâ”€â”€ _ â”‚ â””â”€â”€ .gitignore â””â”€â”€ pre-commit åœ¨æ ¹ç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶.commitlintrc.jsonï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 { \u0026#34;extends\u0026#34;: [\u0026#34;@commitlint/config-conventional\u0026#34;], \u0026#34;rules\u0026#34;: { \u0026#34;header-max-length\u0026#34;: [2, \u0026#34;always\u0026#34;, 100] } } æœ€ååœ¨.husky/commit-msg ä¸­æ·»åŠ npx commitlint --edit $1ç»“åˆ Husky ä½¿ç”¨ã€‚\nå®Œæ•´æäº¤ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 feat(payment): é›†æˆæ”¯ä»˜å®æ‰«ç æ”¯ä»˜ - æ·»åŠ æ”¯ä»˜å®SDKåˆå§‹åŒ–é…ç½® - å®ç°æ‰«ç æ”¯ä»˜æ ¸å¿ƒé€»è¾‘ - å¢åŠ æ”¯ä»˜ç»“æœå›è°ƒå¤„ç† BREAKING CHANGE: æ”¯ä»˜æ¥å£è¿”å›ç»“æ„å˜æ›´ Closes #112, #113 Refs: #98 å¸¸è§é—®é¢˜æ’æŸ¥ï¼š\né—®é¢˜ç°è±¡ è§£å†³æ–¹æ¡ˆ command not found: husky é‡æ–°æ‰§è¡Œnpm install husky --save-dev é’©å­æœªç”Ÿæ•ˆ æ£€æŸ¥.husky ç›®å½•æ˜¯å¦åœ¨.git åŒçº§ç›®å½• Windows æƒé™é—®é¢˜ åœ¨ PowerShell æ‰§è¡ŒSet-ExecutionPolicy RemoteSigned éœ€è¦è·³è¿‡æ ¡éªŒ git commit --no-verify (æ…ç”¨) ğŸ” Git å±æ€§é…ç½®ï¼ˆ.gitattributesï¼‰ .gitattributes æ–‡ä»¶ç”¨äºå®šä¹‰ Git å¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 # .gitattributes * text=auto eol=lf *.sh text eol=lf *.md linguist-language=Markdown *.ts linguist-language=TypeScript *.tsx linguist-language=TSX package-lock.json binary yarn.lock binary ä¾‹å¦‚ï¼Œ* text=auto eol=lfè¡¨ç¤ºè‡ªåŠ¨æ£€æµ‹æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å°†æ¢è¡Œç¬¦è®¾ç½®ä¸º LFï¼›package-lock.json binaryåˆ™å°†package - lock.jsonæ–‡ä»¶æ ‡è®°ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¿å…åœ¨åˆå¹¶æ—¶å‡ºç°ä¸å¿…è¦çš„å†²çªã€‚\nğŸš¨ åŸºç¡€ ESLint é…ç½®ï¼ˆeslint.config.mjsï¼‰ ESLint ç”¨äºæ£€æŸ¥å’Œè§„èŒƒä»£ç è´¨é‡ã€‚\nä½¿ç”¨npx @eslint/migrate-config .eslintrcè½¬æ¢.eslintrcæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 // eslint.config.mjs import { defineConfig } from \u0026#34;eslint/config\u0026#34;; import typescriptEslint from \u0026#34;@typescript-eslint/eslint-plugin\u0026#34;; import react from \u0026#34;eslint-plugin-react\u0026#34;; import _import from \u0026#34;eslint-plugin-import\u0026#34;; import reactHooks from \u0026#34;eslint-plugin-react-hooks\u0026#34;; import { fixupPluginRules } from \u0026#34;@eslint/compat\u0026#34;; import tsParser from \u0026#34;@typescript-eslint/parser\u0026#34;; import path from \u0026#34;node:path\u0026#34;; import { fileURLToPath } from \u0026#34;node:url\u0026#34;; import js from \u0026#34;@eslint/js\u0026#34;; import { FlatCompat } from \u0026#34;@eslint/eslintrc\u0026#34;; const __filename = fileURLToPath(import.meta.url); const __dirname = path.dirname(__filename); const compat = new FlatCompat({ baseDirectory: __dirname, recommendedConfig: js.configs.recommended, allConfig: js.configs.all, }); export default defineConfig([ { extends: compat.extends( \u0026#34;eslint:recommended\u0026#34;, \u0026#34;plugin:@typescript-eslint/recommended\u0026#34;, \u0026#34;plugin:react/recommended\u0026#34;, \u0026#34;prettier\u0026#34; ), plugins: { \u0026#34;@typescript-eslint\u0026#34;: typescriptEslint, react, import: fixupPluginRules(_import), \u0026#34;react-hooks\u0026#34;: fixupPluginRules(reactHooks), }, languageOptions: { parser: tsParser, }, settings: { react: { version: \u0026#34;detect\u0026#34;, }, }, rules: { \u0026#34;@typescript-eslint/no-explicit-any\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;react/react-in-jsx-scope\u0026#34;: \u0026#34;off\u0026#34;, \u0026#34;@typescript-eslint/explicit-function-return-type\u0026#34;: \u0026#34;off\u0026#34;, \u0026#34;react-hooks/rules-of-hooks\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;react-hooks/exhaustive-deps\u0026#34;: \u0026#34;warn\u0026#34;, \u0026#34;import/order\u0026#34;: [ \u0026#34;error\u0026#34;, { groups: [ \u0026#34;builtin\u0026#34;, \u0026#34;external\u0026#34;, \u0026#34;internal\u0026#34;, \u0026#34;parent\u0026#34;, \u0026#34;sibling\u0026#34;, \u0026#34;index\u0026#34;, ], \u0026#34;newlines-between\u0026#34;: \u0026#34;always\u0026#34;, }, ], \u0026#34;react/prop-types\u0026#34;: \u0026#34;off\u0026#34;, }, }, ]); ä»¥import/orderè§„åˆ™ä¸ºä¾‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»Ÿä¸€æ¨¡å—å¯¼å…¥é¡ºåºã€‚åˆ†ç»„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š\nbuiltinï¼šNode.js å†…ç½®æ¨¡å—ï¼ˆå¦‚pathï¼‰ externalï¼šnode_modulesä¾èµ– internalï¼šé¡¹ç›®å†…éƒ¨åˆ«åè·¯å¾„ parentï¼šçˆ¶ç›®å½•å¼•ç”¨ siblingï¼šåŒçº§ç›®å½• indexï¼šç›®å½•ç´¢å¼•æ–‡ä»¶ ä¾‹å¦‚ï¼š 1 2 3 4 5 6 // âœ… æ­£ç¡®é¡ºåº import path from \u0026#34;path\u0026#34;; // builtin import React from \u0026#34;react\u0026#34;; // external import Button from \u0026#34;@/components/Button\u0026#34;; // internal import utils from \u0026#34;../utils\u0026#34;; // parent import styles from \u0026#34;./styles.module.css\u0026#34;; // sibling ğŸ¨ Prettier æ ¼å¼åŒ–é…ç½®ï¼ˆ.prettierrcï¼‰ Prettier ç”¨äºä»£ç æ ¼å¼åŒ–ï¼Œä¿æŒä»£ç é£æ ¼ä¸€è‡´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 { \u0026#34;printWidth\u0026#34;: 100, \u0026#34;tabWidth\u0026#34;: 2, \u0026#34;useTabs\u0026#34;: false, \u0026#34;semi\u0026#34;: true, \u0026#34;singleQuote\u0026#34;: true, \u0026#34;trailingComma\u0026#34;: \u0026#34;all\u0026#34;, \u0026#34;bracketSpacing\u0026#34;: true, \u0026#34;arrowParens\u0026#34;: \u0026#34;avoid\u0026#34;, \u0026#34;endOfLine\u0026#34;: \u0026#34;lf\u0026#34; } ä¾‹å¦‚ï¼ŒprintWidthè®¾ç½®ä¸º 100ï¼Œè¡¨ç¤ºä¸€è¡Œä»£ç çš„æœ€å¤§å®½åº¦ä¸º 100 ä¸ªå­—ç¬¦ï¼›singleQuoteè®¾ç½®ä¸ºtrueè¡¨ç¤ºä½¿ç”¨å•å¼•å·ã€‚\nğŸ¶ Husky æäº¤è§„èŒƒï¼ˆ.husky/ï¼‰ Husky å¯ä»¥åœ¨ Git æ“ä½œçš„ç‰¹å®šé˜¶æ®µæ‰§è¡Œè„šæœ¬ï¼Œç¡®ä¿ä»£ç è§„èŒƒã€‚åœ¨é…ç½® Husky æ—¶ï¼Œlint:staged å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚\nå®‰è£…ä¾èµ– 1 2 3 4 5 npm install lint-staged --save-dev # å®‰è£…ESLintä¾èµ– npm install eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin --save-dev # åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ npm install prettier --save-dev ä¿®æ”¹package.json 1 2 3 4 5 6 7 8 9 { \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Tests placeholder\\\u0026#34;\u0026#34;, \u0026#34;lint:staged\u0026#34;: \u0026#34;lint-staged\u0026#34; }, \u0026#34;lint-staged\u0026#34;: { \u0026#34;*.{js,ts,tsx}\u0026#34;: [\u0026#34;eslint --fix\u0026#34;, \u0026#34;prettier --write\u0026#34;] } } åœ¨æ­¤é…ç½®ä¸­ï¼Œlint-stagedå®šä¹‰äº†å¯¹æš‚å­˜çš„ç‰¹å®šæ–‡ä»¶ï¼ˆå¦‚.jsã€.tsã€.tsxæ–‡ä»¶ï¼‰æ‰§è¡Œeslint --fixè¿›è¡Œä»£ç æ£€æŸ¥å’Œä¿®å¤ï¼Œä»¥åŠprettier --writeè¿›è¡Œä»£ç æ ¼å¼åŒ–ã€‚\nä¿®æ”¹.husky/pre-commit 1 2 3 4 #!/bin/sh . \u0026#34;$(dirname \u0026#34;$0\u0026#34;)/_/husky.sh\u0026#34; npm run lint:staged ä¿®æ”¹åï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œgit commitè¿›è¡Œæäº¤æ—¶ï¼ŒHusky çš„pre-commité’©å­ä¼šè‡ªåŠ¨è¿è¡Œnpm run lint:stagedï¼Œå¯¹æš‚å­˜æ–‡ä»¶è¿›è¡Œé¢„å…ˆæ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼Œç¡®ä¿æäº¤çš„ä»£ç ç¬¦åˆå›¢é˜Ÿè®¾å®šçš„ä»£ç è§„èŒƒã€‚\næ•´ä½“æ¥çœ‹ï¼ŒHusky ç»“åˆ lint:stagedï¼Œèƒ½å¤Ÿåœ¨ä»£ç æäº¤çš„å…³é”®èŠ‚ç‚¹ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–çš„è„šæœ¬æ‰§è¡Œï¼Œæœ‰æ•ˆæå‡ä»£ç è´¨é‡ï¼Œå‡å°‘å› ä»£ç é£æ ¼ä¸ä¸€è‡´ç­‰é—®é¢˜å¼•å‘çš„æ½œåœ¨é”™è¯¯å’Œæ²Ÿé€šæˆæœ¬ã€‚\nğŸŒ± åŸºç¡€ç¯å¢ƒæ¨¡æ¿ï¼ˆ.env.exampleï¼‰ .env.example æ–‡ä»¶ç”¨äºå®šä¹‰é¡¹ç›®æ‰€éœ€çš„ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼Œæ–¹ä¾¿å›¢é˜Ÿæˆå‘˜äº†è§£å’Œé…ç½®ç¯å¢ƒã€‚\n1 2 3 4 5 6 7 8 # å‰ç«¯ VITE_API_BASE_URL=http://localhost:4000/api/v1 VITE_SENTRY_DSN= # åç«¯ PORT=4000 MONGO_URI=mongodb://mongo:27017/blog JWT_SECRET=change_this_in_production ä¾‹å¦‚ï¼Œå‰ç«¯é€šè¿‡VITE_API_BASE_URLé…ç½®åç«¯ API çš„åŸºç¡€åœ°å€ï¼›åç«¯é€šè¿‡MONGO_URIé…ç½® MongoDB çš„è¿æ¥å­—ç¬¦ä¸²ã€‚\nä»£ç åˆ«åè®¾ç½® åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œåˆç†è®¾ç½®ä»£ç åˆ«åèƒ½æœ‰æ•ˆç®€åŒ–æ¨¡å—å¯¼å…¥è·¯å¾„ï¼Œæå‡ä»£ç çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚\nVite é…ç½® 1 2 3 4 5 6 7 8 9 // https://vite.dev/config/ import path from \u0026#34;node:path\u0026#34;; export default defineConfig({ resolve: { alias: { \u0026#34;@\u0026#34;: path.resolve(__dirname, \u0026#34;./src\u0026#34;), }, }, }); åœ¨ä¸Šè¿° Vite é…ç½®ä¸­ï¼Œé€šè¿‡resolve.aliaså­—æ®µï¼Œå°†@åˆ«åæŒ‡å‘é¡¹ç›®çš„srcç›®å½•ã€‚è¿™æ„å‘³ç€åœ¨å‰ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@æ¥ä»£æ›¿å†—é•¿çš„srcè·¯å¾„å‰ç¼€è¿›è¡Œæ¨¡å—å¯¼å…¥ï¼Œä¾‹å¦‚import { someFunction } from '@/utils/someFunction';ï¼Œç›¸æ¯”import { someFunction } from '../../../src/utils/someFunction';æ›´åŠ ç®€æ´æ˜äº†ã€‚\nTypeScript é…ç½®ï¼ˆåœ¨æ‰€æœ‰ tsconfig.json ç›¸å…³æ–‡ä»¶ä¸­ï¼‰ åœ¨tsconfig.jsonã€tsconfig.app.jsonã€tsconfig.node.jsonã€tsconfig.build.jsonç­‰ TypeScript é…ç½®æ–‡ä»¶ä¸­ï¼Œéœ€è¦åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š\n1 2 3 4 5 6 7 8 { \u0026#34;compilerOptions\u0026#34;: { \u0026#34;baseUrl\u0026#34;: \u0026#34;.\u0026#34;, \u0026#34;paths\u0026#34;: { \u0026#34;@/*\u0026#34;: [\u0026#34;./src/*\u0026#34;] } } } å…¶ä¸­ï¼ŒbaseUrlè®¾ç½®ä¸º.è¡¨ç¤ºä»¥é¡¹ç›®æ ¹ç›®å½•ä¸ºåŸºå‡†è·¯å¾„ã€‚pathså­—æ®µå®šä¹‰äº†è·¯å¾„æ˜ å°„è§„åˆ™ï¼Œ@/*è¡¨ç¤ºä»¥@å¼€å¤´çš„è·¯å¾„ï¼Œæ˜ å°„åˆ°./src/*ï¼Œå³srcç›®å½•ä¸‹çš„ç›¸åº”æ–‡ä»¶æˆ–å­ç›®å½•ã€‚è¿™æ ·ï¼ŒTypeScript ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶èƒ½å¤Ÿæ­£ç¡®è§£æä½¿ç”¨@åˆ«åçš„å¯¼å…¥è·¯å¾„ï¼Œç¡®ä¿é¡¹ç›®åœ¨ TypeScript ç¯å¢ƒä¸‹çš„æ­£å¸¸è¿è¡Œä¸ç±»å‹æ£€æŸ¥ã€‚\né€šè¿‡å®Œæˆä»¥ä¸Šé€šç”¨åŸºç¡€è®¾æ–½é…ç½®ï¼ŒåŒ…æ‹¬ä»£ç åˆ«åè®¾ç½®ï¼Œèƒ½å¤Ÿæå¤§æå‡å›¢é˜Ÿåä½œæ•ˆç‡ï¼Œå‡å°‘ä»£ç é£æ ¼ä¸ä¸€è‡´ã€æäº¤ä¿¡æ¯ä¸è§„èŒƒç­‰é—®é¢˜ï¼Œä¸ºå…¨æ ˆåšå®¢ç³»ç»Ÿçš„æŒç»­å¼€å‘æä¾›æœ‰åŠ›ä¿éšœã€‚\n","date":"2025-04-11T22:00:00+08:00","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/chapter1/","title":"Chapter1: é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„æ­å»º"},{"content":"ğŸ“ é¡¹ç›®æ¦‚è¿° æ ¸å¿ƒç›®æ ‡ï¼šè‡ªä¸»å¼€å‘å…¨æ ˆåšå®¢ç³»ç»Ÿï¼ˆä¸ä½¿ç”¨ Hugo/Hexo ç­‰ç°æˆæ¡†æ¶ï¼‰ æŠ€æœ¯æ ˆï¼š å‰ç«¯ï¼šReact + Material UI åç«¯ï¼šNode.js å®¹å™¨åŒ–ï¼šDocker å¼€å‘è®°å½•ï¼š å¼€å‘è¿‡ç¨‹å…ˆç”¨ Hugo+Stack æ¡†æ¶è®°å½• æœ€ç»ˆè¿ç§»åˆ°è‡ªå»ºåšå®¢ç³»ç»Ÿ ğŸ¯ å…³é”®è¦æ±‚ å…¨è‡ªä¸»å®ç°ï¼šä»é›¶æ­å»ºæ ¸å¿ƒåŠŸèƒ½ æ¸è¿›å¼è®°å½•ï¼šå¼€å‘è¿‡ç¨‹æœ¬èº«æˆä¸ºæŠ€æœ¯åšå®¢å†…å®¹ æŠ€æœ¯æŒ‘æˆ˜ï¼šèåˆç°ä»£æŠ€æœ¯æ ˆçš„å®Œæ•´ Web åº”ç”¨å®è·µ ğŸ“š åšå®¢å¤§çº² åˆå§‹åŒ–é¡¹ç›® å‰ç«¯æ§åˆ¶å°åº”ç”¨ Photo by Javier Miranda\u0026gt; on Unsplash\n","date":"2025-04-10T21:15:44+08:00","image":"https://blog.cycbloom.com/p/hugo-to-my-blog/cover_hu_f2c6ceae318da7cc.jpg","permalink":"https://blog.cycbloom.com/p/hugo-to-my-blog/","title":"From Hugo to My Blog"}]